"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,MINICAM_FACTOR=1.5,BOX_SIZE=10,CHECK_SIZE=100,Physics=function(){var e=-1,o=new THREE.Vector3(0,-TOP_CAMERA_DIST,0),t=new THREE.Vector3(0,1,0),n=new THREE.Raycaster;return{gravity:function(i,r){o.x=i.position.x,o.z=i.position.z,n.set(o,t),(!n.intersectObject(r,!0).length||i.position.y<0)&&(i.position.y+=e)},detectCollision:function(e,o){for(var t=(new THREE.Box3).setFromObject(e),n=0;n<o.length;n++)if(t.intersectsBox(o[n].boundingBox))return!0;return!1}}}(),Checkpoint=function(e,o,t){var n=new THREE.BoxGeometry(CHECK_SIZE,BOX_SIZE,CHECK_SIZE),i=new THREE.MeshBasicMaterial({color:16777215,wireframe:!0});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=o,this.mesh.position.z=t,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Box=function(e,o,t){var n=new THREE.BoxGeometry(BOX_SIZE,BOX_SIZE,BOX_SIZE),i=new THREE.MeshBasicMaterial({color:11176004});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=o,this.mesh.position.z=t,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=t,i=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return o.position.y=2*e.scale.y,o.position.z=4*e.scale.z,o.rotateY(180*Math.PI/180),t.position.y=10*e.scale.y,t.position.z=-20*e.scale.z,t.rotateY(180*Math.PI/180),e.add(o),e.add(t),e}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},a=r.movement.arrows,s=0,E=5,c=.05,l=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[a.up]&&s<E&&(s+=c),d[a.left]&&i.rotateY(l),d[a.right]&&i.rotateY(-l),d[a.down]&&s>0&&(s-=c,s=Math.max(0,s)),i.translateZ(s),d[r.switchCamera]&&(n=n===o?t:o,d[r.switchCamera]=!1),d[r.reset]&&(i.rotation.x=0,i.position.set(0,i.position.x,0),i.rotation.y=0,i.position.set(0,i.position.y,0),i.rotation.z=0,i.position.set(0,i.position.z,0))},playerObject:i,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}(),NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(t){console.log("[all-players]",t),t.forEach(function(e){var t=e.position,n=e.rotation,i=o();R[e.id]={position:t,rotation:n,car:i},i.position.set(t.x,t.y,t.z),i.rotation.set(n.x,n.y,n.z),E.add(i)}),console.log(t),0==t.length&&(i(),e.emit("send-boxes",I))}),e.on("player-joined",function(e){toastr.success("player "+e.id+" has joined."),console.log("[player-joined]",e);var t=e.position,n=e.rotation,i=o();R[e.id]={position:t,rotation:n,car:i},i.position.set(t.x,t.y,t.z),i.rotation.set(n.x,n.y,n.z),E.add(i)}),e.on("receive-boxes",function(e){I=e,r()}),e.on("player-left",function(e){toastr.error("Player "+e+" has left."),console.log("[player-left]",e);var o=R[e].car;E.remove(o),delete R[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var o=e.id,t=e.position,n=e.rotation,i=R[o];i.car.position.set(t.x,t.y,t.z),i.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){toastr.info(e+" seconds before the race starts."),console.log("[start-countdown]",e)}),e.on("start",function(){toastr.info("The race has started."),console.log("[start]")}),e.on("finished",function(e){toastr.info("You finished."),console.log("[finished]",e)}),e.on("stop",function(e){toaster.info("The race is over."),console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var o=Player.playerObject;e.emit("update-player",{position:{x:o.position.x,y:o.position.y,z:o.position.z},rotation:{x:o.rotation._x,y:o.rotation._y,z:o.rotation._z}})},40)}function o(){return(new THREE.ObjectLoader).parse(playerCar)}function t(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var o={steps:100,extrudePath:e},t=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(t,o),i=[],r=0;r<NUMBER_COLORS;r++)i.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[r],side:THREE.DoubleSide}));for(var a=n.faces.length/2,c=0;c<a;c++){var l=2*c;n.faces[l].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[l+1].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS}(s=new THREE.Mesh(n,i)).rotateX(-Math.PI/2),s.position.y=0,E.add(s)}function n(){for(var e=[new THREE.Vector3(0,0,0),new THREE.Vector3(300,0,580),new THREE.Vector3(250,0,-200),new THREE.Vector3(200,0,-870),new THREE.Vector3(0,0,-500)],o=0;o<e.length;o++){var t=new Checkpoint(e[o].x,BOX_SIZE/2,e[o].z);E.updateMatrixWorld(),h.push(t),E.add(t.mesh)}}function i(){for(var e=0;e<1e3;e++){var o=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));E.updateMatrixWorld(),Physics.gravity(o.mesh,s),o.mesh.position.y==BOX_SIZE/2&&(p.push(o),I.push({x:o.mesh.position.x,z:o.mesh.position.z}),E.add(o.mesh))}}function r(){for(var e=0;e<I.length;e++){var o=new Box(I[e].x,BOX_SIZE/2,I[e].z);E.updateMatrixWorld(),Physics.gravity(o.mesh,s),o.mesh.position.y==BOX_SIZE/2&&(p.push(o),E.add(o.mesh))}}function a(){requestAnimationFrame(a),c.clear(),c.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),c.render(E,Player.getCamera()),l.clear(),l.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),l.render(E,d),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,p)&&Player.crash(),d.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,s)}var s,E=new THREE.Scene,c=new THREE.WebGLRenderer,l=new THREE.WebGLRenderer,d=new THREE.OrthographicCamera(-WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_HEIGHT/MINICAM_FACTOR,-WINDOW_HEIGHT/MINICAM_FACTOR,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),p=[],h=[],R={},I=[];return{init:function(){c.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),c.setPixelRatio(window.devicePixelRatio),c.domElement.style.position="fixed",document.body.appendChild(c.domElement),c.autoClear=!1,l.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),l.setPixelRatio(window.devicePixelRatio),l.domElement.style.position="fixed",l.domElement.style.top="5%",l.domElement.style.left="70%",l.domElement.style.zIndex="2",l.domElement.style.outline="white solid",document.body.appendChild(l.domElement),l.autoClear=!1,d.position.y=TOP_CAMERA_DIST,d.rotation.x=-90*Math.PI/180,t(),n(),E.add(Player.playerObject),e(),a()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBoeXNpY3MuanMiLCJDaGVja3BvaW50LmpzIiwiQm94LmpzIiwiUGxheWVyLmpzIiwiTm90TWFyaW9LYXJ0LmpzIl0sIm5hbWVzIjpbIldPUkxEX1NJREVfU0laRSIsIldJTkRPV19IRUlHSFQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsIldJTkRPV19XSURUSCIsImlubmVyV2lkdGgiLCJST0FEX0NPTE9SUyIsIk5VTUJFUl9DT0xPUlMiLCJsZW5ndGgiLCJXT1JMRF9IRUlHSFQiLCJXT1JMRF9XSURUSCIsIlRPUF9DQU1FUkFfRElTVCIsIkNBUl9TSVpFX1giLCJDQVJfU0laRV9ZIiwiQ0FSX1NJWkVfWiIsIk1JTklDQU1fRkFDVE9SIiwiQk9YX1NJWkUiLCJDSEVDS19TSVpFIiwiUGh5c2ljcyIsImciLCJoZWxsIiwiVEhSRUUiLCJWZWN0b3IzIiwib25lRGlyZWN0aW9uIiwicmF5Y2FzdGVyIiwiUmF5Y2FzdGVyIiwiZ3Jhdml0eSIsIm9iamVjdCIsImZsb29yIiwieCIsInBvc2l0aW9uIiwieiIsInNldCIsImludGVyc2VjdE9iamVjdCIsInkiLCJkZXRlY3RDb2xsaXNpb24iLCJjYXIiLCJvYmplY3RzIiwiY2FyQm94IiwiQm94MyIsInNldEZyb21PYmplY3QiLCJpIiwiaW50ZXJzZWN0c0JveCIsImJvdW5kaW5nQm94IiwiQ2hlY2twb2ludCIsImdlb21ldHJ5IiwiQm94R2VvbWV0cnkiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwiY29sb3IiLCJ3aXJlZnJhbWUiLCJ0aGlzIiwibWVzaCIsIk1lc2giLCJCb3giLCJQbGF5ZXIiLCJvbktleU1vdmUiLCJlIiwiZXZlbnQiLCJrZXlDb2RlTWFwIiwid2hpY2giLCJ0eXBlIiwicG92Q2FtZXJhIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJ0cmFja2luZ0NhbWVyYSIsImN1cnJlbnRDYW1lcmEiLCJwbGF5ZXJPYmplY3QiLCJPYmplY3RMb2FkZXIiLCJwYXJzZSIsInBsYXllckNhciIsInNjYWxlIiwicm90YXRlWSIsIk1hdGgiLCJQSSIsImFkZCIsIm1ha2VQbGF5ZXJPYmplY3QiLCJjb250cm9scyIsIm1vdmVtZW50IiwiYXJyb3dzIiwidXAiLCJkb3duIiwibGVmdCIsInJpZ2h0Iiwid2FzZCIsInN3aXRjaENhbWVyYSIsInJlc2V0IiwiZW5hYmxlZENvbnRyb2xzIiwic3BlZWQiLCJtYXhTcGVlZCIsImFjY2VsZXJhdGlvbiIsInJvdGF0aW9uU3BlZWQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkb01vdmVtZW50TG9vcCIsIm1heCIsInRyYW5zbGF0ZVoiLCJyb3RhdGlvbiIsImdldENhbWVyYSIsInBsYXllcklkIiwiY3Jhc2giLCJOb3RNYXJpb0thcnQiLCJpbml0U29ja2V0RXZlbnQiLCJzb2NrZXQiLCJpbyIsInRyYW5zcG9ydHMiLCJ1cGdyYWRlIiwib24iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJwbGF5ZXIiLCJwb3MiLCJyb3QiLCJtYWtlQ2FyT2JqZWN0IiwicGxheWVycyIsImlkIiwic2NlbmUiLCJhZGRCb3hlcyIsImVtaXQiLCJib3hlcyIsInRvYXN0ciIsInN1Y2Nlc3MiLCJib3hzIiwiYWRkQm94ZXNQb3NpdGlvbiIsImVycm9yIiwicmVtb3ZlIiwicCIsInNlY29uZHMiLCJpbmZvIiwidGltZSIsInRvYXN0ZXIiLCJzdG9wIiwibmFtZSIsInNldEludGVydmFsIiwiX3giLCJfeSIsIl96IiwiYnVpbGRGbG9vciIsImN1cnZlIiwiQ2F0bXVsbFJvbUN1cnZlMyIsImNsb3NlZCIsImV4dHJ1ZGVTZXR0aW5ncyIsInN0ZXBzIiwiZXh0cnVkZVBhdGgiLCJzaGFwZSIsIlNoYXBlIiwiVmVjdG9yMiIsIkV4dHJ1ZGVHZW9tZXRyeSIsIm1hdGVyaWFscyIsInB1c2giLCJzaWRlIiwiRG91YmxlU2lkZSIsImdlb0ZhY2VzTGVuZ3RoIiwiZmFjZXMiLCJqIiwibWF0ZXJpYWxJbmRleCIsInJvdGF0ZVgiLCJhZGRDaGVja3BvaW50cyIsImN1cnZlUG9pbnRzIiwiY2hlY2siLCJ1cGRhdGVNYXRyaXhXb3JsZCIsImNoZWNrcG9pbnRzIiwiYm94IiwicmFuZG9tIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsIm1pbmlNYXBSZW5kZXJlciIsIm1pbmlNYXBDYW1lcmEiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwiekluZGV4Iiwib3V0bGluZSJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0EsTUFDQSxJQUNBLFVBRUVDLGNBQWdCRCxZQUFZRSxPQUM1QkMsYUFBZSxJQUNmQyxZQUFjLElBQ2RDLGdCQUFrQixHQUNsQkMsV0FBYSxHQUNiQyxXQUFhLEdBQ2JDLFdBQWEsR0FDYkMsZUFBaUIsSUFDakJDLFNBQVcsR0FDWEMsV0FBYSxJQ3JCYkMsUUFBVyxXQUViLElBQU1DLEdBQUssRUFDUEMsRUFBTyxJQUFJQyxNQUFNQyxRQUFRLEdBQUlYLGdCQUFpQixHQUM5Q1ksRUFBZSxJQUFJRixNQUFNQyxRQUFRLEVBQUcsRUFBRyxHQUN2Q0UsRUFBWSxJQUFJSCxNQUFNSSxVQXlCMUIsT0FDSUMsUUF4QkosU0FBaUJDLEVBQVFDLEdBRXJCUixFQUFLUyxFQUFJRixFQUFPRyxTQUFTRCxFQUN6QlQsRUFBS1csRUFBSUosRUFBT0csU0FBU0MsRUFDekJQLEVBQVVRLElBQUlaLEVBQU1HLEtBR0hDLEVBQVVTLGdCQUFnQkwsR0FBTyxHQUNsQ3BCLFFBQVVtQixFQUFPRyxT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QUtDLFlBQVloQixFQUFTYSxZQUNuQ2IsRUFBU2lCLFdBQVksRUFFckJiLEVBQWdCTSxRQUFRN0ssYUFBZSxFQUFHSCxjQUFnQixHQUMxRDBLLEVBQWdCTyxjQUFjaEwsT0FBT2lMLGtCQUNyQ1IsRUFBZ0JTLFdBQVdDLE1BQU12SixTQUFXLFFBQzVDNkksRUFBZ0JTLFdBQVdDLE1BQU1JLElBQU0sS0FDdkNkLEVBQWdCUyxXQUFXQyxNQUFNcEcsS0FBTyxNQUN4QzBGLEVBQWdCUyxXQUFXQyxNQUFNSyxPQUFTLElBQzFDZixFQUFnQlMsV0FBV0MsTUFBTU0sUUFBVSxjQUMzQ2hHLFNBQVMyRixLQUFLQyxZQUFZWixFQUFnQlMsWUFDMUNULEVBQWdCYSxXQUFZLEVBRTVCWixFQUFjOUksU0FBU0ksRUFBSXZCLGdCQUMzQmlLLEVBQWM1RSxTQUFTbkUsR0FBSyxHQUFLMkMsS0FBS0MsR0FBSyxJQUUzQ2lFLElBRUFvQixJQUVBekMsRUFBTTNDLElBQUluQixPQUFPVyxjQUNqQm1DLElBQ0FnRSxNQW5TYyIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cbiAqL1xuXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xuY29uc3QgV0lORE9XX0hFSUdIVCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbmNvbnN0IFdJTkRPV19XSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuY29uc3QgUk9BRF9DT0xPUlMgPSBbXG4gICAgMHhmZjAwMDAsXG4gICAgMHhmZjg4MDAsXG4gICAgMHhmZmZmMDAsXG4gICAgMHgwMGZmMDAsXG4gICAgMHgwMGZmZmYsXG4gICAgMHgwMDAwZmYsXG4gICAgMHhmZjAwZmZcbl07XG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xuY29uc3QgV09STERfSEVJR0hUID0gMTAwMDtcbmNvbnN0IFdPUkxEX1dJRFRIID0gMTAwO1xuY29uc3QgVE9QX0NBTUVSQV9ESVNUID0gNTA7XG5jb25zdCBDQVJfU0laRV9YID0gMTA7XG5jb25zdCBDQVJfU0laRV9ZID0gMTA7XG5jb25zdCBDQVJfU0laRV9aID0gMTA7XG5jb25zdCBNSU5JQ0FNX0ZBQ1RPUiA9IDEuNTtcbmNvbnN0IEJPWF9TSVpFID0gMTA7XG5jb25zdCBDSEVDS19TSVpFID0gMTAwO1xuIiwiLyoqXG4gKiBQaHlzaWNzIFwiZW5naW5lXCIgZm9yIHRoZSBnYW1lLlxuICogTm90UGh5c2lqcyBmb3IgTm90TWFyaW9LYXJ0LlxuICovXG5jb25zdCBQaHlzaWNzID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgZyA9IC0xO1xuICAgIGxldCBoZWxsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgLVRPUF9DQU1FUkFfRElTVCwgMCk7XG4gICAgbGV0IG9uZURpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApO1xuICAgIGxldCByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7XG5cbiAgICBmdW5jdGlvbiBncmF2aXR5KG9iamVjdCwgZmxvb3IpIHtcbiAgICAgICAgLy8gVXBkYXRlIHJheWNhc3RlciB3aXRoIGFuIG9yaWdpbiBiZWxvdyB0aGUgb2JqZWN0LlxuICAgICAgICBoZWxsLnggPSBvYmplY3QucG9zaXRpb24ueDtcbiAgICAgICAgaGVsbC56ID0gb2JqZWN0LnBvc2l0aW9uLno7XG4gICAgICAgIHJheWNhc3Rlci5zZXQoaGVsbCwgb25lRGlyZWN0aW9uKTtcblxuICAgICAgICAvLyBUcnkgdG8gaW50ZXJzZWN0IHdpdGggZmxvb3IuXG4gICAgICAgIGxldCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdChmbG9vciwgdHJ1ZSk7XG4gICAgICAgIGlmICghaW50ZXJzZWN0cy5sZW5ndGggfHwgb2JqZWN0LnBvc2l0aW9uLnkgPCAwKSB7XG4gICAgICAgICAgICBvYmplY3QucG9zaXRpb24ueSArPSBnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGV0ZWN0Q29sbGlzaW9uKGNhciwgb2JqZWN0cykge1xuICAgICAgICBsZXQgY2FyQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KGNhcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGNhckJveC5pbnRlcnNlY3RzQm94KG9iamVjdHNbaV0uYm91bmRpbmdCb3gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdyYXZpdHk6IGdyYXZpdHksXG4gICAgICAgIGRldGVjdENvbGxpc2lvbjogZGV0ZWN0Q29sbGlzaW9uXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEJveGVzIHJlcHJlc2VudGluZyBvYnN0YWNsZXMuXG4gKi9cbmNvbnN0IENoZWNrcG9pbnQgPSAoZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIGxldCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggQ0hFQ0tfU0laRSwgQk9YX1NJWkUsIENIRUNLX1NJWkUgKTtcbiAgICBsZXQgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhmZmZmZmYsIHdpcmVmcmFtZTp0cnVlfSApO1xuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueCA9IHg7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSB5O1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gejtcbiAgICB0aGlzLmJvdW5kaW5nQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KHRoaXMubWVzaCk7XG59KTtcbiIsIi8qKlxuICogQm94ZXMgcmVwcmVzZW50aW5nIG9ic3RhY2xlcy5cbiAqL1xuY29uc3QgQm94ID0gKGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBsZXQgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIEJPWF9TSVpFLCBCT1hfU0laRSwgQk9YX1NJWkUgKTtcbiAgICBsZXQgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhhYTg4NDR9ICk7XG4gICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi54ID0geDtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IHk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnogPSB6O1xuICAgIHRoaXMuYm91bmRpbmdCb3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QodGhpcy5tZXNoKTtcbn0pO1xuIiwiLyoqXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxuICovXG5cbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcbiAgICBjb25zdCBwb3ZDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgY29uc3QgdHJhY2tpbmdDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcbiAgICBsZXQgZ2V0Q2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50Q2FtZXJhO1xuICAgIH07XG5cbiAgICBjb25zdCBwbGF5ZXJPYmplY3QgPSBtYWtlUGxheWVyT2JqZWN0KCk7XG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcblxuICAgIGNvbnN0IGNvbnRyb2xzID0ge1xuICAgICAgICBtb3ZlbWVudDoge1xuICAgICAgICAgICAgYXJyb3dzOiB7XG4gICAgICAgICAgICAgICAgdXA6IDM4LFxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDM3LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAzOVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdhc2Q6IHtcbiAgICAgICAgICAgICAgICB1cDogODcsXG4gICAgICAgICAgICAgICAgZG93bjogODMsXG4gICAgICAgICAgICAgICAgbGVmdDogNjUsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDY4XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHN3aXRjaENhbWVyYTogNjcsXG4gICAgICAgIHJlc2V0OiA4XG4gICAgfTtcblxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XG5cbiAgICBsZXQgc3BlZWQgPSAwO1xuICAgIGxldCBtYXhTcGVlZCA9IDU7XG4gICAgY29uc3QgYWNjZWxlcmF0aW9uID0gMC4wNTtcbiAgICBjb25zdCByb3RhdGlvblNwZWVkID0gMC4wNTtcblxuICAgIGNvbnN0IGtleUNvZGVNYXAgPSB7fTtcblxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XG4gICAgICAgIGUgPSBlIHx8IGV2ZW50OyAvLyBGb3IgSUUuXG4gICAgICAgIGtleUNvZGVNYXBbZS53aGljaF0gPSBlLnR5cGUgPT09ICdrZXlkb3duJztcbiAgICB9XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlNb3ZlLCBmYWxzZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGRvTW92ZW1lbnRMb29wKCkge1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPCBtYXhTcGVlZCkge1xuICAgICAgICAgICAgICAgIHNwZWVkICs9IGFjY2VsZXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMubGVmdF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5yaWdodF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMuZG93bl0pIHtcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGVlZCAtPSBhY2NlbGVyYXRpb247XG4gICAgICAgICAgICAgICAgc3BlZWQgPSBNYXRoLm1heCgwLCBzcGVlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudENhbWVyYSA9PT0gcG92Q2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2FtZXJhID0gcG92Q2FtZXJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMucmVzZXRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueCA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi54LCAwKTtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGlvbi55ID0gMDtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnogPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueiwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmFzaCgpIHtcbiAgICAgICAgLy8gYWNjZWxlcmF0aW9uID0gMDtcbiAgICAgICAgc3BlZWQgPSAwO1xuICAgICAgICAvLyBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgIC8vICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWigtc3BlZWQpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIC8vIGxldCBwb3MgPSBncm91cEJsb2Nrc1tpXS5wb3NpdGlvbjtcbiAgICAgICAgLy8gICAgIGxldCBwbyA9IHBsYXllck9iamVjdC5jaGlsZHJlblsyXS5jaGlsZHJlblswXVxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICB2YXIgbG9jYWxWZXJ0ZXggPSBwby5nZW9tZXRyeS52ZXJ0aWNlc1t2ZXJ0ZXhJbmRleF0uY2xvbmUoKTtcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XG4gICAgICAgIC8vICAgICB2YXIgZGlyZWN0aW9uVmVjdG9yID0gZ2xvYmFsVmVydGV4LnN1YlNlbGYoIHBvLnBvc2l0aW9uICk7XG5cbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcbiAgICAgICAgLy8gICAgIHZhciBjb2xsaXNpb25SZXN1bHRzID0gcmF5LmludGVyc2VjdE9iamVjdHMoIGdyb3VwQmxvY2tzICk7XG4gICAgICAgIC8vICAgICBpZiAoIGNvbGxpc2lvblJlc3VsdHMubGVuZ3RoID4gMCAmJiBjb2xsaXNpb25SZXN1bHRzWzBdLmRpc3RhbmNlIDwgZGlyZWN0aW9uVmVjdG9yLmxlbmd0aCgpIClcbiAgICAgICAgLy8gICAgIHtcbiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZygncGVyZGlzdHJlJylcbiAgICAgICAgLy8gICAgICAgICAvLyBhIGNvbGxpc2lvbiBvY2N1cnJlZC4uLiBkbyBzb21ldGhpbmcuLi5cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBpZigocGxheWVyT2JqZWN0LnBvc2l0aW9uLngrNSA8IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPCBwb3Mueil8fCAocGxheWVyT2JqZWN0LnBvc2l0aW9uLngtNSA+IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPiBwb3MueikpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxuICAgICAgICAvLyB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZVBsYXllck9iamVjdCgpIHtcbiAgICAgICAgY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLk9iamVjdExvYWRlcigpO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcblxuICAgICAgICBwb3ZDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMjtcbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIDQ7XG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xuICAgICAgICBwb3ZDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICB0cmFja2luZ0NhbWVyYS5wb3NpdGlvbi55ID0gb2JqZWN0LnNjYWxlLnkgKiAxMDtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogLTIwO1xuICAgICAgICAvLyB0cmFja2luZ0NhbWVyYS5yb3RhdGVYKDAgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICBvYmplY3QuYWRkKHBvdkNhbWVyYSk7XG4gICAgICAgIG9iamVjdC5hZGQodHJhY2tpbmdDYW1lcmEpO1xuXG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9Nb3ZlbWVudExvb3A6IGRvTW92ZW1lbnRMb29wLFxuICAgICAgICBwbGF5ZXJPYmplY3Q6IHBsYXllck9iamVjdCxcbiAgICAgICAgZ2V0Q2FtZXJhOiBnZXRDYW1lcmEsXG4gICAgICAgIHBsYXllcklkOiBwbGF5ZXJJZCxcbiAgICAgICAgY3Jhc2g6IGNyYXNoXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIE1haW4gZmlsZSBvZiB0aGUgZ2FtZS5cbiAqL1xuXG5jb25zdCBOb3RNYXJpb0thcnQgPSAoZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcbiAgICBjb25zdCByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgY29uc3QgbWluaU1hcFJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcbiAgICBjb25zdCBtaW5pTWFwQ2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYShcbiAgICAgICAgLVdJTkRPV19XSURUSC9NSU5JQ0FNX0ZBQ1RPUixcbiAgICAgICAgV0lORE9XX1dJRFRIL01JTklDQU1fRkFDVE9SLFxuICAgICAgICBXSU5ET1dfSEVJR0hUL01JTklDQU1fRkFDVE9SLFxuICAgICAgICAtV0lORE9XX0hFSUdIVC9NSU5JQ0FNX0ZBQ1RPUixcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUIC0gNTAsXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCArIDUwXG4gICAgKTtcbiAgICB2YXIgZmxvb3I7XG4gICAgLy9Cb3ggb2JqZWN0c1xuICAgIHZhciBvYmplY3RzID0gW107XG4gICAgdmFyIGNoZWNrcG9pbnRzID0gW107XG4gICAgY29uc3QgcGxheWVycyA9IHt9O1xuICAgIC8vQm94IHBvc2l0aW9ucyBmb3Igb3RoZXIgcGxheWVyc1xuICAgIHZhciBib3hlcyA9IFtdO1xuXG4gICAgZnVuY3Rpb24gaW5pdFNvY2tldEV2ZW50KCkge1xuICAgICAgICB2YXIgc29ja2V0ID0gaW8oeyB0cmFuc3BvcnRzOiBbJ3dlYnNvY2tldCddLCB1cGdyYWRlOiBmYWxzZSB9KTtcblxuICAgICAgICAvLyBUT0RPOiBzaG93IG1vZGFsIHdpdGggbmFtZSBmb3JtLCB0aGVuIGVtaXQgbmFtZVxuXG4gICAgICAgIHNvY2tldC5vbignYWxsLXBsYXllcnMnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW2FsbC1wbGF5ZXJzXScsIGRhdGEpO1xuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICAgICAgY29uc3QgY2FyID0gbWFrZUNhck9iamVjdCgpO1xuICAgICAgICAgICAgICAgIHBsYXllcnNbcGxheWVyLmlkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb246IHJvdCxcbiAgICAgICAgICAgICAgICAgICAgY2FyOiBjYXJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgICAgICAgICAgY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PSAwKXtcbiAgICAgICAgICAgICAgICBhZGRCb3hlcygpO1xuICAgICAgICAgICAgICAgIHNvY2tldC5lbWl0KCdzZW5kLWJveGVzJyxib3hlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWpvaW5lZCcsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoYHBsYXllciAke3BsYXllci5pZH0gaGFzIGpvaW5lZC5gKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbcGxheWVyLWpvaW5lZF0nLCBwbGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xuICAgICAgICAgICAgY29uc3Qgcm90ID0gcGxheWVyLnJvdGF0aW9uO1xuICAgICAgICAgICAgY29uc3QgY2FyID0gbWFrZUNhck9iamVjdCgpO1xuICAgICAgICAgICAgcGxheWVyc1twbGF5ZXIuaWRdID0ge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3MsXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHJvdCxcbiAgICAgICAgICAgICAgICBjYXI6IGNhclxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgICAgICBjYXIucm90YXRpb24uc2V0KHJvdC54LCByb3QueSwgcm90LnopO1xuICAgICAgICAgICAgc2NlbmUuYWRkKGNhcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncmVjZWl2ZS1ib3hlcycsIGZ1bmN0aW9uKGJveHMpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdbcGxheWVyLWxlZnRdJywgcGxheWVySWQpO1xuICAgICAgICAgICAgYm94ZXMgPSBib3hzO1xuICAgICAgICAgICAgYWRkQm94ZXNQb3NpdGlvbigpO1xuICAgICAgICAgICAgLy8gY29uc3QgY2FyID0gcGxheWVyc1twbGF5ZXJJZF0uLy9jYXI7XG4gICAgICAgICAgICAvLyBzY2VuZS5yZW1vdmUoY2FyKTtcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBwbGF5ZXJzW3BsYXllcklkXTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItbGVmdCcsIGZ1bmN0aW9uKHBsYXllcklkKSB7XG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IoYFBsYXllciAke3BsYXllcklkfSBoYXMgbGVmdC5gKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbcGxheWVyLWxlZnRdJywgcGxheWVySWQpO1xuICAgICAgICAgICAgY29uc3QgY2FyID0gcGxheWVyc1twbGF5ZXJJZF0uY2FyO1xuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGNhcik7XG4gICAgICAgICAgICBkZWxldGUgcGxheWVyc1twbGF5ZXJJZF07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigndXBkYXRlLXBsYXllcicsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1t1cGRhdGUtcGxheWVyXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBpZCA9IHBsYXllci5pZDtcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcbiAgICAgICAgICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydC1jb3VudGRvd24nLCBmdW5jdGlvbihzZWNvbmRzKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhgJHtzZWNvbmRzfSBzZWNvbmRzIGJlZm9yZSB0aGUgcmFjZSBzdGFydHMuYCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0YXJ0LWNvdW50ZG93bl0nLCBzZWNvbmRzKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgXCJ4IHNlY29uZHMgYmVmb3JlIHN0YXJ0XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1RoZSByYWNlIGhhcyBzdGFydGVkLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydF0nKTtcbiAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB0aGUgZ2FtZSBoYXMgc3RhcnRlZFxuICAgICAgICAgICAgLy8gVE9ETzogZGlzYWJsZSBtb3ZpbmcgaWYgbm90IHN0YXJ0ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIGEgbmFtZSBmaXJzdCAoZG9uJ3QgaGlkZSBtb2RhbClcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIHRvIGJlIHJlYWR5XG4gICAgICAgICAgICAvLyBUT0RPOiAyKyBwbGF5ZXJzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignZmluaXNoZWQnLCBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbygnWW91IGZpbmlzaGVkLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tmaW5pc2hlZF0nLCB0aW1lKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgXCJ3YWl0aW5nIGZvciBvdGhlcnMsIHlvdXIgdGltZSBpcyB4XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdG9wJywgZnVuY3Rpb24ocGxheWVycykge1xuICAgICAgICAgICAgdG9hc3Rlci5pbmZvKCdUaGUgcmFjZSBpcyBvdmVyLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdG9wXScsIHN0b3ApO1xuICAgICAgICAgICAgLy8gVE9ETzogYWxsIHBsYXllcnMgYXJlIGZpbmlzaGVkLCBzaG93IHJhbmtpbmcgYW5kIHBsYXkgYWdhaW4gYnV0dG9uXG4gICAgICAgICAgICBwbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICAgICAgLy8gc29ydGVkIGJ5IHJhbmtpbmcgOi0pXG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBsYXllci5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBQbGF5ZXIucGxheWVyT2JqZWN0O1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3VwZGF0ZS1wbGF5ZXInLCB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgICAgICB5OiBwLnBvc2l0aW9uLnksXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucG9zaXRpb24uelxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5yb3RhdGlvbi5feCxcbiAgICAgICAgICAgICAgICAgICAgeTogcC5yb3RhdGlvbi5feSxcbiAgICAgICAgICAgICAgICAgICAgejogcC5yb3RhdGlvbi5felxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCAxMDAwIC8gMjUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VDYXJPYmplY3QoKSB7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnVpbGRGbG9vcigpIHtcbiAgICAgICAgbGV0IGN1cnZlID0gbmV3IFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgLTUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAtNTAwLCAwKVxuICAgICAgICBdKTtcbiAgICAgICAgY3VydmUuY2xvc2VkID0gdHJ1ZTtcblxuICAgICAgICBsZXQgZXh0cnVkZVNldHRpbmdzID0ge1xuICAgICAgICAgICAgc3RlcHM6IDEwMCxcbiAgICAgICAgICAgIGV4dHJ1ZGVQYXRoOiBjdXJ2ZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFNoYXBlIHRoYXQgZ2V0cyBleHRydWRlZCB0aHJvdWdoIHRoZSBjdXJ2ZVxuICAgICAgICBsZXQgc2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMiAqIENBUl9TSVpFX1ksIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgNSAqIENBUl9TSVpFX1gpLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgLTUgKiBDQVJfU0laRV9YKVxuICAgICAgICBdKTtcblxuICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuRXh0cnVkZUdlb21ldHJ5KHNoYXBlLCBleHRydWRlU2V0dGluZ3MpO1xuXG4gICAgICAgIGxldCBtYXRlcmlhbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1CRVJfQ09MT1JTOyBpKyspIHtcbiAgICAgICAgICAgIG1hdGVyaWFscy5wdXNoKFxuICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBST0FEX0NPTE9SU1tpXSxcbiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSxcbiAgICAgICAgICAgICAgICAgICAgLy93aXJlZnJhbWU6IHRydWUgLy8gVGhpcyBtYWtlcyB0cmFjayBtb3JlIFRyb24tbGlrZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW9GYWNlc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaiA9IGkgKiAyOyAvLyA8LS0gQWRkZWQgdGhpcyBiYWNrIHNvIHdlIGNhbiBkbyBldmVyeSBvdGhlciAnZmFjZSdcblxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbal0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7XG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2ogKyAxXS5tYXRlcmlhbEluZGV4ID1cbiAgICAgICAgICAgICAgICAoaSArIE1hdGguZmxvb3IoaSAvIFdPUkxEX1NJREVfU0laRSkpICUgTlVNQkVSX0NPTE9SUzsgLy8gT3RoZXIgaGFsZiBvZiB0aGUgc2FtZSBmYWNlXG4gICAgICAgIH1cblxuICAgICAgICBmbG9vciA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbHMpO1xuICAgICAgICBmbG9vci5yb3RhdGVYKC1NYXRoLlBJIC8gMik7XG4gICAgICAgIGZsb29yLnBvc2l0aW9uLnkgPSAwO1xuXG4gICAgICAgIHNjZW5lLmFkZChmbG9vcik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQ2hlY2twb2ludHMoKSB7XG4gICAgICAgIGxldCBjdXJ2ZVBvaW50cyA9IFtcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMzAwLCAwLCA1ODApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMjUwLCAwLCAtMjAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDIwMCwgMCwgLTg3MCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtNTAwKSxcbiAgICAgICAgXTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnZlUG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjdXJ2ZVBvaW50c1tpXSk7XG4gICAgICAgICAgICBsZXQgY2hlY2sgPSBuZXcgQ2hlY2twb2ludChjdXJ2ZVBvaW50c1tpXS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnZlUG9pbnRzW2ldLnopO1xuICAgICAgICAgICAgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTtcbiAgICAgICAgICAgIC8vIGlmIChpICE9IGN1cnZlUG9pbnRzLmxlbmd0aC0xKSB7XG4gICAgICAgICAgICAgICAgY2hlY2twb2ludHMucHVzaChjaGVjayk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGNoZWNrLm1lc2gpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXMoKSB7XG4gICAgICAgIGxldCBtaW4gPSAtMjAwMDtcbiAgICAgICAgbGV0IG1heCA9ICAyMDAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSk7XG4gICAgICAgICAgICAvLyBBZGQgb25seSBpZiBpdCdzIG92ZXIgdGhlIGZsb29yLlxuICAgICAgICAgICAgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTtcbiAgICAgICAgICAgIFBoeXNpY3MuZ3Jhdml0eShib3gubWVzaCwgZmxvb3IpO1xuICAgICAgICAgICAgaWYgKGJveC5tZXNoLnBvc2l0aW9uLnkgPT0gQk9YX1NJWkUvMikge1xuICAgICAgICAgICAgICAgIG9iamVjdHMucHVzaChib3gpO1xuICAgICAgICAgICAgICAgIGJveGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB4OiBib3gubWVzaC5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgICAgICB6OiBib3gubWVzaC5wb3NpdGlvbi56XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGJveC5tZXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXNQb3NpdGlvbigpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib3hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChib3hlc1tpXS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveGVzW2ldLnopO1xuICAgICAgICAgICAgLy8gQWRkIG9ubHkgaWYgaXQncyBvdmVyIHRoZSBmbG9vci5cbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XG4gICAgICAgICAgICBQaHlzaWNzLmdyYXZpdHkoYm94Lm1lc2gsIGZsb29yKTtcbiAgICAgICAgICAgIGlmIChib3gubWVzaC5wb3NpdGlvbi55ID09IEJPWF9TSVpFLzIpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoYm94Lm1lc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEgsIFdJTkRPV19IRUlHSFQpO1xuICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgcmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhciA9IGZhbHNlO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICc1JSc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSAnNzAlJztcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJzInO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ3doaXRlIHNvbGlkJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnkgPSBUT1BfQ0FNRVJBX0RJU1Q7XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucm90YXRpb24ueCA9IC05MCAqIE1hdGguUEkgLyAxODA7XG5cbiAgICAgICAgYnVpbGRGbG9vcigpO1xuICAgICAgICAvLyBhZGRCb3hlcygpO1xuICAgICAgICBhZGRDaGVja3BvaW50cygpO1xuXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcbiAgICAgICAgaW5pdFNvY2tldEV2ZW50KCk7XG4gICAgICAgIGxvb3AoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb29wKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG5cbiAgICAgICAgcmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBQbGF5ZXIuZ2V0Q2FtZXJhKCkpO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5jbGVhcigpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRIIC8gNCwgV0lORE9XX0hFSUdIVCAvIDQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIucmVuZGVyKHNjZW5lLCBtaW5pTWFwQ2FtZXJhKTtcblxuICAgICAgICAvLyBmb3IgKGxldCBpZCBpbiBwbGF5ZXJzKSB7XG4gICAgICAgIC8vICAgICBjb25zdCBwID0gcGxheWVyc1tpZF07XG4gICAgICAgIC8vICAgICBjb25zdCBwb3MgPSBwLnBvc2l0aW9uO1xuICAgICAgICAvLyAgICAgY29uc3Qgcm90ID0gcC5yb3RhdGlvbjtcbiAgICAgICAgLy8gICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgLy8gICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIFBsYXllci5kb01vdmVtZW50TG9vcCgpO1xuICAgICAgICBpZiAoUGh5c2ljcy5kZXRlY3RDb2xsaXNpb24oUGxheWVyLnBsYXllck9iamVjdCwgb2JqZWN0cykpIHtcbiAgICAgICAgICAgIFBsYXllci5jcmFzaCgpO1xuICAgICAgICB9XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcblxuICAgICAgICBQaHlzaWNzLmdyYXZpdHkoUGxheWVyLnBsYXllck9iamVjdCwgZmxvb3IpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSkoKTtcbiJdfQ==
