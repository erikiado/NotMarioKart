"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,BOX_SIZE=10,Physics=function(){var e=-1,t=new THREE.Vector3(0,-TOP_CAMERA_DIST,0),o=new THREE.Vector3(0,1,0),n=new THREE.Raycaster;return{gravity:function(i,r){t.x=i.position.x,t.z=i.position.z,n.set(t,o),(!n.intersectObject(r,!0).length||i.position.y<0)&&(i.position.y+=e)},detectCollision:function(e,t){for(var o=(new THREE.Box3).setFromObject(e),n=0;n<t.length;n++)if(o.intersectsBox(t[n].boundingBox))return!0;return!1}}}(),Box=function(e,t,o){var n=new THREE.BoxGeometry(BOX_SIZE,BOX_SIZE,BOX_SIZE),i=new THREE.MeshBasicMaterial({color:11176004});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=o,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,i=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return t.position.y=2*e.scale.y,t.position.z=4*e.scale.z,t.rotateY(180*Math.PI/180),o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},a=r.movement.arrows,s=0,E=5,c=.05,l=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[a.up]&&s<E&&(s+=c),d[a.left]&&i.rotateY(l),d[a.right]&&i.rotateY(-l),d[a.down]&&s>0&&(s-=c,s=Math.max(0,s)),i.translateZ(s),d[r.switchCamera]&&(n=n===t?o:t,d[r.switchCamera]=!1),d[r.reset]&&(i.rotation.x=0,i.position.set(0,i.position.x,0),i.rotation.y=0,i.position.set(0,i.position.y,0),i.rotation.z=0,i.position.set(0,i.position.z,0))},playerObject:i,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}(),NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,i=t();d[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),a.add(i)})}),e.on("player-joined",function(e){console.log("[player-joined]",e);var o=e.position,n=e.rotation,i=t();d[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),a.add(i)}),e.on("player-left",function(e){console.log("[player-left]",e);var t=d[e].car;a.remove(t),delete d[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,i=d[t];i.car.position.set(o.x,o.y,o.z),i.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){console.log("[start-countdown]",e)}),e.on("start",function(){console.log("[start]")}),e.on("finished",function(e){console.log("[finished]",e)}),e.on("stop",function(e){console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var t=Player.playerObject;e.emit("update-player",{position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:t.rotation._x,y:t.rotation._y,z:t.rotation._z}})},1e3/24)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),i=[],s=0;s<NUMBER_COLORS;s++)i.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[s],side:THREE.DoubleSide}));for(var E=n.faces.length/2,c=0;c<E;c++){var l=2*c;n.faces[l].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[l+1].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS}(r=new THREE.Mesh(n,i)).rotateX(-Math.PI/2),r.position.y=0,a.add(r)}function n(){for(var e=0;e<1e3;e++){var t=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));a.updateMatrixWorld(),Physics.gravity(t.mesh,r),t.mesh.position.y==BOX_SIZE/2&&(l.push(t),a.add(t.mesh))}}function i(){requestAnimationFrame(i),s.clear(),s.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),s.render(a,Player.getCamera()),E.clear(),E.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),E.render(a,c),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,l)&&Player.crash(),c.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,r)}var r,a=new THREE.Scene,s=new THREE.WebGLRenderer,E=new THREE.WebGLRenderer,c=new THREE.OrthographicCamera(-WINDOW_WIDTH,WINDOW_WIDTH,WINDOW_HEIGHT,-WINDOW_HEIGHT,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),l=[],d={};return{init:function(){s.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),s.setPixelRatio(window.devicePixelRatio),s.domElement.style.position="fixed",document.body.appendChild(s.domElement),s.autoClear=!1,E.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),E.setPixelRatio(window.devicePixelRatio),E.domElement.style.position="fixed",E.domElement.style.top="5%",E.domElement.style.left="70%",E.domElement.style.zIndex="2",E.domElement.style.outline="white solid",document.body.appendChild(E.domElement),E.autoClear=!1,c.position.y=TOP_CAMERA_DIST,c.rotation.x=-90*Math.PI/180,o(),n(),a.add(Player.playerObject),e(),i()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBoeXNpY3MuanMiLCJCb3guanMiLCJQbGF5ZXIuanMiLCJOb3RNYXJpb0thcnQuanMiXSwibmFtZXMiOlsiV09STERfU0lERV9TSVpFIiwiV0lORE9XX0hFSUdIVCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiV0lORE9XX1dJRFRIIiwiaW5uZXJXaWR0aCIsIlJPQURfQ09MT1JTIiwiTlVNQkVSX0NPTE9SUyIsImxlbmd0aCIsIldPUkxEX0hFSUdIVCIsIldPUkxEX1dJRFRIIiwiVE9QX0NBTUVSQV9ESVNUIiwiQ0FSX1NJWkVfWCIsIkNBUl9TSVpFX1kiLCJDQVJfU0laRV9aIiwiQk9YX1NJWkUiLCJQaHlzaWNzIiwiZyIsImhlbGwiLCJUSFJFRSIsIlZlY3RvcjMiLCJvbmVEaXJlY3Rpb24iLCJyYXljYXN0ZXIiLCJSYXljYXN0ZXIiLCJncmF2aXR5Iiwib2JqZWN0IiwiZmxvb3IiLCJ4IiwicG9zaXRpb24iLCJ6Iiwic2V0IiwiaW50ZXJzZWN0T2JqZWN0IiwieSIsImRldGVjdENvbGxpc2lvbiIsImNhciIsIm9iamVjdHMiLCJjYXJCb3giLCJCb3gzIiwic2V0RnJvbU9iamVjdCIsImkiLCJpbnRlcnNlY3RzQm94IiwiYm91bmRpbmdCb3giLCJCb3giLCJnZW9tZXRyeSIsIkJveEdlb21ldHJ5IiwibWF0ZXJpYWwiLCJNZXNoQmFzaWNNYXRlcmlhbCIsImNvbG9yIiwidGhpcyIsIm1lc2giLCJNZXNoIiwiUGxheWVyIiwib25LZXlNb3ZlIiwiZSIsImV2ZW50Iiwia2V5Q29kZU1hcCIsIndoaWNoIiwidHlwZSIsInBvdkNhbWVyYSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwidHJhY2tpbmdDYW1lcmEiLCJjdXJyZW50Q2FtZXJhIiwicGxheWVyT2JqZWN0IiwiT2JqZWN0TG9hZGVyIiwicGFyc2UiLCJwbGF5ZXJDYXIiLCJzY2FsZSIsInJvdGF0ZVkiLCJNYXRoIiwiUEkiLCJhZGQiLCJtYWtlUGxheWVyT2JqZWN0IiwiY29udHJvbHMiLCJtb3ZlbWVudCIsImFycm93cyIsInVwIiwiZG93biIsImxlZnQiLCJyaWdodCIsIndhc2QiLCJzd2l0Y2hDYW1lcmEiLCJyZXNldCIsImVuYWJsZWRDb250cm9scyIsInNwZWVkIiwibWF4U3BlZWQiLCJhY2NlbGVyYXRpb24iLCJyb3RhdGlvblNwZWVkIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZG9Nb3ZlbWVudExvb3AiLCJtYXgiLCJ0cmFuc2xhdGVaIiwicm90YXRpb24iLCJnZXRDYW1lcmEiLCJwbGF5ZXJJZCIsImNyYXNoIiwiTm90TWFyaW9LYXJ0IiwiaW5pdFNvY2tldEV2ZW50Iiwic29ja2V0IiwiaW8iLCJ0cmFuc3BvcnRzIiwidXBncmFkZSIsIm9uIiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwicGxheWVyIiwicG9zIiwicm90IiwibWFrZUNhck9iamVjdCIsInBsYXllcnMiLCJpZCIsInNjZW5lIiwicmVtb3ZlIiwicCIsInNlY29uZHMiLCJ0aW1lIiwic3RvcCIsIm5hbWUiLCJzZXRJbnRlcnZhbCIsImVtaXQiLCJfeCIsIl95IiwiX3oiLCJidWlsZEZsb29yIiwiY3VydmUiLCJDYXRtdWxsUm9tQ3VydmUzIiwiY2xvc2VkIiwiZXh0cnVkZVNldHRpbmdzIiwic3RlcHMiLCJleHRydWRlUGF0aCIsInNoYXBlIiwiU2hhcGUiLCJWZWN0b3IyIiwiRXh0cnVkZUdlb21ldHJ5IiwibWF0ZXJpYWxzIiwicHVzaCIsInNpZGUiLCJEb3VibGVTaWRlIiwiZ2VvRmFjZXNMZW5ndGgiLCJmYWNlcyIsImoiLCJtYXRlcmlhbEluZGV4Iiwicm90YXRlWCIsImFkZEJveGVzIiwiYm94IiwicmFuZG9tIiwidXBkYXRlTWF0cml4V29ybGQiLCJsb29wIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyZXIiLCJjbGVhciIsInNldFZpZXdwb3J0IiwicmVuZGVyIiwibWluaU1hcFJlbmRlcmVyIiwibWluaU1hcENhbWVyYSIsIlNjZW5lIiwiV2ViR0xSZW5kZXJlciIsIk9ydGhvZ3JhcGhpY0NhbWVyYSIsImluaXQiLCJzZXRTaXplIiwic2V0UGl4ZWxSYXRpbyIsImRldmljZVBpeGVsUmF0aW8iLCJkb21FbGVtZW50Iiwic3R5bGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJhdXRvQ2xlYXIiLCJ0b3AiLCJ6SW5kZXgiLCJvdXRsaW5lIl0sIm1hcHBpbmdzIjoiYUFJQSxJQUFNQSxnQkFBa0IsRUFDbEJDLGNBQWdCQyxPQUFPQyxZQUN2QkMsYUFBZUYsT0FBT0csV0FDdEJDLGFBQ0YsU0FDQSxTQUNBLFNBQ0EsTUFDQSxNQUNBLElBQ0EsVUFFRUMsY0FBZ0JELFlBQVlFLE9BQzVCQyxhQUFlLElBQ2ZDLFlBQWMsSUFDZEMsZ0JBQWtCLEdBQ2xCQyxXQUFhLEdBQ2JDLFdBQWEsR0FDYkMsV0FBYSxHQUNiQyxTQUFXLEdDbkJYQyxRQUFXLFdBRWIsSUFBTUMsR0FBSyxFQUNQQyxFQUFPLElBQUlDLE1BQU1DLFFBQVEsR0FBSVQsZ0JBQWlCLEdBQzlDVSxFQUFlLElBQUlGLE1BQU1DLFFBQVEsRUFBRyxFQUFHLEdBQ3ZDRSxFQUFZLElBQUlILE1BQU1JLFVBeUIxQixPQUNJQyxRQXhCSixTQUFpQkMsRUFBUUMsR0FFckJSLEVBQUtTLEVBQUlGLEVBQU9HLFNBQVNELEVBQ3pCVCxFQUFLVyxFQUFJSixFQUFPRyxTQUFTQyxFQUN6QlAsRUFBVVEsSUFBSVosRUFBTUcsS0FHSEMsRUFBVVMsZ0JBQWdCTCxHQUFPLEdBQ2xDbEIsUUFBVWlCLEVBQU9HLFNBQVNJLEVBQUksS0FDMUNQLEVBQU9HLFNBQVNJLEdBQUtmLElBZ0J6QmdCLGdCQVpKLFNBQXlCQyxFQUFLQyxHQUUxQixJQUFLLElBRERDLEdBQVMsSUFBSWpCLE1BQU1rQixNQUFPQyxjQUFjSixHQUNuQ0ssRUFBSSxFQUFHQSxFQUFJSixFQUFRM0IsT0FBUStCLElBQ2hDLEdBQUlILEVBQU9JLGNBQWNMLEVBQVFJLEdBQUdFLGFBQ2hDLE9BQU8sRUFHZixPQUFPLElBM0JFLEdDRFhDLElBQU8sU0FB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SSxvQkFDM0IzSixhQUNEQSxhQUNBSCxlQUNDQSxjQUNEVSxnQkFBa0IsR0FDbEJBLGdCQUFrQixJQUdsQndCLEtBRUU0RSxLQWlQTixPQUNJaUQsS0F6REosV0FDSVQsRUFBU1UsUUFBUTdKLGFBQWNILGVBQy9Cc0osRUFBU1csY0FBY2hLLE9BQU9pSyxrQkFDOUJaLEVBQVNhLFdBQVdDLE1BQU16SSxTQUFXLFFBQ3JDMkQsU0FBUytFLEtBQUtDLFlBQVloQixFQUFTYSxZQUNuQ2IsRUFBU2lCLFdBQVksRUFFckJiLEVBQWdCTSxRQUFRN0osYUFBZSxFQUFHSCxjQUFnQixHQUMxRDBKLEVBQWdCTyxjQUFjaEssT0FBT2lLLGtCQUNyQ1IsRUFBZ0JTLFdBQVdDLE1BQU16SSxTQUFXLFFBQzVDK0gsRUFBZ0JTLFdBQVdDLE1BQU1JLElBQU0sS0FDdkNkLEVBQWdCUyxXQUFXQyxNQUFNeEYsS0FBTyxNQUN4QzhFLEVBQWdCUyxXQUFXQyxNQUFNSyxPQUFTLElBQzFDZixFQUFnQlMsV0FBV0MsTUFBTU0sUUFBVSxjQUMzQ3BGLFNBQVMrRSxLQUFLQyxZQUFZWixFQUFnQlMsWUFDMUNULEVBQWdCYSxXQUFZLEVBRTVCWixFQUFjaEksU0FBU0ksRUFBSXJCLGdCQUMzQmlKLEVBQWNoRSxTQUFTakUsR0FBSyxHQUFLeUMsS0FBS0MsR0FBSyxJQUUzQ3dELElBQ0FvQixJQUVBaEMsRUFBTTNDLElBQUluQixPQUFPVyxjQUNqQm1DLElBQ0FvRCxNQWpPYyIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cbiAqL1xuXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xuY29uc3QgV0lORE9XX0hFSUdIVCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbmNvbnN0IFdJTkRPV19XSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuY29uc3QgUk9BRF9DT0xPUlMgPSBbXG4gICAgMHhmZjAwMDAsXG4gICAgMHhmZjg4MDAsXG4gICAgMHhmZmZmMDAsXG4gICAgMHgwMGZmMDAsXG4gICAgMHgwMGZmZmYsXG4gICAgMHgwMDAwZmYsXG4gICAgMHhmZjAwZmZcbl07XG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xuY29uc3QgV09STERfSEVJR0hUID0gMTAwMDtcbmNvbnN0IFdPUkxEX1dJRFRIID0gMTAwO1xuY29uc3QgVE9QX0NBTUVSQV9ESVNUID0gNTA7XG5jb25zdCBDQVJfU0laRV9YID0gMTA7XG5jb25zdCBDQVJfU0laRV9ZID0gMTA7XG5jb25zdCBDQVJfU0laRV9aID0gMTA7XG5jb25zdCBCT1hfU0laRSA9IDEwO1xuIiwiLyoqXG4gKiBQaHlzaWNzIFwiZW5naW5lXCIgZm9yIHRoZSBnYW1lLlxuICogTm90UGh5c2lqcyBmb3IgTm90TWFyaW9LYXJ0LlxuICovXG5jb25zdCBQaHlzaWNzID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgZyA9IC0xO1xuICAgIGxldCBoZWxsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgLVRPUF9DQU1FUkFfRElTVCwgMCk7XG4gICAgbGV0IG9uZURpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApO1xuICAgIGxldCByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7XG5cbiAgICBmdW5jdGlvbiBncmF2aXR5KG9iamVjdCwgZmxvb3IpIHtcbiAgICAgICAgLy8gVXBkYXRlIHJheWNhc3RlciB3aXRoIGFuIG9yaWdpbiBiZWxvdyB0aGUgb2JqZWN0LlxuICAgICAgICBoZWxsLnggPSBvYmplY3QucG9zaXRpb24ueDtcbiAgICAgICAgaGVsbC56ID0gb2JqZWN0LnBvc2l0aW9uLno7XG4gICAgICAgIHJheWNhc3Rlci5zZXQoaGVsbCwgb25lRGlyZWN0aW9uKTtcblxuICAgICAgICAvLyBUcnkgdG8gaW50ZXJzZWN0IHdpdGggZmxvb3IuXG4gICAgICAgIGxldCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdChmbG9vciwgdHJ1ZSk7XG4gICAgICAgIGlmICghaW50ZXJzZWN0cy5sZW5ndGggfHwgb2JqZWN0LnBvc2l0aW9uLnkgPCAwKSB7XG4gICAgICAgICAgICBvYmplY3QucG9zaXRpb24ueSArPSBnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGV0ZWN0Q29sbGlzaW9uKGNhciwgb2JqZWN0cykge1xuICAgICAgICBsZXQgY2FyQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KGNhcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGNhckJveC5pbnRlcnNlY3RzQm94KG9iamVjdHNbaV0uYm91bmRpbmdCb3gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdyYXZpdHk6IGdyYXZpdHksXG4gICAgICAgIGRldGVjdENvbGxpc2lvbjogZGV0ZWN0Q29sbGlzaW9uXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEJveGVzIHJlcHJlc2VudGluZyBvYnN0YWNsZXMuXG4gKi9cbmNvbnN0IEJveCA9IChmdW5jdGlvbih4LCB5LCB6KSB7XG4gICAgbGV0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCBCT1hfU0laRSwgQk9YX1NJWkUsIEJPWF9TSVpFICk7XG4gICAgbGV0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7Y29sb3I6IDB4YWE4ODQ0fSApO1xuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueCA9IHg7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSB5O1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gejtcbiAgICB0aGlzLmJvdW5kaW5nQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KHRoaXMubWVzaCk7XG59KTtcbiIsIi8qKlxuICogRXZlcnl0aGluZyBhYm91dCB0aGUgUGxheWVyIG9iamVjdCwgaXRzIGNhbWVyYSwgdGhlIG1vdmVtZW50cyAuLi5cbiAqL1xuXG5jb25zdCBQbGF5ZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgcG92Q2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgICA3NSxcbiAgICAgICAgV0lORE9XX1dJRFRIIC8gV0lORE9XX0hFSUdIVCxcbiAgICAgICAgMC4xLFxuICAgICAgICAxMDAwXG4gICAgKTtcblxuICAgIGNvbnN0IHRyYWNraW5nQ2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgICA3NSxcbiAgICAgICAgV0lORE9XX1dJRFRIIC8gV0lORE9XX0hFSUdIVCxcbiAgICAgICAgMC4xLFxuICAgICAgICAxMDAwXG4gICAgKTtcblxuICAgIGxldCBjdXJyZW50Q2FtZXJhID0gdHJhY2tpbmdDYW1lcmE7XG4gICAgbGV0IGdldENhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gY3VycmVudENhbWVyYTtcbiAgICB9O1xuXG4gICAgY29uc3QgcGxheWVyT2JqZWN0ID0gbWFrZVBsYXllck9iamVjdCgpO1xuICAgIHZhciBwbGF5ZXJJZCA9IG51bGw7XG5cbiAgICBjb25zdCBjb250cm9scyA9IHtcbiAgICAgICAgbW92ZW1lbnQ6IHtcbiAgICAgICAgICAgIGFycm93czoge1xuICAgICAgICAgICAgICAgIHVwOiAzOCxcbiAgICAgICAgICAgICAgICBkb3duOiA0MCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAzNyxcbiAgICAgICAgICAgICAgICByaWdodDogMzlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXNkOiB7XG4gICAgICAgICAgICAgICAgdXA6IDg3LFxuICAgICAgICAgICAgICAgIGRvd246IDgzLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDY1LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiA2OFxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzd2l0Y2hDYW1lcmE6IDY3LFxuICAgICAgICByZXNldDogOFxuICAgIH07XG5cbiAgICBsZXQgZW5hYmxlZENvbnRyb2xzID0gY29udHJvbHMubW92ZW1lbnQuYXJyb3dzO1xuXG4gICAgbGV0IHNwZWVkID0gMDtcbiAgICBsZXQgbWF4U3BlZWQgPSA1O1xuICAgIGNvbnN0IGFjY2VsZXJhdGlvbiA9IDAuMDU7XG4gICAgY29uc3Qgcm90YXRpb25TcGVlZCA9IDAuMDU7XG5cbiAgICBjb25zdCBrZXlDb2RlTWFwID0ge307XG5cbiAgICBmdW5jdGlvbiBvbktleU1vdmUoZSkge1xuICAgICAgICBlID0gZSB8fCBldmVudDsgLy8gRm9yIElFLlxuICAgICAgICBrZXlDb2RlTWFwW2Uud2hpY2hdID0gZS50eXBlID09PSAna2V5ZG93bic7XG4gICAgfVxuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5TW92ZSwgZmFsc2UpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgb25LZXlNb3ZlLCBmYWxzZSk7XG5cbiAgICBmdW5jdGlvbiBkb01vdmVtZW50TG9vcCgpIHtcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLnVwXSkge1xuICAgICAgICAgICAgaWYgKHNwZWVkIDwgbWF4U3BlZWQpIHtcbiAgICAgICAgICAgICAgICBzcGVlZCArPSBhY2NlbGVyYXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmxlZnRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRlWShyb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMucmlnaHRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRlWSgtcm90YXRpb25TcGVlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmRvd25dKSB7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgc3BlZWQgLT0gYWNjZWxlcmF0aW9uO1xuICAgICAgICAgICAgICAgIHNwZWVkID0gTWF0aC5tYXgoMCwgc3BlZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMuc3dpdGNoQ2FtZXJhXSkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRDYW1lcmEgPT09IHBvdkNhbWVyYSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHBvdkNhbWVyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGtleUNvZGVNYXBbY29udHJvbHMuc3dpdGNoQ2FtZXJhXSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnJlc2V0XSkge1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnggPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueCwgMCk7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueSA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi55LCAwKTtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGlvbi56ID0gMDtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnosIDApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3Jhc2goKSB7XG4gICAgICAgIC8vIGFjY2VsZXJhdGlvbiA9IDA7XG4gICAgICAgIHNwZWVkID0gMDtcbiAgICAgICAgLy8gaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLnVwXSkge1xuICAgICAgICAvLyAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooLXNwZWVkKTtcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgLy8gICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIC8vIGZvciAodmFyIGkgPSBncm91cEJsb2Nrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAvLyBsZXQgcG9zID0gZ3JvdXBCbG9ja3NbaV0ucG9zaXRpb247XG4gICAgICAgIC8vICAgICBsZXQgcG8gPSBwbGF5ZXJPYmplY3QuY2hpbGRyZW5bMl0uY2hpbGRyZW5bMF1cbiAgICAgICAgLy8gZm9yICh2YXIgdmVydGV4SW5kZXggPSAwOyB2ZXJ0ZXhJbmRleCA8IHBvLmdlb21ldHJ5LnZlcnRpY2VzLmxlbmd0aDsgdmVydGV4SW5kZXgrKylcbiAgICAgICAgLy8ge1xuICAgICAgICAvLyAgICAgdmFyIGxvY2FsVmVydGV4ID0gcG8uZ2VvbWV0cnkudmVydGljZXNbdmVydGV4SW5kZXhdLmNsb25lKCk7XG4gICAgICAgIC8vICAgICB2YXIgZ2xvYmFsVmVydGV4ID0gbG9jYWxWZXJ0ZXguYXBwbHlNYXRyaXhwbGF5ZXJPYmplY3QubWF0cml4Lm11bHRpcGx5VmVjdG9yMygpO1xuICAgICAgICAvLyAgICAgdmFyIGRpcmVjdGlvblZlY3RvciA9IGdsb2JhbFZlcnRleC5zdWJTZWxmKCBwby5wb3NpdGlvbiApO1xuXG4gICAgICAgIC8vICAgICB2YXIgcmF5ID0gbmV3IFRIUkVFLlJheSggcG8ucG9zaXRpb24sIGRpcmVjdGlvblZlY3Rvci5jbG9uZSgpLm5vcm1hbGl6ZSgpICk7XG4gICAgICAgIC8vICAgICB2YXIgY29sbGlzaW9uUmVzdWx0cyA9IHJheS5pbnRlcnNlY3RPYmplY3RzKCBncm91cEJsb2NrcyApO1xuICAgICAgICAvLyAgICAgaWYgKCBjb2xsaXNpb25SZXN1bHRzLmxlbmd0aCA+IDAgJiYgY29sbGlzaW9uUmVzdWx0c1swXS5kaXN0YW5jZSA8IGRpcmVjdGlvblZlY3Rvci5sZW5ndGgoKSApXG4gICAgICAgIC8vICAgICB7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coJ3BlcmRpc3RyZScpXG4gICAgICAgIC8vICAgICAgICAgLy8gYSBjb2xsaXNpb24gb2NjdXJyZWQuLi4gZG8gc29tZXRoaW5nLi4uXG4gICAgICAgIC8vICAgICB9XG4gICAgICAgIC8vIH1cbiAgICAgICAgLy8gaWYoKHBsYXllck9iamVjdC5wb3NpdGlvbi54KzUgPCBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1IDwgcG9zLnopfHwgKHBsYXllck9iamVjdC5wb3NpdGlvbi54LTUgPiBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1ID4gcG9zLnopKVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhncm91cEJsb2Nrc1tpXSlcbiAgICAgICAgLy8gfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VQbGF5ZXJPYmplY3QoKSB7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XG5cbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnkgPSBvYmplY3Quc2NhbGUueSAqIDI7XG4gICAgICAgIHBvdkNhbWVyYS5wb3NpdGlvbi56ID0gb2JqZWN0LnNjYWxlLnogKiA0O1xuICAgICAgICAvLyB0cmFja2luZ0NhbWVyYS5yb3RhdGVYKDAgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgICAgcG92Q2FtZXJhLnJvdGF0ZVkoMTgwICogTWF0aC5QSSAvIDE4MCk7XG5cbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMTA7XG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIC0yMDtcbiAgICAgICAgLy8gdHJhY2tpbmdDYW1lcmEucm90YXRlWCgwICogTWF0aC5QSSAvIDE4MCk7XG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVkoMTgwICogTWF0aC5QSSAvIDE4MCk7XG5cbiAgICAgICAgb2JqZWN0LmFkZChwb3ZDYW1lcmEpO1xuICAgICAgICBvYmplY3QuYWRkKHRyYWNraW5nQ2FtZXJhKTtcblxuICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGRvTW92ZW1lbnRMb29wOiBkb01vdmVtZW50TG9vcCxcbiAgICAgICAgcGxheWVyT2JqZWN0OiBwbGF5ZXJPYmplY3QsXG4gICAgICAgIGdldENhbWVyYTogZ2V0Q2FtZXJhLFxuICAgICAgICBwbGF5ZXJJZDogcGxheWVySWQsXG4gICAgICAgIGNyYXNoOiBjcmFzaFxuICAgIH07XG59KSgpO1xuIiwiLyoqXG4gKiBNYWluIGZpbGUgb2YgdGhlIGdhbWUuXG4gKi9cblxuY29uc3QgTm90TWFyaW9LYXJ0ID0gKGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgY29uc3QgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgIGNvbnN0IG1pbmlNYXBSZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgY29uc3QgbWluaU1hcENhbWVyYSA9IG5ldyBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEoXG4gICAgICAgIC1XSU5ET1dfV0lEVEgsXG4gICAgICAgIFdJTkRPV19XSURUSCxcbiAgICAgICAgV0lORE9XX0hFSUdIVCxcbiAgICAgICAgLVdJTkRPV19IRUlHSFQsXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCAtIDUwLFxuICAgICAgICBUT1BfQ0FNRVJBX0RJU1QgKyA1MFxuICAgICk7XG4gICAgdmFyIGZsb29yO1xuICAgIHZhciBvYmplY3RzID0gW107XG5cbiAgICBjb25zdCBwbGF5ZXJzID0ge307XG5cbiAgICBmdW5jdGlvbiBpbml0U29ja2V0RXZlbnQoKSB7XG4gICAgICAgIHZhciBzb2NrZXQgPSBpbyh7IHRyYW5zcG9ydHM6IFsnd2Vic29ja2V0J10sIHVwZ3JhZGU6IGZhbHNlIH0pO1xuXG4gICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgd2l0aCBuYW1lIGZvcm0sIHRoZW4gZW1pdCBuYW1lXG5cbiAgICAgICAgc29ja2V0Lm9uKCdhbGwtcGxheWVycycsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWxsLXBsYXllcnNdJywgZGF0YSk7XG4gICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgcGxheWVyc1twbGF5ZXIuaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zLFxuICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxuICAgICAgICAgICAgICAgICAgICBjYXI6IGNhclxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgICAgICBjYXIucm90YXRpb24uc2V0KHJvdC54LCByb3QueSwgcm90LnopO1xuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChjYXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWpvaW5lZCcsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItam9pbmVkXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XG4gICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxuICAgICAgICAgICAgICAgIGNhcjogY2FyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItbGVmdCcsIGZ1bmN0aW9uKHBsYXllcklkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3BsYXllci1sZWZ0XScsIHBsYXllcklkKTtcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IHBsYXllcnNbcGxheWVySWRdLmNhcjtcbiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShjYXIpO1xuICAgICAgICAgICAgZGVsZXRlIHBsYXllcnNbcGxheWVySWRdO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3VwZGF0ZS1wbGF5ZXInLCBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbdXBkYXRlLXBsYXllcl0nLCBwbGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgaWQgPSBwbGF5ZXIuaWQ7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICBjb25zdCBwID0gcGxheWVyc1tpZF07XG4gICAgICAgICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQtY291bnRkb3duJywgZnVuY3Rpb24oc2Vjb25kcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydC1jb3VudGRvd25dJywgc2Vjb25kcyk7XG4gICAgICAgICAgICAvLyBUT0RPOiBzaG93IFwieCBzZWNvbmRzIGJlZm9yZSBzdGFydFwiXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RhcnRdJyk7XG4gICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdGhlIGdhbWUgaGFzIHN0YXJ0ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IGRpc2FibGUgbW92aW5nIGlmIG5vdCBzdGFydGVkXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyBhIG5hbWUgZmlyc3QgKGRvbid0IGhpZGUgbW9kYWwpXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyB0byBiZSByZWFkeVxuICAgICAgICAgICAgLy8gVE9ETzogMisgcGxheWVyc1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ2ZpbmlzaGVkJywgZnVuY3Rpb24odGltZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tmaW5pc2hlZF0nLCB0aW1lKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgXCJ3YWl0aW5nIGZvciBvdGhlcnMsIHlvdXIgdGltZSBpcyB4XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdG9wJywgZnVuY3Rpb24ocGxheWVycykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdG9wXScsIHN0b3ApO1xuICAgICAgICAgICAgLy8gVE9ETzogYWxsIHBsYXllcnMgYXJlIGZpbmlzaGVkLCBzaG93IHJhbmtpbmcgYW5kIHBsYXkgYWdhaW4gYnV0dG9uXG4gICAgICAgICAgICBwbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICAgICAgLy8gc29ydGVkIGJ5IHJhbmtpbmcgOi0pXG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBsYXllci5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBQbGF5ZXIucGxheWVyT2JqZWN0O1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3VwZGF0ZS1wbGF5ZXInLCB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgICAgICB5OiBwLnBvc2l0aW9uLnksXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucG9zaXRpb24uelxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5yb3RhdGlvbi5feCxcbiAgICAgICAgICAgICAgICAgICAgeTogcC5yb3RhdGlvbi5feSxcbiAgICAgICAgICAgICAgICAgICAgejogcC5yb3RhdGlvbi5felxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCAxMDAwIC8gMjQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VDYXJPYmplY3QoKSB7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnVpbGRGbG9vcigpIHtcbiAgICAgICAgbGV0IGN1cnZlID0gbmV3IFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgLTUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAtNTAwLCAwKVxuICAgICAgICBdKTtcbiAgICAgICAgY3VydmUuY2xvc2VkID0gdHJ1ZTtcblxuICAgICAgICBsZXQgZXh0cnVkZVNldHRpbmdzID0ge1xuICAgICAgICAgICAgc3RlcHM6IDEwMCxcbiAgICAgICAgICAgIGV4dHJ1ZGVQYXRoOiBjdXJ2ZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFNoYXBlIHRoYXQgZ2V0cyBleHRydWRlZCB0aHJvdWdoIHRoZSBjdXJ2ZVxuICAgICAgICBsZXQgc2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMiAqIENBUl9TSVpFX1ksIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgNSAqIENBUl9TSVpFX1gpLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgLTUgKiBDQVJfU0laRV9YKVxuICAgICAgICBdKTtcblxuICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuRXh0cnVkZUdlb21ldHJ5KHNoYXBlLCBleHRydWRlU2V0dGluZ3MpO1xuXG4gICAgICAgIGxldCBtYXRlcmlhbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1CRVJfQ09MT1JTOyBpKyspIHtcbiAgICAgICAgICAgIG1hdGVyaWFscy5wdXNoKFxuICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBST0FEX0NPTE9SU1tpXSxcbiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSxcbiAgICAgICAgICAgICAgICAgICAgLy93aXJlZnJhbWU6IHRydWUgLy8gVGhpcyBtYWtlcyB0cmFjayBtb3JlIFRyb24tbGlrZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW9GYWNlc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaiA9IGkgKiAyOyAvLyA8LS0gQWRkZWQgdGhpcyBiYWNrIHNvIHdlIGNhbiBkbyBldmVyeSBvdGhlciAnZmFjZSdcblxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbal0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7XG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2ogKyAxXS5tYXRlcmlhbEluZGV4ID1cbiAgICAgICAgICAgICAgICAoaSArIE1hdGguZmxvb3IoaSAvIFdPUkxEX1NJREVfU0laRSkpICUgTlVNQkVSX0NPTE9SUzsgLy8gT3RoZXIgaGFsZiBvZiB0aGUgc2FtZSBmYWNlXG4gICAgICAgIH1cblxuICAgICAgICBmbG9vciA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbHMpO1xuICAgICAgICBmbG9vci5yb3RhdGVYKC1NYXRoLlBJIC8gMik7XG4gICAgICAgIGZsb29yLnBvc2l0aW9uLnkgPSAwO1xuXG4gICAgICAgIHNjZW5lLmFkZChmbG9vcik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXMoKSB7XG4gICAgICAgIGxldCBtaW4gPSAtMjAwMDtcbiAgICAgICAgbGV0IG1heCA9ICAyMDAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSk7XG5cbiAgICAgICAgICAgIC8vIEFkZCBvbmx5IGlmIGl0J3Mgb3ZlciB0aGUgZmxvb3IuXG4gICAgICAgICAgICBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpO1xuICAgICAgICAgICAgUGh5c2ljcy5ncmF2aXR5KGJveC5tZXNoLCBmbG9vcik7XG4gICAgICAgICAgICBpZiAoYm94Lm1lc2gucG9zaXRpb24ueSA9PSBCT1hfU0laRS8yKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0cy5wdXNoKGJveCk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGJveC5tZXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIHJlbmRlcmVyLnNldFNpemUoV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcbiAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICByZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEggLyA0LCBXSU5ET1dfSEVJR0hUIC8gNCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS50b3AgPSAnNSUnO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzcwJSc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnpJbmRleCA9ICcyJztcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUub3V0bGluZSA9ICd3aGl0ZSBzb2xpZCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XG5cbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi55ID0gVE9QX0NBTUVSQV9ESVNUO1xuICAgICAgICBtaW5pTWFwQ2FtZXJhLnJvdGF0aW9uLnggPSAtOTAgKiBNYXRoLlBJIC8gMTgwO1xuXG4gICAgICAgIGJ1aWxkRmxvb3IoKTtcbiAgICAgICAgYWRkQm94ZXMoKTtcblxuICAgICAgICBzY2VuZS5hZGQoUGxheWVyLnBsYXllck9iamVjdCk7XG4gICAgICAgIGluaXRTb2NrZXRFdmVudCgpO1xuICAgICAgICBsb29wKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9vcCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xuXG4gICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgUGxheWVyLmdldENhbWVyYSgpKTtcblxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnJlbmRlcihzY2VuZSwgbWluaU1hcENhbWVyYSk7XG5cbiAgICAgICAgLy8gZm9yIChsZXQgaWQgaW4gcGxheWVycykge1xuICAgICAgICAvLyAgICAgY29uc3QgcCA9IHBsYXllcnNbaWRdO1xuICAgICAgICAvLyAgICAgY29uc3QgcG9zID0gcC5wb3NpdGlvbjtcbiAgICAgICAgLy8gICAgIGNvbnN0IHJvdCA9IHAucm90YXRpb247XG4gICAgICAgIC8vICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgIC8vICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgIC8vIH1cblxuICAgICAgICBQbGF5ZXIuZG9Nb3ZlbWVudExvb3AoKTtcbiAgICAgICAgaWYgKFBoeXNpY3MuZGV0ZWN0Q29sbGlzaW9uKFBsYXllci5wbGF5ZXJPYmplY3QsIG9iamVjdHMpKSB7XG4gICAgICAgICAgICBQbGF5ZXIuY3Jhc2goKTtcbiAgICAgICAgfVxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnogPSBQbGF5ZXIucGxheWVyT2JqZWN0LnBvc2l0aW9uLno7XG5cbiAgICAgICAgUGh5c2ljcy5ncmF2aXR5KFBsYXllci5wbGF5ZXJPYmplY3QsIGZsb29yKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0pKCk7XG4iXX0=
