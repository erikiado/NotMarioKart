"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,a=t();E[e.id]={position:o,rotation:n,car:a},a.position.set(o.x,o.y,o.z),a.rotation.set(n.x,n.y,n.z),r.add(a)})}),e.on("player-joined",function(e){toastr.success("player "+e.id+" has joined."),console.log("[player-joined]",e);var o=e.position,n=e.rotation,a=t();E[e.id]={position:o,rotation:n,car:a},a.position.set(o.x,o.y,o.z),a.rotation.set(n.x,n.y,n.z),r.add(a)}),e.on("player-left",function(e){toastr.error("Player "+e+" has left."),console.log("[player-left]",e);var t=E[e].car;r.remove(t),delete E[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,r=E[t];r.car.position.set(o.x,o.y,o.z),r.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){toastr.info(e+" seconds before the race starts."),console.log("[start-countdown]",e)}),e.on("start",function(){toastr.info("The race has started."),console.log("[start]")}),e.on("finished",function(e){toastr.info("You finished."),console.log("[finished]",e)}),e.on("stop",function(e){toaster.info("The race is over."),console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var t=Player.playerObject;e.emit("update-player",{position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:t.rotation._x,y:t.rotation._y,z:t.rotation._z}})},12.5)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),a=[],i=0;i<NUMBER_COLORS;i++)a.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[i],side:THREE.DoubleSide}));for(var s=n.faces.length/2,E=0;E<s;E++){var l=2*E;n.faces[l].materialIndex=(E+Math.floor(E/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[l+1].materialIndex=(E+Math.floor(E/WORLD_SIDE_SIZE))%NUMBER_COLORS}var c=new THREE.Mesh(n,a);c.rotateX(-Math.PI/2),c.position.y=0,r.add(c)}function n(){requestAnimationFrame(n),a.clear(),a.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),a.render(r,Player.getCamera()),i.clear(),i.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),i.render(r,s),Player.doMovementLoop(),s.position.z=Player.playerObject.position.z}var r=new THREE.Scene,a=new THREE.WebGLRenderer,i=new THREE.WebGLRenderer,s=new THREE.OrthographicCamera(-WINDOW_WIDTH,WINDOW_WIDTH,WINDOW_HEIGHT,-WINDOW_HEIGHT,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),E={};return{init:function(){a.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),a.setPixelRatio(window.devicePixelRatio),a.domElement.style.position="fixed",document.body.appendChild(a.domElement),a.autoClear=!1,i.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),i.setPixelRatio(window.devicePixelRatio),i.domElement.style.position="fixed",i.domElement.style.top="5%",i.domElement.style.left="70%",i.domElement.style.zIndex="2",i.domElement.style.outline="white solid",document.body.appendChild(i.domElement),i.autoClear=!1,s.position.y=TOP_CAMERA_DIST,s.rotation.x=-90*Math.PI/180,o(),r.add(Player.playerObject),e(),n()}}}(),Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,r=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),a={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},i=a.movement.arrows,s=0,E=5,l=.05,c=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[i.up]&&s<E&&(s+=l),d[i.left]&&r.rotateY(c),d[i.right]&&r.rotateY(-c),d[i.down]&&s>0&&(s-=l,s=Math.max(0,s)),r.translateZ(s),d[a.switchCamera]&&(n=n===t?o:t,d[a.switchCamera]=!1),d[a.reset]&&(r.rotation.y=0,r.position.set(0,r.position.y,0))},playerObject:r,getCamera:function(){return n},playerId:null}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIk5vdE1hcmlvS2FydC5qcyIsIlBsYXllci5qcyJdLCJuYW1lcyI6WyJXT1JMRF9TSURFX1NJWkUiLCJXSU5ET1dfSEVJR0hUIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJXSU5ET1dfV0lEVEgiLCJpbm5lcldpZHRoIiwiUk9BRF9DT0xPUlMiLCJOVU1CRVJfQ09MT1JTIiwibGVuZ3RoIiwiV09STERfSEVJR0hUIiwiV09STERfV0lEVEgiLCJUT1BfQ0FNRVJBX0RJU1QiLCJDQVJfU0laRV9YIiwiQ0FSX1NJWkVfWSIsIkNBUl9TSVpFX1oiLCJOb3RNYXJpb0thcnQiLCJpbml0U29ja2V0RXZlbnQiLCJzb2NrZXQiLCJpbyIsInRyYW5zcG9ydHMiLCJ1cGdyYWRlIiwib24iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJwbGF5ZXIiLCJwb3MiLCJwb3NpdGlvbiIsInJvdCIsInJvdGF0aW9uIiwiY2FyIiwibWFrZUNhck9iamVjdCIsInBsYXllcnMiLCJpZCIsInNldCIsIngiLCJ5IiwieiIsInNjZW5lIiwiYWRkIiwidG9hc3RyIiwic3VjY2VzcyIsInBsYXllcklkIiwiZXJyb3IiLCJyZW1vdmUiLCJwIiwic2Vjb25kcyIsImluZm8iLCJ0aW1lIiwidG9hc3RlciIsInN0b3AiLCJuYW1lIiwic2V0SW50ZXJ2YWwiLCJQbGF5ZXIiLCJwbGF5ZXJPYmplY3QiLCJlbWl0IiwiX3giLCJfeSIsIl96IiwiVEhSRUUiLCJPYmplY3RMb2FkZXIiLCJwYXJzZSIsInBsYXllckNhciIsImJ1aWxkRmxvb3IiLCJjdXJ2ZSIsIkNhdG11bGxSb21DdXJ2ZTMiLCJWZWN0b3IzIiwiY2xvc2VkIiwiZXh0cnVkZVNldHRpbmdzIiwic3RlcHMiLCJleHRydWRlUGF0aCIsInNoYXBlIiwiU2hhcGUiLCJWZWN0b3IyIiwiZ2VvbWV0cnkiLCJFeHRydWRlR2VvbWV0cnkiLCJtYXRlcmlhbHMiLCJpIiwicHVzaCIsIk1lc2hCYXNpY01hdGVyaWFsIiwiY29sb3IiLCJzaWRlIiwiRG91YmxlU2lkZSIsImdlb0ZhY2VzTGVuZ3RoIiwiZmFjZXMiLCJqIiwibWF0ZXJpYWxJbmRleCIsIk1hdGgiLCJmbG9vciIsIk1lc2giLCJyb3RhdGVYIiwiUEkiLCJsb29wIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyZXIiLCJjbGVhciIsInNldFZpZXdwb3J0IiwicmVuZGVyIiwiZ2V0Q2FtZXJhIiwibWluaU1hcFJlbmRlcmVyIiwibWluaU1hcENhbWVyYSIsImRvTW92ZW1lbnRMb29wIiwiU2NlbmUiLCJXZWJHTFJlbmRlcmVyIiwiT3J0aG9ncmFwaGljQ2FtZXJhIiwiaW5pdCIsInNldFNpemUiLCJzZXRQaXhlbFJhdGlvIiwiZGV2aWNlUGl4ZWxSYXRpbyIsImRvbUVsZW1lbnQiLCJzdHlsZSIsImRvY3VtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwibGVmdCIsInpJbmRleCIsIm91dGxpbmUiLCJvbktleU1vdmUiLCJlIiwiZXZlbnQiLCJrZXlDb2RlTWFwIiwid2hpY2giLCJ0eXBlIiwicG92Q2FtZXJhIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJ0cmFja2luZ0NhbWVyYSIsImN1cnJlbnRDYW1lcmEiLCJvYmplY3QiLCJzY2FsZSIsInJvdGF0ZVkiLCJtYWtlUGxheWVyT2JqZWN0IiwiY29udHJvbHMiLCJtb3ZlbWVudCIsImFycm93cyIsInVwIiwiZG93biIsInJpZ2h0Iiwid2FzZCIsInN3aXRjaENhbWVyYSIsInJlc2V0IiwiZW5hYmxlZENvbnRyb2xzIiwic3BlZWQiLCJtYXhTcGVlZCIsImFjY2VsZXJhdGlvbiIsInJvdGF0aW9uU3BlZWQiLCJhZGRFdmVudExpc3RlbmVyIiwibWF4IiwidHJhbnNsYXRlWiJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0Es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R0FDTnNCLE1BQU8sS0FHZkUsYUFBYyxHQUNkQyxNQUFPLEdBR1BDLEVBQWtCVCxFQUFTQyxTQUFTQyxPQUVwQ1EsRUFBUSxFQUNSQyxFQUFXLEVBQ1RDLEVBQWUsSUFDZkMsRUFBZ0IsSUFFaEJ4QixLQStFTixPQXhFQVgsU0FBU29DLGlCQUFpQixVQUFXNUIsR0FBVyxHQUNoRFIsU0FBU29DLGlCQUFpQixRQUFTNUIsR0FBVyxJQXdFMUNsQixlQXRFSixXQUNRcUIsRUFBV29CLEVBQWdCTixLQUN2Qk8sRUFBUUMsSUFDUkQsR0FBU0UsR0FHYnZCLEVBQVdvQixFQUFnQjFCLE9BQzNCOUQsRUFBYTZFLFFBQVFlLEdBRXJCeEIsRUFBV29CLEVBQWdCSixRQUMzQnBGLEVBQWE2RSxTQUFTZSxHQUV0QnhCLEVBQVdvQixFQUFnQkwsT0FDdkJNLEVBQVEsSUFDUkEsR0FBU0UsRUFDVEYsRUFBUXhELEtBQUs2RCxJQUFJLEVBQUdMLElBRzVCekYsRUFBYStGLFdBQVdOLEdBQ3BCckIsRUFBV1csRUFBU08sZ0JBRWhCWixFQURBQSxJQUFrQkgsRUFDRkUsRUFFQUYsRUFFcEJILEVBQVdXLEVBQVNPLGVBQWdCLEdBRXBDbEIsRUFBV1csRUFBU1EsU0FDcEJ2RixFQUFhekIsU0FBU08sRUFBSSxFQUMxQmtCLEVBQWEzQixTQUFTTyxJQUFJLEVBQUdvQixFQUFhM0IsU0FBU1MsRUFBRyxLQTBDMURrQixhQUFjQSxFQUNkNEMsVUFuSFksV0FDWixPQUFPOEIsR0FtSFB0RixTQS9HVyxNQXJCSCIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEFsbCBjb25zdGFudHMsIGF2YWlsYWJsZSBpbiBnbG9iYWwgd2luZG93LlxyXG4gKi9cclxuXHJcbmNvbnN0IFdPUkxEX1NJREVfU0laRSA9IDc7XHJcbmNvbnN0IFdJTkRPV19IRUlHSFQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbmNvbnN0IFdJTkRPV19XSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5jb25zdCBST0FEX0NPTE9SUyA9IFtcclxuICAgIDB4ZmYwMDAwLFxyXG4gICAgMHhmZjg4MDAsXHJcbiAgICAweGZmZmYwMCxcclxuICAgIDB4MDBmZjAwLFxyXG4gICAgMHgwMGZmZmYsXHJcbiAgICAweDAwMDBmZixcclxuICAgIDB4ZmYwMGZmXHJcbl07XHJcbmNvbnN0IE5VTUJFUl9DT0xPUlMgPSBST0FEX0NPTE9SUy5sZW5ndGg7XHJcbmNvbnN0IFdPUkxEX0hFSUdIVCA9IDEwMDA7XHJcbmNvbnN0IFdPUkxEX1dJRFRIID0gMTAwO1xyXG5jb25zdCBUT1BfQ0FNRVJBX0RJU1QgPSA1MDtcclxuY29uc3QgQ0FSX1NJWkVfWCA9IDEwO1xyXG5jb25zdCBDQVJfU0laRV9ZID0gMTA7XHJcbmNvbnN0IENBUl9TSVpFX1ogPSAxMDtcclxuIiwiLyoqXHJcbiAqIE1haW4gZmlsZSBvZiB0aGUgZ2FtZS5cclxuICovXHJcblxyXG5jb25zdCBOb3RNYXJpb0thcnQgPSAoZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zdCBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgY29uc3QgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xyXG4gICAgY29uc3QgbWluaU1hcFJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcclxuICAgIGNvbnN0IG1pbmlNYXBDYW1lcmEgPSBuZXcgVEhSRUUuT3J0aG9ncmFwaGljQ2FtZXJhKFxyXG4gICAgICAgIC1XSU5ET1dfV0lEVEgsXHJcbiAgICAgICAgV0lORE9XX1dJRFRILFxyXG4gICAgICAgIFdJTkRPV19IRUlHSFQsXHJcbiAgICAgICAgLVdJTkRPV19IRUlHSFQsXHJcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUIC0gNTAsXHJcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUICsgNTBcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgcGxheWVycyA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRTb2NrZXRFdmVudCgpIHtcclxuICAgICAgICB2YXIgc29ja2V0ID0gaW8oeyB0cmFuc3BvcnRzOiBbJ3dlYnNvY2tldCddLCB1cGdyYWRlOiBmYWxzZSB9KTtcclxuXHJcbiAgICAgICAgLy8gVE9ETzogc2hvdyBtb2RhbCB3aXRoIG5hbWUgZm9ybSwgdGhlbiBlbWl0IG5hbWVcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdhbGwtcGxheWVycycsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1thbGwtcGxheWVyc10nLCBkYXRhKTtcclxuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHBsYXllcikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gcGxheWVyLnJvdGF0aW9uO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2FyID0gbWFrZUNhck9iamVjdCgpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyc1twbGF5ZXIuaWRdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3MsXHJcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb246IHJvdCxcclxuICAgICAgICAgICAgICAgICAgICBjYXI6IGNhclxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XHJcbiAgICAgICAgICAgICAgICBjYXIucm90YXRpb24uc2V0KHJvdC54LCByb3QueSwgcm90LnopO1xyXG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGNhcik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3BsYXllci1qb2luZWQnLCBmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoYHBsYXllciAke3BsYXllci5pZH0gaGFzIGpvaW5lZC5gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItam9pbmVkXScsIHBsYXllcik7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcclxuICAgICAgICAgICAgY29uc3Qgcm90ID0gcGxheWVyLnJvdGF0aW9uO1xyXG4gICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XHJcbiAgICAgICAgICAgIHBsYXllcnNbcGxheWVyLmlkXSA9IHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3MsXHJcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxyXG4gICAgICAgICAgICAgICAgY2FyOiBjYXJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcclxuICAgICAgICAgICAgY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcclxuICAgICAgICAgICAgc2NlbmUuYWRkKGNhcik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWxlZnQnLCBmdW5jdGlvbihwbGF5ZXJJZCkge1xyXG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IoYFBsYXllciAke3BsYXllcklkfSBoYXMgbGVmdC5gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItbGVmdF0nLCBwbGF5ZXJJZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IHBsYXllcnNbcGxheWVySWRdLmNhcjtcclxuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGNhcik7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBwbGF5ZXJzW3BsYXllcklkXTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCd1cGRhdGUtcGxheWVyJywgZnVuY3Rpb24ocGxheWVyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbdXBkYXRlLXBsYXllcl0nLCBwbGF5ZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IHBsYXllci5pZDtcclxuICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcclxuICAgICAgICAgICAgcC5jYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQtY291bnRkb3duJywgZnVuY3Rpb24oc2Vjb25kcykge1xyXG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhgJHtzZWNvbmRzfSBzZWNvbmRzIGJlZm9yZSB0aGUgcmFjZSBzdGFydHMuYCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RhcnQtY291bnRkb3duXScsIHNlY29uZHMpO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBzaG93IFwieCBzZWNvbmRzIGJlZm9yZSBzdGFydFwiXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1RoZSByYWNlIGhhcyBzdGFydGVkLicpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0YXJ0XScpO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdGhlIGdhbWUgaGFzIHN0YXJ0ZWRcclxuICAgICAgICAgICAgLy8gVE9ETzogZGlzYWJsZSBtb3ZpbmcgaWYgbm90IHN0YXJ0ZWRcclxuICAgICAgICAgICAgLy8gVE9ETzogZXZlcnlvbmUgbmVlZHMgYSBuYW1lIGZpcnN0IChkb24ndCBoaWRlIG1vZGFsKVxyXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyB0byBiZSByZWFkeVxyXG4gICAgICAgICAgICAvLyBUT0RPOiAyKyBwbGF5ZXJzXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbignZmluaXNoZWQnLCBmdW5jdGlvbih0aW1lKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKCdZb3UgZmluaXNoZWQuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbZmluaXNoZWRdJywgdGltZSk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgXCJ3YWl0aW5nIGZvciBvdGhlcnMsIHlvdXIgdGltZSBpcyB4XCJcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdzdG9wJywgZnVuY3Rpb24ocGxheWVycykge1xyXG4gICAgICAgICAgICB0b2FzdGVyLmluZm8oJ1RoZSByYWNlIGlzIG92ZXIuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RvcF0nLCBzdG9wKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogYWxsIHBsYXllcnMgYXJlIGZpbmlzaGVkLCBzaG93IHJhbmtpbmcgYW5kIHBsYXkgYWdhaW4gYnV0dG9uXHJcbiAgICAgICAgICAgIHBsYXllcnMuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNvcnRlZCBieSByYW5raW5nIDotKVxyXG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBsYXllci5uYW1lO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IHRpbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBQbGF5ZXIucGxheWVyT2JqZWN0O1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgndXBkYXRlLXBsYXllcicsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogcC5wb3NpdGlvbi54LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHAucG9zaXRpb24ueSxcclxuICAgICAgICAgICAgICAgICAgICB6OiBwLnBvc2l0aW9uLnpcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByb3RhdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHAucm90YXRpb24uX3gsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogcC5yb3RhdGlvbi5feSxcclxuICAgICAgICAgICAgICAgICAgICB6OiBwLnJvdGF0aW9uLl96XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIDEwMDAgLyA4MCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbWFrZUNhck9iamVjdCgpIHtcclxuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuT2JqZWN0TG9hZGVyKCk7XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XHJcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBidWlsZEZsb29yKCkge1xyXG4gICAgICAgIGxldCBjdXJ2ZSA9IG5ldyBUSFJFRS5DYXRtdWxsUm9tQ3VydmUzKFtcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDgwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDYwMCwgODAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoNjAwLCA1MDAsIDApLFxyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgLTUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIC01MDAsIDApXHJcbiAgICAgICAgXSk7XHJcbiAgICAgICAgY3VydmUuY2xvc2VkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgbGV0IGV4dHJ1ZGVTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgc3RlcHM6IDEwMCxcclxuICAgICAgICAgICAgZXh0cnVkZVBhdGg6IGN1cnZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gU2hhcGUgdGhhdCBnZXRzIGV4dHJ1ZGVkIHRocm91Z2ggdGhlIGN1cnZlXHJcbiAgICAgICAgbGV0IHNoYXBlID0gbmV3IFRIUkVFLlNoYXBlKFtcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMiAqIENBUl9TSVpFX1ksIDApLFxyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigwLCA1ICogQ0FSX1NJWkVfWCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIC01ICogQ0FSX1NJWkVfWClcclxuICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkV4dHJ1ZGVHZW9tZXRyeShzaGFwZSwgZXh0cnVkZVNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgbGV0IG1hdGVyaWFscyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNQkVSX0NPTE9SUzsgaSsrKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFscy5wdXNoKFxyXG4gICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogUk9BRF9DT0xPUlNbaV0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vd2lyZWZyYW1lOiB0cnVlIC8vIFRoaXMgbWFrZXMgdHJhY2sgbW9yZSBUcm9uLWxpa2VcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdlb0ZhY2VzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXHJcblxyXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqXS5tYXRlcmlhbEluZGV4ID1cclxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xyXG5cclxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbaiArIDFdLm1hdGVyaWFsSW5kZXggPVxyXG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGZsb29yID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFscyk7XHJcbiAgICAgICAgZmxvb3Iucm90YXRlWCgtTWF0aC5QSSAvIDIpO1xyXG4gICAgICAgIGZsb29yLnBvc2l0aW9uLnkgPSAwO1xyXG5cclxuICAgICAgICBzY2VuZS5hZGQoZmxvb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEgsIFdJTkRPV19IRUlHSFQpO1xyXG4gICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xyXG4gICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XHJcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICc1JSc7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUubGVmdCA9ICc3MCUnO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnpJbmRleCA9ICcyJztcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ3doaXRlIHNvbGlkJztcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50KTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueSA9IFRPUF9DQU1FUkFfRElTVDtcclxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnJvdGF0aW9uLnggPSAtOTAgKiBNYXRoLlBJIC8gMTgwO1xyXG5cclxuICAgICAgICBidWlsZEZsb29yKCk7XHJcblxyXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcclxuICAgICAgICBpbml0U29ja2V0RXZlbnQoKTtcclxuICAgICAgICBsb29wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbG9vcCgpIHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XHJcblxyXG4gICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcclxuICAgICAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIFBsYXllci5nZXRDYW1lcmEoKSk7XHJcblxyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5jbGVhcigpO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRWaWV3cG9ydCgwLCAwLCBXSU5ET1dfV0lEVEggLyA0LCBXSU5ET1dfSEVJR0hUIC8gNCk7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnJlbmRlcihzY2VuZSwgbWluaU1hcENhbWVyYSk7XHJcblxyXG4gICAgICAgIC8vIGZvciAobGV0IGlkIGluIHBsYXllcnMpIHtcclxuICAgICAgICAvLyAgICAgY29uc3QgcCA9IHBsYXllcnNbaWRdO1xyXG4gICAgICAgIC8vICAgICBjb25zdCBwb3MgPSBwLnBvc2l0aW9uO1xyXG4gICAgICAgIC8vICAgICBjb25zdCByb3QgPSBwLnJvdGF0aW9uO1xyXG4gICAgICAgIC8vICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XHJcbiAgICAgICAgLy8gICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIFBsYXllci5kb01vdmVtZW50TG9vcCgpO1xyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXQ6IGluaXRcclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxyXG4gKi9cclxuXHJcbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IHBvdkNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcclxuICAgICAgICA3NSxcclxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIDAuMSxcclxuICAgICAgICAxMDAwXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHRyYWNraW5nQ2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxyXG4gICAgICAgIDc1LFxyXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXHJcbiAgICAgICAgMC4xLFxyXG4gICAgICAgIDEwMDBcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgIGxldCBnZXRDYW1lcmEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gY3VycmVudENhbWVyYTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcGxheWVyT2JqZWN0ID0gbWFrZVBsYXllck9iamVjdCgpO1xyXG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcclxuXHJcbiAgICBjb25zdCBjb250cm9scyA9IHtcclxuICAgICAgICBtb3ZlbWVudDoge1xyXG4gICAgICAgICAgICBhcnJvd3M6IHtcclxuICAgICAgICAgICAgICAgIHVwOiAzOCxcclxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogMzcsXHJcbiAgICAgICAgICAgICAgICByaWdodDogMzlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgd2FzZDoge1xyXG4gICAgICAgICAgICAgICAgdXA6IDg3LFxyXG4gICAgICAgICAgICAgICAgZG93bjogODMsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiA2NSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0OiA2OFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzd2l0Y2hDYW1lcmE6IDY3LFxyXG4gICAgICAgIHJlc2V0OiA4XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XHJcblxyXG4gICAgbGV0IHNwZWVkID0gMDtcclxuICAgIGxldCBtYXhTcGVlZCA9IDU7XHJcbiAgICBjb25zdCBhY2NlbGVyYXRpb24gPSAwLjA1O1xyXG4gICAgY29uc3Qgcm90YXRpb25TcGVlZCA9IDAuMDU7XHJcblxyXG4gICAgY29uc3Qga2V5Q29kZU1hcCA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XHJcbiAgICAgICAgZSA9IGUgfHwgZXZlbnQ7IC8vIEZvciBJRS5cclxuICAgICAgICBrZXlDb2RlTWFwW2Uud2hpY2hdID0gZS50eXBlID09PSAna2V5ZG93bic7XHJcbiAgICB9XHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5TW92ZSwgZmFsc2UpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBkb01vdmVtZW50TG9vcCgpIHtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA8IG1heFNwZWVkKSB7XHJcbiAgICAgICAgICAgICAgICBzcGVlZCArPSBhY2NlbGVyYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmxlZnRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMucmlnaHRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmRvd25dKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNwZWVkIC09IGFjY2VsZXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIHNwZWVkID0gTWF0aC5tYXgoMCwgc3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FtZXJhID09PSBwb3ZDYW1lcmEpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSBwb3ZDYW1lcmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnJlc2V0XSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueSA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgLy8gbGV0IHBvcyA9IGdyb3VwQmxvY2tzW2ldLnBvc2l0aW9uO1xyXG4gICAgICAgIC8vICAgICBsZXQgcG8gPSBwbGF5ZXJPYmplY3QuY2hpbGRyZW5bMl0uY2hpbGRyZW5bMF1cclxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxyXG4gICAgICAgIC8vIHtcclxuICAgICAgICAvLyAgICAgdmFyIGxvY2FsVmVydGV4ID0gcG8uZ2VvbWV0cnkudmVydGljZXNbdmVydGV4SW5kZXhdLmNsb25lKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBkaXJlY3Rpb25WZWN0b3IgPSBnbG9iYWxWZXJ0ZXguc3ViU2VsZiggcG8ucG9zaXRpb24gKTtcclxuXHJcbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcclxuICAgICAgICAvLyAgICAgdmFyIGNvbGxpc2lvblJlc3VsdHMgPSByYXkuaW50ZXJzZWN0T2JqZWN0cyggZ3JvdXBCbG9ja3MgKTtcclxuICAgICAgICAvLyAgICAgaWYgKCBjb2xsaXNpb25SZXN1bHRzLmxlbmd0aCA+IDAgJiYgY29sbGlzaW9uUmVzdWx0c1swXS5kaXN0YW5jZSA8IGRpcmVjdGlvblZlY3Rvci5sZW5ndGgoKSApXHJcbiAgICAgICAgLy8gICAgIHtcclxuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdwZXJkaXN0cmUnKVxyXG4gICAgICAgIC8vICAgICAgICAgLy8gYSBjb2xsaXNpb24gb2NjdXJyZWQuLi4gZG8gc29tZXRoaW5nLi4uXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gaWYoKHBsYXllck9iamVjdC5wb3NpdGlvbi54KzUgPCBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1IDwgcG9zLnopfHwgKHBsYXllck9iamVjdC5wb3NpdGlvbi54LTUgPiBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1ID4gcG9zLnopKVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtYWtlUGxheWVyT2JqZWN0KCkge1xyXG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcclxuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcclxuXHJcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMTA7XHJcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogLTIwO1xyXG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xyXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVkoMTgwICogTWF0aC5QSSAvIDE4MCk7XHJcblxyXG4gICAgICAgIG9iamVjdC5hZGQocG92Q2FtZXJhKTtcclxuICAgICAgICBvYmplY3QuYWRkKHRyYWNraW5nQ2FtZXJhKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRvTW92ZW1lbnRMb29wOiBkb01vdmVtZW50TG9vcCxcclxuICAgICAgICBwbGF5ZXJPYmplY3Q6IHBsYXllck9iamVjdCxcclxuICAgICAgICBnZXRDYW1lcmE6IGdldENhbWVyYSxcclxuICAgICAgICBwbGF5ZXJJZDogcGxheWVySWRcclxuICAgIH07XHJcbn0pKCk7XHJcbiJdfQ==
