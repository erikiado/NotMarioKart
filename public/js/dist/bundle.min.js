"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,BOX_SIZE=10,Physics=function(){var e=-1,o=new THREE.Vector3(0,-TOP_CAMERA_DIST,0),t=new THREE.Vector3(0,1,0),n=new THREE.Raycaster;return{gravity:function(i,r){o.x=i.position.x,o.z=i.position.z,n.set(o,t),(!n.intersectObject(r,!0).length||i.position.y<0)&&(i.position.y+=e)},detectCollision:function(e,o){for(var t=(new THREE.Box3).setFromObject(e),n=0;n<o.length;n++)if(t.intersectsBox(o[n].boundingBox))return!0;return!1}}}(),Box=function(e,o,t){var n=new THREE.BoxGeometry(BOX_SIZE,BOX_SIZE,BOX_SIZE),i=new THREE.MeshBasicMaterial({color:11176004});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=o,this.mesh.position.z=t,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=t,i=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return o.position.y=2*e.scale.y,o.position.z=4*e.scale.z,o.rotateY(180*Math.PI/180),t.position.y=10*e.scale.y,t.position.z=-20*e.scale.z,t.rotateY(180*Math.PI/180),e.add(o),e.add(t),e}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},a=r.movement.arrows,s=0,E=5,c=.05,l=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[a.up]&&s<E&&(s+=c),d[a.left]&&i.rotateY(l),d[a.right]&&i.rotateY(-l),d[a.down]&&s>0&&(s-=c,s=Math.max(0,s)),i.translateZ(s),d[r.switchCamera]&&(n=n===o?t:o,d[r.switchCamera]=!1),d[r.reset]&&(i.rotation.x=0,i.position.set(0,i.position.x,0),i.rotation.y=0,i.position.set(0,i.position.y,0),i.rotation.z=0,i.position.set(0,i.position.z,0))},playerObject:i,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}(),NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(t){console.log("[all-players]",t),t.forEach(function(e){var t=e.position,n=e.rotation,i=o();p[e.id]={position:t,rotation:n,car:i},i.position.set(t.x,t.y,t.z),i.rotation.set(n.x,n.y,n.z),s.add(i)}),console.log(t),0==t.length&&(n(),e.emit("send-boxes",y))}),e.on("player-joined",function(e){console.log("[player-joined]",e);var t=e.position,n=e.rotation,i=o();p[e.id]={position:t,rotation:n,car:i},i.position.set(t.x,t.y,t.z),i.rotation.set(n.x,n.y,n.z),s.add(i)}),e.on("receive-boxes",function(e){y=e,i()}),e.on("player-left",function(e){console.log("[player-left]",e);var o=p[e].car;s.remove(o),delete p[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var o=e.id,t=e.position,n=e.rotation,i=p[o];i.car.position.set(t.x,t.y,t.z),i.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){console.log("[start-countdown]",e)}),e.on("start",function(){console.log("[start]")}),e.on("finished",function(e){console.log("[finished]",e)}),e.on("stop",function(e){console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var o=Player.playerObject;e.emit("update-player",{position:{x:o.position.x,y:o.position.y,z:o.position.z},rotation:{x:o.rotation._x,y:o.rotation._y,z:o.rotation._z}})},40)}function o(){return(new THREE.ObjectLoader).parse(playerCar)}function t(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var o={steps:100,extrudePath:e},t=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(t,o),i=[],r=0;r<NUMBER_COLORS;r++)i.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[r],side:THREE.DoubleSide}));for(var E=n.faces.length/2,c=0;c<E;c++){var l=2*c;n.faces[l].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[l+1].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS}(a=new THREE.Mesh(n,i)).rotateX(-Math.PI/2),a.position.y=0,s.add(a)}function n(){for(var e=0;e<1e3;e++){var o=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));s.updateMatrixWorld(),Physics.gravity(o.mesh,a),o.mesh.position.y==BOX_SIZE/2&&(d.push(o),y.push({x:o.mesh.position.x,z:o.mesh.position.z}),s.add(o.mesh))}}function i(){for(var e=0;e<y.length;e++){var o=new Box(y[e].x,BOX_SIZE/2,y[e].z);s.updateMatrixWorld(),Physics.gravity(o.mesh,a),o.mesh.position.y==BOX_SIZE/2&&(d.push(o),s.add(o.mesh))}}function r(){requestAnimationFrame(r),E.clear(),E.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),E.render(s,Player.getCamera()),c.clear(),c.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),c.render(s,l),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,d)&&Player.crash(),l.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,a)}var a,s=new THREE.Scene,E=new THREE.WebGLRenderer,c=new THREE.WebGLRenderer,l=new THREE.OrthographicCamera(-WINDOW_WIDTH,WINDOW_WIDTH,WINDOW_HEIGHT,-WINDOW_HEIGHT,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),d=[],p={},y=[];return{init:function(){E.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),E.setPixelRatio(window.devicePixelRatio),E.domElement.style.position="fixed",document.body.appendChild(E.domElement),E.autoClear=!1,c.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),c.setPixelRatio(window.devicePixelRatio),c.domElement.style.position="fixed",c.domElement.style.top="5%",c.domElement.style.left="70%",c.domElement.style.zIndex="2",c.domElement.style.outline="white solid",document.body.appendChild(c.domElement),c.autoClear=!1,l.position.y=TOP_CAMERA_DIST,l.rotation.x=-90*Math.PI/180,t(),s.add(Player.playerObject),e(),r()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBoeXNpY3MuanMiLCJCb3guanMiLCJQbGF5ZXIuanMiLCJOb3RNYXJpb0thcnQuanMiXSwibmFtZXMiOlsiV09STERfU0lERV9TSVpFIiwiV0lORE9XX0hFSUdIVCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwiV0lORE9XX1dJRFRIIiwiaW5uZXJXaWR0aCIsIlJPQURfQ09MT1JTIiwiTlVNQkVSX0NPTE9SUyIsImxlbmd0aCIsIldPUkxEX0hFSUdIVCIsIldPUkxEX1dJRFRIIiwiVE9QX0NBTUVSQV9ESVNUIiwiQ0FSX1NJWkVfWCIsIkNBUl9TSVpFX1kiLCJDQVJfU0laRV9aIiwiQk9YX1NJWkUiLCJQaHlzaWNzIiwiZyIsImhlbGwiLCJUSFJFRSIsIlZlY3RvcjMiLCJvbmVEaXJlY3Rpb24iLCJyYXljYXN0ZXIiLCJSYXljYXN0ZXIiLCJncmF2aXR5Iiwib2JqZWN0IiwiZmxvb3IiLCJ4IiwicG9zaXRpb24iLCJ6Iiwic2V0IiwiaW50ZXJzZWN0T2JqZWN0IiwieSIsImRldGVjdENvbGxpc2lvbiIsImNhciIsIm9iamVjdHMiLCJjYXJCb3giLCJCb3gzIiwic2V0RnJvbU9iamVjdCIsImkiLCJpbnRlcnNlY3RzQm94IiwiYm91bmRpbmdCb3giLCJCb3giLCJnZW9tZXRyeSIsIkJveEdlb21ldHJ5IiwibWF0ZXJpYWwiLCJNZXNoQmFzaWNNYXRlcmlhbCIsImNvbG9yIiwidGhpcyIsIm1lc2giLCJNZXNoIiwiUGxheWVyIiwib25LZXlNb3ZlIiwiZSIsImV2ZW50Iiwia2V5Q29kZU1hcCIsIndoaWNoIiwidHlwZSIsInBvdkNhbWVyYSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwidHJhY2tpbmdDYW1lcmEiLCJjdXJyZW50Q2FtZXJhIiwicGxheWVyT2JqZWN0IiwiT2JqZWN0TG9hZGVyIiwicGFyc2UiLCJwbGF5ZXJDYXIiLCJzY2FsZSIsInJvdGF0ZVkiLCJNYXRoIiwiUEkiLCJhZGQiLCJtYWtlUGxheWVyT2JqZWN0IiwiY29udHJvbHMiLCJtb3ZlbWVudCIsImFycm93cyIsInVwIiwiZG93biIsImxlZnQiLCJyaWdodCIsIndhc2QiLCJzd2l0Y2hDYW1lcmEiLCJyZXNldCIsImVuYWJsZWRDb250cm9scyIsInNwZWVkIiwibWF4U3BlZWQiLCJhY2NlbGVyYXRpb24iLCJyb3RhdGlvblNwZWVkIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZG9Nb3ZlbWVudExvb3AiLCJtYXgiLCJ0cmFuc2xhdGVaIiwicm90YXRpb24iLCJnZXRDYW1lcmEiLCJwbGF5ZXJJZCIsImNyYXNoIiwiTm90TWFyaW9LYXJ0IiwiaW5pdFNvY2tldEV2ZW50Iiwic29ja2V0IiwiaW8iLCJ0cmFuc3BvcnRzIiwidXBncmFkZSIsIm9uIiwiZGF0YSIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwicGxheWVyIiwicG9zIiwicm90IiwibWFrZUNhck9iamVjdCIsInBsYXllcnMiLCJpZCIsInNjZW5lIiwiYWRkQm94ZXMiLCJlbWl0IiwiYm94ZXMiLCJib3hzIiwiYWRkQm94ZXNQb3NpdGlvbiIsInJlbW92ZSIsInAiLCJzZWNvbmRzIiwidGltZSIsInN0b3AiLCJuYW1lIiwic2V0SW50ZXJ2YWwiLCJfeCIsIl95IiwiX3oiLCJidWlsZEZsb29yIiwiY3VydmUiLCJDYXRtdWxsUm9tQ3VydmUzIiwiY2xvc2VkIiwiZXh0cnVkZVNldHRpbmdzIiwic3RlcHMiLCJleHRydWRlUGF0aCIsInNoYXBlIiwiU2hhcGUiLCJWZWN0b3IyIiwiRXh0cnVkZUdlb21ldHJ5IiwibWF0ZXJpYWxzIiwicHVzaCIsInNpZGUiLCJEb3VibGVTaWRlIiwiZ2VvRmFjZXNMZW5ndGgiLCJmYWNlcyIsImoiLCJtYXRlcmlhbEluZGV4Iiwicm90YXRlWCIsImJveCIsInJhbmRvbSIsInVwZGF0ZU1hdHJpeFdvcmxkIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsIm1pbmlNYXBSZW5kZXJlciIsIm1pbmlNYXBDYW1lcmEiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwiekluZGV4Iiwib3V0bGluZSJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0EsTUFDQSxJQUNBLFVBRUVDLGNBQWdCRCxZQUFZRSxPQUM1QkMsYUFBZSxJQUNmQyxZQUFjLElBQ2RDLGdCQUFrQixHQUNsQkMsV0FBYSxHQUNiQyxXQUFhLEdBQ2JDLFdBQWEsR0FDYkMsU0FBVyxHQ25CWEMsUUFBVyxXQUViLElBQU1DLEdBQUssRUFDUEMsRUFBTyxJQUFJQyxNQUFNQyxRQUFRLEdBQUlULGdCQUFpQixHQUM5Q1UsRUFBZSxJQUFJRixNQUFNQyxRQUFRLEVBQUcsRUFBRyxHQUN2Q0UsRUFBWSxJQUFJSCxNQUFNSSxVQXlCMUIsT0FDSUMsUUF4QkosU0FBaUJDLEVBQVFDLEdBRXJCUixFQUFLUyxFQUFJRixFQUFPRyxTQUFTRCxFQUN6QlQsRUFBS1csRUFBSUosRUFBT0csU0FBU0MsRUFDekJQLEVBQVVRLElBQUlaLEVBQU1HLEtBR0hDLEVBQVVTLGdCQUFnQkwsR0FBTyxHQUNsQ2xCLFFBQVVpQixFQUFPRyxTQUFTSSxFQUFJLEtBQzFDUCxFQUFPRyxTQUFTSSxHQUFLZixJQWdCekJnQixnQkFaSixTQUF5QkMsRUFBS0MsR0FFMUIsSUFBSyxJQUREQyxHQUFTLElBQUlqQixNQUFNa0IsTUFBT0MsY0FBY0osR0FDbkNLLEVBQUksRUFBR0EsRUFBSUosRUFBUTNCLE9BQVErQixJQUNoQyxHQUFJSCxFQUFPSSxjQUFjTCxFQUFRSSxHQUFHRSxhQUNoQyxP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UyxXQUFXQyxNQUFNM0YsS0FBTyxNQUN4Q2lGLEVBQWdCUyxXQUFXQyxNQUFNSyxPQUFTLElBQzFDZixFQUFnQlMsV0FBV0MsTUFBTU0sUUFBVSxjQUMzQ3ZGLFNBQVNrRixLQUFLQyxZQUFZWixFQUFnQlMsWUFDMUNULEVBQWdCYSxXQUFZLEVBRTVCWixFQUFjbkksU0FBU0ksRUFBSXJCLGdCQUMzQm9KLEVBQWNuRSxTQUFTakUsR0FBSyxHQUFLeUMsS0FBS0MsR0FBSyxJQUUzQzRELElBR0FoQixFQUFNM0MsSUFBSW5CLE9BQU9XLGNBQ2pCbUMsSUFDQXVELE1BcFFjIiwiZmlsZSI6ImJ1bmRsZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFsbCBjb25zdGFudHMsIGF2YWlsYWJsZSBpbiBnbG9iYWwgd2luZG93LlxuICovXG5cbmNvbnN0IFdPUkxEX1NJREVfU0laRSA9IDc7XG5jb25zdCBXSU5ET1dfSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0O1xuY29uc3QgV0lORE9XX1dJRFRIID0gd2luZG93LmlubmVyV2lkdGg7XG5jb25zdCBST0FEX0NPTE9SUyA9IFtcbiAgICAweGZmMDAwMCxcbiAgICAweGZmODgwMCxcbiAgICAweGZmZmYwMCxcbiAgICAweDAwZmYwMCxcbiAgICAweDAwZmZmZixcbiAgICAweDAwMDBmZixcbiAgICAweGZmMDBmZlxuXTtcbmNvbnN0IE5VTUJFUl9DT0xPUlMgPSBST0FEX0NPTE9SUy5sZW5ndGg7XG5jb25zdCBXT1JMRF9IRUlHSFQgPSAxMDAwO1xuY29uc3QgV09STERfV0lEVEggPSAxMDA7XG5jb25zdCBUT1BfQ0FNRVJBX0RJU1QgPSA1MDtcbmNvbnN0IENBUl9TSVpFX1ggPSAxMDtcbmNvbnN0IENBUl9TSVpFX1kgPSAxMDtcbmNvbnN0IENBUl9TSVpFX1ogPSAxMDtcbmNvbnN0IEJPWF9TSVpFID0gMTA7XG4iLCIvKipcbiAqIFBoeXNpY3MgXCJlbmdpbmVcIiBmb3IgdGhlIGdhbWUuXG4gKiBOb3RQaHlzaWpzIGZvciBOb3RNYXJpb0thcnQuXG4gKi9cbmNvbnN0IFBoeXNpY3MgPSAoZnVuY3Rpb24oKSB7XG5cbiAgICBjb25zdCBnID0gLTE7XG4gICAgbGV0IGhlbGwgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAtVE9QX0NBTUVSQV9ESVNULCAwKTtcbiAgICBsZXQgb25lRGlyZWN0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMSwgMCk7XG4gICAgbGV0IHJheWNhc3RlciA9IG5ldyBUSFJFRS5SYXljYXN0ZXIoKTtcblxuICAgIGZ1bmN0aW9uIGdyYXZpdHkob2JqZWN0LCBmbG9vcikge1xuICAgICAgICAvLyBVcGRhdGUgcmF5Y2FzdGVyIHdpdGggYW4gb3JpZ2luIGJlbG93IHRoZSBvYmplY3QuXG4gICAgICAgIGhlbGwueCA9IG9iamVjdC5wb3NpdGlvbi54O1xuICAgICAgICBoZWxsLnogPSBvYmplY3QucG9zaXRpb24uejtcbiAgICAgICAgcmF5Y2FzdGVyLnNldChoZWxsLCBvbmVEaXJlY3Rpb24pO1xuXG4gICAgICAgIC8vIFRyeSB0byBpbnRlcnNlY3Qgd2l0aCBmbG9vci5cbiAgICAgICAgbGV0IGludGVyc2VjdHMgPSByYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0KGZsb29yLCB0cnVlKTtcbiAgICAgICAgaWYgKCFpbnRlcnNlY3RzLmxlbmd0aCB8fCBvYmplY3QucG9zaXRpb24ueSA8IDApIHtcbiAgICAgICAgICAgIG9iamVjdC5wb3NpdGlvbi55ICs9IGc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZXRlY3RDb2xsaXNpb24oY2FyLCBvYmplY3RzKSB7XG4gICAgICAgIGxldCBjYXJCb3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QoY2FyKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvYmplY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY2FyQm94LmludGVyc2VjdHNCb3gob2JqZWN0c1tpXS5ib3VuZGluZ0JveCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ3Jhdml0eTogZ3Jhdml0eSxcbiAgICAgICAgZGV0ZWN0Q29sbGlzaW9uOiBkZXRlY3RDb2xsaXNpb25cbiAgICB9O1xufSkoKTtcbiIsIi8qKlxuICogQm94ZXMgcmVwcmVzZW50aW5nIG9ic3RhY2xlcy5cbiAqL1xuY29uc3QgQm94ID0gKGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBsZXQgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIEJPWF9TSVpFLCBCT1hfU0laRSwgQk9YX1NJWkUgKTtcbiAgICBsZXQgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhhYTg4NDR9ICk7XG4gICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi54ID0geDtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IHk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnogPSB6O1xuICAgIHRoaXMuYm91bmRpbmdCb3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QodGhpcy5tZXNoKTtcbn0pO1xuIiwiLyoqXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxuICovXG5cbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcbiAgICBjb25zdCBwb3ZDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgY29uc3QgdHJhY2tpbmdDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcbiAgICBsZXQgZ2V0Q2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50Q2FtZXJhO1xuICAgIH07XG5cbiAgICBjb25zdCBwbGF5ZXJPYmplY3QgPSBtYWtlUGxheWVyT2JqZWN0KCk7XG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcblxuICAgIGNvbnN0IGNvbnRyb2xzID0ge1xuICAgICAgICBtb3ZlbWVudDoge1xuICAgICAgICAgICAgYXJyb3dzOiB7XG4gICAgICAgICAgICAgICAgdXA6IDM4LFxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDM3LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAzOVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdhc2Q6IHtcbiAgICAgICAgICAgICAgICB1cDogODcsXG4gICAgICAgICAgICAgICAgZG93bjogODMsXG4gICAgICAgICAgICAgICAgbGVmdDogNjUsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDY4XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHN3aXRjaENhbWVyYTogNjcsXG4gICAgICAgIHJlc2V0OiA4XG4gICAgfTtcblxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XG5cbiAgICBsZXQgc3BlZWQgPSAwO1xuICAgIGxldCBtYXhTcGVlZCA9IDU7XG4gICAgY29uc3QgYWNjZWxlcmF0aW9uID0gMC4wNTtcbiAgICBjb25zdCByb3RhdGlvblNwZWVkID0gMC4wNTtcblxuICAgIGNvbnN0IGtleUNvZGVNYXAgPSB7fTtcblxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XG4gICAgICAgIGUgPSBlIHx8IGV2ZW50OyAvLyBGb3IgSUUuXG4gICAgICAgIGtleUNvZGVNYXBbZS53aGljaF0gPSBlLnR5cGUgPT09ICdrZXlkb3duJztcbiAgICB9XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlNb3ZlLCBmYWxzZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGRvTW92ZW1lbnRMb29wKCkge1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPCBtYXhTcGVlZCkge1xuICAgICAgICAgICAgICAgIHNwZWVkICs9IGFjY2VsZXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMubGVmdF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5yaWdodF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMuZG93bl0pIHtcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGVlZCAtPSBhY2NlbGVyYXRpb247XG4gICAgICAgICAgICAgICAgc3BlZWQgPSBNYXRoLm1heCgwLCBzcGVlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudENhbWVyYSA9PT0gcG92Q2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2FtZXJhID0gcG92Q2FtZXJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMucmVzZXRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueCA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi54LCAwKTtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGlvbi55ID0gMDtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnogPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueiwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmFzaCgpIHtcbiAgICAgICAgLy8gYWNjZWxlcmF0aW9uID0gMDtcbiAgICAgICAgc3BlZWQgPSAwO1xuICAgICAgICAvLyBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgIC8vICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWigtc3BlZWQpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIC8vIGxldCBwb3MgPSBncm91cEJsb2Nrc1tpXS5wb3NpdGlvbjtcbiAgICAgICAgLy8gICAgIGxldCBwbyA9IHBsYXllck9iamVjdC5jaGlsZHJlblsyXS5jaGlsZHJlblswXVxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICB2YXIgbG9jYWxWZXJ0ZXggPSBwby5nZW9tZXRyeS52ZXJ0aWNlc1t2ZXJ0ZXhJbmRleF0uY2xvbmUoKTtcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XG4gICAgICAgIC8vICAgICB2YXIgZGlyZWN0aW9uVmVjdG9yID0gZ2xvYmFsVmVydGV4LnN1YlNlbGYoIHBvLnBvc2l0aW9uICk7XG5cbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcbiAgICAgICAgLy8gICAgIHZhciBjb2xsaXNpb25SZXN1bHRzID0gcmF5LmludGVyc2VjdE9iamVjdHMoIGdyb3VwQmxvY2tzICk7XG4gICAgICAgIC8vICAgICBpZiAoIGNvbGxpc2lvblJlc3VsdHMubGVuZ3RoID4gMCAmJiBjb2xsaXNpb25SZXN1bHRzWzBdLmRpc3RhbmNlIDwgZGlyZWN0aW9uVmVjdG9yLmxlbmd0aCgpIClcbiAgICAgICAgLy8gICAgIHtcbiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZygncGVyZGlzdHJlJylcbiAgICAgICAgLy8gICAgICAgICAvLyBhIGNvbGxpc2lvbiBvY2N1cnJlZC4uLiBkbyBzb21ldGhpbmcuLi5cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBpZigocGxheWVyT2JqZWN0LnBvc2l0aW9uLngrNSA8IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPCBwb3Mueil8fCAocGxheWVyT2JqZWN0LnBvc2l0aW9uLngtNSA+IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPiBwb3MueikpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxuICAgICAgICAvLyB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZVBsYXllck9iamVjdCgpIHtcbiAgICAgICAgY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLk9iamVjdExvYWRlcigpO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcblxuICAgICAgICBwb3ZDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMjtcbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIDQ7XG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xuICAgICAgICBwb3ZDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICB0cmFja2luZ0NhbWVyYS5wb3NpdGlvbi55ID0gb2JqZWN0LnNjYWxlLnkgKiAxMDtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogLTIwO1xuICAgICAgICAvLyB0cmFja2luZ0NhbWVyYS5yb3RhdGVYKDAgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICBvYmplY3QuYWRkKHBvdkNhbWVyYSk7XG4gICAgICAgIG9iamVjdC5hZGQodHJhY2tpbmdDYW1lcmEpO1xuXG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9Nb3ZlbWVudExvb3A6IGRvTW92ZW1lbnRMb29wLFxuICAgICAgICBwbGF5ZXJPYmplY3Q6IHBsYXllck9iamVjdCxcbiAgICAgICAgZ2V0Q2FtZXJhOiBnZXRDYW1lcmEsXG4gICAgICAgIHBsYXllcklkOiBwbGF5ZXJJZCxcbiAgICAgICAgY3Jhc2g6IGNyYXNoXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIE1haW4gZmlsZSBvZiB0aGUgZ2FtZS5cbiAqL1xuXG5jb25zdCBOb3RNYXJpb0thcnQgPSAoZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcbiAgICBjb25zdCByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgY29uc3QgbWluaU1hcFJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcbiAgICBjb25zdCBtaW5pTWFwQ2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYShcbiAgICAgICAgLVdJTkRPV19XSURUSCxcbiAgICAgICAgV0lORE9XX1dJRFRILFxuICAgICAgICBXSU5ET1dfSEVJR0hULFxuICAgICAgICAtV0lORE9XX0hFSUdIVCxcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUIC0gNTAsXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCArIDUwXG4gICAgKTtcbiAgICB2YXIgZmxvb3I7XG4gICAgLy9Cb3ggb2JqZWN0c1xuICAgIHZhciBvYmplY3RzID0gW107XG4gICAgY29uc3QgcGxheWVycyA9IHt9O1xuICAgIC8vQm94IHBvc2l0aW9ucyBmb3Igb3RoZXIgcGxheWVyc1xuICAgIHZhciBib3hlcyA9IFtdO1xuXG4gICAgZnVuY3Rpb24gaW5pdFNvY2tldEV2ZW50KCkge1xuICAgICAgICB2YXIgc29ja2V0ID0gaW8oeyB0cmFuc3BvcnRzOiBbJ3dlYnNvY2tldCddLCB1cGdyYWRlOiBmYWxzZSB9KTtcblxuICAgICAgICAvLyBUT0RPOiBzaG93IG1vZGFsIHdpdGggbmFtZSBmb3JtLCB0aGVuIGVtaXQgbmFtZVxuXG4gICAgICAgIHNvY2tldC5vbignYWxsLXBsYXllcnMnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW2FsbC1wbGF5ZXJzXScsIGRhdGEpO1xuICAgICAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICAgICAgY29uc3QgY2FyID0gbWFrZUNhck9iamVjdCgpO1xuICAgICAgICAgICAgICAgIHBsYXllcnNbcGxheWVyLmlkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb246IHJvdCxcbiAgICAgICAgICAgICAgICAgICAgY2FyOiBjYXJcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgICAgICAgICAgY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICBpZihkYXRhLmxlbmd0aCA9PSAwKXtcbiAgICAgICAgICAgICAgICBhZGRCb3hlcygpO1xuICAgICAgICAgICAgICAgIHNvY2tldC5lbWl0KCdzZW5kLWJveGVzJyxib3hlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWpvaW5lZCcsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItam9pbmVkXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XG4gICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxuICAgICAgICAgICAgICAgIGNhcjogY2FyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdyZWNlaXZlLWJveGVzJywgZnVuY3Rpb24oYm94cykge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1twbGF5ZXItbGVmdF0nLCBwbGF5ZXJJZCk7XG4gICAgICAgICAgICBib3hlcyA9IGJveHM7XG4gICAgICAgICAgICBhZGRCb3hlc1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAvLyBjb25zdCBjYXIgPSBwbGF5ZXJzW3BsYXllcklkXS4vL2NhcjtcbiAgICAgICAgICAgIC8vIHNjZW5lLnJlbW92ZShjYXIpO1xuICAgICAgICAgICAgLy8gZGVsZXRlIHBsYXllcnNbcGxheWVySWRdO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3BsYXllci1sZWZ0JywgZnVuY3Rpb24ocGxheWVySWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbcGxheWVyLWxlZnRdJywgcGxheWVySWQpO1xuICAgICAgICAgICAgY29uc3QgY2FyID0gcGxheWVyc1twbGF5ZXJJZF0uY2FyO1xuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGNhcik7XG4gICAgICAgICAgICBkZWxldGUgcGxheWVyc1twbGF5ZXJJZF07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigndXBkYXRlLXBsYXllcicsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1t1cGRhdGUtcGxheWVyXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBpZCA9IHBsYXllci5pZDtcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcbiAgICAgICAgICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydC1jb3VudGRvd24nLCBmdW5jdGlvbihzZWNvbmRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0YXJ0LWNvdW50ZG93bl0nLCBzZWNvbmRzKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgXCJ4IHNlY29uZHMgYmVmb3JlIHN0YXJ0XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydF0nKTtcbiAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB0aGUgZ2FtZSBoYXMgc3RhcnRlZFxuICAgICAgICAgICAgLy8gVE9ETzogZGlzYWJsZSBtb3ZpbmcgaWYgbm90IHN0YXJ0ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIGEgbmFtZSBmaXJzdCAoZG9uJ3QgaGlkZSBtb2RhbClcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIHRvIGJlIHJlYWR5XG4gICAgICAgICAgICAvLyBUT0RPOiAyKyBwbGF5ZXJzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignZmluaXNoZWQnLCBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW2ZpbmlzaGVkXScsIHRpbWUpO1xuICAgICAgICAgICAgLy8gVE9ETzogc2hvdyBtb2RhbCBcIndhaXRpbmcgZm9yIG90aGVycywgeW91ciB0aW1lIGlzIHhcIlxuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3N0b3AnLCBmdW5jdGlvbihwbGF5ZXJzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0b3BdJywgc3RvcCk7XG4gICAgICAgICAgICAvLyBUT0RPOiBhbGwgcGxheWVycyBhcmUgZmluaXNoZWQsIHNob3cgcmFua2luZyBhbmQgcGxheSBhZ2FpbiBidXR0b25cbiAgICAgICAgICAgIHBsYXllcnMuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBzb3J0ZWQgYnkgcmFua2luZyA6LSlcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gcGxheWVyLm5hbWU7XG4gICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IHRpbWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc3QgcCA9IFBsYXllci5wbGF5ZXJPYmplY3Q7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgndXBkYXRlLXBsYXllcicsIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICB4OiBwLnBvc2l0aW9uLngsXG4gICAgICAgICAgICAgICAgICAgIHk6IHAucG9zaXRpb24ueSxcbiAgICAgICAgICAgICAgICAgICAgejogcC5wb3NpdGlvbi56XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByb3RhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICB4OiBwLnJvdGF0aW9uLl94LFxuICAgICAgICAgICAgICAgICAgICB5OiBwLnJvdGF0aW9uLl95LFxuICAgICAgICAgICAgICAgICAgICB6OiBwLnJvdGF0aW9uLl96XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIDEwMDAgLyAyNSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZUNhck9iamVjdCgpIHtcbiAgICAgICAgY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLk9iamVjdExvYWRlcigpO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBidWlsZEZsb29yKCkge1xuICAgICAgICBsZXQgY3VydmUgPSBuZXcgVEhSRUUuQ2F0bXVsbFJvbUN1cnZlMyhbXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygtMjAwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgODAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDYwMCwgODAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDYwMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg4MDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAtNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIC01MDAsIDApXG4gICAgICAgIF0pO1xuICAgICAgICBjdXJ2ZS5jbG9zZWQgPSB0cnVlO1xuXG4gICAgICAgIGxldCBleHRydWRlU2V0dGluZ3MgPSB7XG4gICAgICAgICAgICBzdGVwczogMTAwLFxuICAgICAgICAgICAgZXh0cnVkZVBhdGg6IGN1cnZlXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU2hhcGUgdGhhdCBnZXRzIGV4dHJ1ZGVkIHRocm91Z2ggdGhlIGN1cnZlXG4gICAgICAgIGxldCBzaGFwZSA9IG5ldyBUSFJFRS5TaGFwZShbXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigyICogQ0FSX1NJWkVfWSwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigwLCA1ICogQ0FSX1NJWkVfWCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigwLCAtNSAqIENBUl9TSVpFX1gpXG4gICAgICAgIF0pO1xuXG4gICAgICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5FeHRydWRlR2VvbWV0cnkoc2hhcGUsIGV4dHJ1ZGVTZXR0aW5ncyk7XG5cbiAgICAgICAgbGV0IG1hdGVyaWFscyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTUJFUl9DT0xPUlM7IGkrKykge1xuICAgICAgICAgICAgbWF0ZXJpYWxzLnB1c2goXG4gICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IFJPQURfQ09MT1JTW2ldLFxuICAgICAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLFxuICAgICAgICAgICAgICAgICAgICAvL3dpcmVmcmFtZTogdHJ1ZSAvLyBUaGlzIG1ha2VzIHRyYWNrIG1vcmUgVHJvbi1saWtlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZ2VvRmFjZXNMZW5ndGggPSBnZW9tZXRyeS5mYWNlcy5sZW5ndGggLyAyO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdlb0ZhY2VzTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBqID0gaSAqIDI7IC8vIDwtLSBBZGRlZCB0aGlzIGJhY2sgc28gd2UgY2FuIGRvIGV2ZXJ5IG90aGVyICdmYWNlJ1xuXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqXS5tYXRlcmlhbEluZGV4ID1cbiAgICAgICAgICAgICAgICAoaSArIE1hdGguZmxvb3IoaSAvIFdPUkxEX1NJREVfU0laRSkpICUgTlVNQkVSX0NPTE9SUztcblxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbaiArIDFdLm1hdGVyaWFsSW5kZXggPVxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTOyAvLyBPdGhlciBoYWxmIG9mIHRoZSBzYW1lIGZhY2VcbiAgICAgICAgfVxuXG4gICAgICAgIGZsb29yID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFscyk7XG4gICAgICAgIGZsb29yLnJvdGF0ZVgoLU1hdGguUEkgLyAyKTtcbiAgICAgICAgZmxvb3IucG9zaXRpb24ueSA9IDA7XG5cbiAgICAgICAgc2NlbmUuYWRkKGZsb29yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRCb3hlcygpIHtcbiAgICAgICAgbGV0IG1pbiA9IC0yMDAwO1xuICAgICAgICBsZXQgbWF4ID0gIDIwMDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwMDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgcmFuZG9tIGJveC5cbiAgICAgICAgICAgIGxldCBib3ggPSBuZXcgQm94KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgobWF4LW1pbikrMSkgKyBtaW4pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgobWF4LW1pbikrMSkgKyBtaW4pKTtcbiAgICAgICAgICAgIC8vIEFkZCBvbmx5IGlmIGl0J3Mgb3ZlciB0aGUgZmxvb3IuXG4gICAgICAgICAgICBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpO1xuICAgICAgICAgICAgUGh5c2ljcy5ncmF2aXR5KGJveC5tZXNoLCBmbG9vcik7XG4gICAgICAgICAgICBpZiAoYm94Lm1lc2gucG9zaXRpb24ueSA9PSBCT1hfU0laRS8yKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0cy5wdXNoKGJveCk7XG4gICAgICAgICAgICAgICAgYm94ZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHg6IGJveC5tZXNoLnBvc2l0aW9uLngsXG4gICAgICAgICAgICAgICAgICAgIHo6IGJveC5tZXNoLnBvc2l0aW9uLnpcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoYm94Lm1lc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXNQb3NpdGlvbigpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib3hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChib3hlc1tpXS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveGVzW2ldLnopO1xuICAgICAgICAgICAgLy8gQWRkIG9ubHkgaWYgaXQncyBvdmVyIHRoZSBmbG9vci5cbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XG4gICAgICAgICAgICBQaHlzaWNzLmdyYXZpdHkoYm94Lm1lc2gsIGZsb29yKTtcbiAgICAgICAgICAgIGlmIChib3gubWVzaC5wb3NpdGlvbi55ID09IEJPWF9TSVpFLzIpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoYm94Lm1lc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEgsIFdJTkRPV19IRUlHSFQpO1xuICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgcmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhciA9IGZhbHNlO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICc1JSc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSAnNzAlJztcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJzInO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ3doaXRlIHNvbGlkJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnkgPSBUT1BfQ0FNRVJBX0RJU1Q7XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucm90YXRpb24ueCA9IC05MCAqIE1hdGguUEkgLyAxODA7XG5cbiAgICAgICAgYnVpbGRGbG9vcigpO1xuICAgICAgICAvLyBhZGRCb3hlcygpO1xuXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcbiAgICAgICAgaW5pdFNvY2tldEV2ZW50KCk7XG4gICAgICAgIGxvb3AoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb29wKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG5cbiAgICAgICAgcmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBQbGF5ZXIuZ2V0Q2FtZXJhKCkpO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5jbGVhcigpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRIIC8gNCwgV0lORE9XX0hFSUdIVCAvIDQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIucmVuZGVyKHNjZW5lLCBtaW5pTWFwQ2FtZXJhKTtcblxuICAgICAgICAvLyBmb3IgKGxldCBpZCBpbiBwbGF5ZXJzKSB7XG4gICAgICAgIC8vICAgICBjb25zdCBwID0gcGxheWVyc1tpZF07XG4gICAgICAgIC8vICAgICBjb25zdCBwb3MgPSBwLnBvc2l0aW9uO1xuICAgICAgICAvLyAgICAgY29uc3Qgcm90ID0gcC5yb3RhdGlvbjtcbiAgICAgICAgLy8gICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgLy8gICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIFBsYXllci5kb01vdmVtZW50TG9vcCgpO1xuICAgICAgICBpZiAoUGh5c2ljcy5kZXRlY3RDb2xsaXNpb24oUGxheWVyLnBsYXllck9iamVjdCwgb2JqZWN0cykpIHtcbiAgICAgICAgICAgIFBsYXllci5jcmFzaCgpO1xuICAgICAgICB9XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcblxuICAgICAgICBQaHlzaWNzLmdyYXZpdHkoUGxheWVyLnBsYXllck9iamVjdCwgZmxvb3IpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSkoKTtcbiJdfQ==
