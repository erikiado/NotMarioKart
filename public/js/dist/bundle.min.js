"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,MINICAM_FACTOR=1.5,BOX_SIZE=10,CHECK_SIZE=100,Physics=function(){var e=-1,t=new THREE.Vector3(0,-TOP_CAMERA_DIST,0),o=new THREE.Vector3(0,1,0),n=new THREE.Raycaster;return{gravity:function(i,r){t.x=i.position.x,t.z=i.position.z,n.set(t,o),(!n.intersectObject(r,!0).length||i.position.y<0)&&(i.position.y+=e)},detectCollision:function(e,t){for(var o=(new THREE.Box3).setFromObject(e),n=0;n<t.length;n++)if(o.intersectsBox(t[n].boundingBox))return!0;return!1},checkPoints:function(e,t){for(var o=(new THREE.Box3).setFromObject(e),n=0;n<t.length;n++)if(o.intersectsBox(t[n].boundingBox))return n;return-1}}}(),Checkpoint=function(e,t,o){var n=new THREE.BoxGeometry(CHECK_SIZE,BOX_SIZE,CHECK_SIZE),i=new THREE.MeshBasicMaterial({color:16777215,wireframe:!0});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=o,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Box=function(e,t,o){var n=new THREE.BoxGeometry(BOX_SIZE,BOX_SIZE,BOX_SIZE),i=new THREE.MeshBasicMaterial({color:11176004});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=o,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,i=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return t.position.y=2*e.scale.y,t.position.z=4*e.scale.z,t.rotateY(180*Math.PI/180),o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},a=r.movement.arrows,s=0,E=5,c=.05,l=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[a.up]&&s<E&&(s+=c),d[a.left]&&i.rotateY(l),d[a.right]&&i.rotateY(-l),d[a.down]&&s>0&&(s-=c,s=Math.max(0,s)),i.translateZ(s),d[r.switchCamera]&&(n=n===t?o:t,d[r.switchCamera]=!1),d[r.reset]&&(i.rotation.x=0,i.position.set(0,i.position.x,0),i.rotation.y=0,i.position.set(0,i.position.y,0),i.rotation.z=0,i.position.set(0,i.position.z,0),s=0)},playerObject:i,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}(),NotMarioKart=function(){function e(){(l=io({transports:["websocket"],upgrade:!1})).on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,i=t();y[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),d.add(i)}),0==e.length&&(i(),l.emit("send-boxes",T))}),l.on("player-joined",function(e){toastr.success("player "+e.id+" has joined."),console.log("[player-joined]",e);var o=e.position,n=e.rotation,i=t();y[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),d.add(i)}),l.on("receive-boxes",function(e){T=e,r()}),l.on("player-lap",function(){}),l.on("player-left",function(e){toastr.error("Player "+e+" has left."),console.log("[player-left]",e);var t=y[e].car;d.remove(t),delete y[e]}),l.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,i=y[t];i.car.position.set(o.x,o.y,o.z),i.car.rotation.set(n.x,n.y,n.z)}),l.on("start-countdown",function(e){toastr.info(e+" seconds before the race starts."),console.log("[start-countdown]",e)}),l.on("start",function(){toastr.info("The race has started."),console.log("[start]")}),l.on("finished",function(e){toastr.info("You finished."),console.log("[finished]",e)}),l.on("stop",function(e){toaster.info("The race is over."),console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var e=Player.playerObject;l.emit("update-player",{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation._x,y:e.rotation._y,z:e.rotation._z}})},40)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),i=[],r=0;r<NUMBER_COLORS;r++)i.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[r],side:THREE.DoubleSide}));for(var a=n.faces.length/2,s=0;s<a;s++){var c=2*s;n.faces[c].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[c+1].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS}(E=new THREE.Mesh(n,i)).rotateX(-Math.PI/2),E.position.y=0,d.add(E)}function n(){for(var e=[new THREE.Vector3(0,0,0),new THREE.Vector3(300,0,580),new THREE.Vector3(250,0,-200),new THREE.Vector3(200,0,-870),new THREE.Vector3(0,0,-500)],t=0;t<e.length;t++){var o=new Checkpoint(e[t].x,BOX_SIZE/2,e[t].z);d.updateMatrixWorld(),u.push(o),d.add(o.mesh)}}function i(){for(var e=0;e<1e3;e++){var t=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));d.updateMatrixWorld(),Physics.gravity(t.mesh,E),t.mesh.position.y==BOX_SIZE/2&&(I.push(t),T.push({x:t.mesh.position.x,z:t.mesh.position.z}),d.add(t.mesh))}}function r(){for(var e=0;e<T.length;e++){var t=new Box(T[e].x,BOX_SIZE/2,T[e].z);d.updateMatrixWorld(),Physics.gravity(t.mesh,E),t.mesh.position.y==BOX_SIZE/2&&(I.push(t),d.add(t.mesh))}}function a(){c==_+1&&(_=c),0==c&&4==_&&(_=c,H+=1,l.emit("player-lap",H))}function s(){requestAnimationFrame(s),p.clear(),p.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),p.render(d,Player.getCamera()),h.clear(),h.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),h.render(d,R),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,I)&&Player.crash(),-1!=(c=Physics.checkPoints(Player.playerObject,u))&&(w%10==0&&a(),w+=1,w%=10),R.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,E)}var E,c,l,d=new THREE.Scene,p=new THREE.WebGLRenderer,h=new THREE.WebGLRenderer,R=new THREE.OrthographicCamera(-WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_HEIGHT/MINICAM_FACTOR,-WINDOW_HEIGHT/MINICAM_FACTOR,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),I=[],u=[],y={},T=[],H=0,w=0,_=0;return{init:function(){p.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),p.setPixelRatio(window.devicePixelRatio),p.domElement.style.position="fixed",document.body.appendChild(p.domElement),p.autoClear=!1,h.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),h.setPixelRatio(window.devicePixelRatio),h.domElement.style.position="fixed",h.domElement.style.top="5%",h.domElement.style.left="70%",h.domElement.style.zIndex="2",h.domElement.style.outline="white solid",document.body.appendChild(h.domElement),h.autoClear=!1,R.position.y=TOP_CAMERA_DIST,R.rotation.x=-90*Math.PI/180,o(),n(),d.add(Player.playerObject),e(),s()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBoeXNpY3MuanMiLCJDaGVja3BvaW50LmpzIiwiQm94LmpzIiwiUGxheWVyLmpzIiwiTm90TWFyaW9LYXJ0LmpzIl0sIm5hbWVzIjpbIldPUkxEX1NJREVfU0laRSIsIldJTkRPV19IRUlHSFQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsIldJTkRPV19XSURUSCIsImlubmVyV2lkdGgiLCJST0FEX0NPTE9SUyIsIk5VTUJFUl9DT0xPUlMiLCJsZW5ndGgiLCJXT1JMRF9IRUlHSFQiLCJXT1JMRF9XSURUSCIsIlRPUF9DQU1FUkFfRElTVCIsIkNBUl9TSVpFX1giLCJDQVJfU0laRV9ZIiwiQ0FSX1NJWkVfWiIsIk1JTklDQU1fRkFDVE9SIiwiQk9YX1NJWkUiLCJDSEVDS19TSVpFIiwiUGh5c2ljcyIsImciLCJoZWxsIiwiVEhSRUUiLCJWZWN0b3IzIiwib25lRGlyZWN0aW9uIiwicmF5Y2FzdGVyIiwiUmF5Y2FzdGVyIiwiZ3Jhdml0eSIsIm9iamVjdCIsImZsb29yIiwieCIsInBvc2l0aW9uIiwieiIsInNldCIsImludGVyc2VjdE9iamVjdCIsInkiLCJkZXRlY3RDb2xsaXNpb24iLCJjYXIiLCJvYmplY3RzIiwiY2FyQm94IiwiQm94MyIsInNldEZyb21PYmplY3QiLCJpIiwiaW50ZXJzZWN0c0JveCIsImJvdW5kaW5nQm94IiwiY2hlY2tQb2ludHMiLCJDaGVja3BvaW50IiwiZ2VvbWV0cnkiLCJCb3hHZW9tZXRyeSIsIm1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsIndpcmVmcmFtZSIsInRoaXMiLCJtZXNoIiwiTWVzaCIsIkJveCIsIlBsYXllciIsIm9uS2V5TW92ZSIsImUiLCJldmVudCIsImtleUNvZGVNYXAiLCJ3aGljaCIsInR5cGUiLCJwb3ZDYW1lcmEiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInRyYWNraW5nQ2FtZXJhIiwiY3VycmVudENhbWVyYSIsInBsYXllck9iamVjdCIsIk9iamVjdExvYWRlciIsInBhcnNlIiwicGxheWVyQ2FyIiwic2NhbGUiLCJyb3RhdGVZIiwiTWF0aCIsIlBJIiwiYWRkIiwibWFrZVBsYXllck9iamVjdCIsImNvbnRyb2xzIiwibW92ZW1lbnQiLCJhcnJvd3MiLCJ1cCIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJ3YXNkIiwic3dpdGNoQ2FtZXJhIiwicmVzZXQiLCJlbmFibGVkQ29udHJvbHMiLCJzcGVlZCIsIm1heFNwZWVkIiwiYWNjZWxlcmF0aW9uIiwicm90YXRpb25TcGVlZCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRvTW92ZW1lbnRMb29wIiwibWF4IiwidHJhbnNsYXRlWiIsInJvdGF0aW9uIiwiZ2V0Q2FtZXJhIiwicGxheWVySWQiLCJjcmFzaCIsIk5vdE1hcmlvS2FydCIsImluaXRTb2NrZXRFdmVudCIsInNvY2tldCIsImlvIiwidHJhbnNwb3J0cyIsInVwZ3JhZGUiLCJvbiIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsInBsYXllciIsInBvcyIsInJvdCIsIm1ha2VDYXJPYmplY3QiLCJwbGF5ZXJzIiwiaWQiLCJzY2VuZSIsImFkZEJveGVzIiwiZW1pdCIsImJveGVzIiwidG9hc3RyIiwic3VjY2VzcyIsImJveHMiLCJhZGRCb3hlc1Bvc2l0aW9uIiwiZXJyb3IiLCJyZW1vdmUiLCJwIiwic2Vjb25kcyIsImluZm8iLCJ0aW1lIiwidG9hc3RlciIsInN0b3AiLCJuYW1lIiwic2V0SW50ZXJ2YWwiLCJfeCIsIl95IiwiX3oiLCJidWlsZEZsb29yIiwiY3VydmUiLCJDYXRtdWxsUm9tQ3VydmUzIiwiY2xvc2VkIiwiZXh0cnVkZVNldHRpbmdzIiwic3RlcHMiLCJleHRydWRlUGF0aCIsInNoYXBlIiwiU2hhcGUiLCJWZWN0b3IyIiwiRXh0cnVkZUdlb21ldHJ5IiwibWF0ZXJpYWxzIiwicHVzaCIsInNpZGUiLCJEb3VibGVTaWRlIiwiZ2VvRmFjZXNMZW5ndGgiLCJmYWNlcyIsImoiLCJtYXRlcmlhbEluZGV4Iiwicm90YXRlWCIsImFkZENoZWNrcG9pbnRzIiwiY3VydmVQb2ludHMiLCJjaGVjayIsInVwZGF0ZU1hdHJpeFdvcmxkIiwiY2hlY2twb2ludHMiLCJib3giLCJyYW5kb20iLCJjaGVja0xhcCIsImN1cnJlbnRDaGVja3BvaW50IiwibGFzdENoZWNrcG9pbnQiLCJsYXAiLCJsb29wIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyZXIiLCJjbGVhciIsInNldFZpZXdwb3J0IiwicmVuZGVyIiwibWluaU1hcFJlbmRlcmVyIiwibWluaU1hcENhbWVyYSIsImNoZWNrTGFwQ291bnQiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwiekluZGV4Iiwib3V0bGluZSJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0EsTUFDQSxJQUNBLFVBRUVDLGNBQWdCRCxZQUFZRSxPQUM1QkMsYUFBZSxJQUNmQyxZQUFjLElBQ2RDLGdCQUFrQixHQUNsQkMsV0FBYSxHQUNiQyxXQUFhLEdBQ2JDLFdBQWEsR0FDYkMsZUFBaUIsSUFDakJDLFNBQVcsR0FDWEMsV0FBYSxJQ3JCYkMsUUFBVyxXQUViLElBQU1DLEdBQUssRUFDUEMsRUFBTyxJQUFJQyxNQUFNQyxRQUFRLEdBQUlYLGdCQUFpQixHQUM5Q1ksRUFBZSxJQUFJRixNQUFNQyxRQUFRLEVBQUcsRUFBRyxHQUN2Q0UsRUFBWSxJQUFJSCxNQUFNSSxVQW1DMUIsT0FDSUMsUUFsQ0osU0FBaUJDLEVBQVFDLEdBRXJCUixFQUFLUyxFQUFJRixFQUFPRyxTQUFTRCxFQUN6QlQsRUFBS1csRUFBSUos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SyxHQUFLNEMsS0FBS0MsR0FBSyxJQUUzQ2lFLElBRUFvQixJQUVBekMsRUFBTTNDLElBQUluQixPQUFPVyxjQUNqQm1DLElBQ0FvRSxNQXZUYyIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cbiAqL1xuXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xuY29uc3QgV0lORE9XX0hFSUdIVCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbmNvbnN0IFdJTkRPV19XSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuY29uc3QgUk9BRF9DT0xPUlMgPSBbXG4gICAgMHhmZjAwMDAsXG4gICAgMHhmZjg4MDAsXG4gICAgMHhmZmZmMDAsXG4gICAgMHgwMGZmMDAsXG4gICAgMHgwMGZmZmYsXG4gICAgMHgwMDAwZmYsXG4gICAgMHhmZjAwZmZcbl07XG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xuY29uc3QgV09STERfSEVJR0hUID0gMTAwMDtcbmNvbnN0IFdPUkxEX1dJRFRIID0gMTAwO1xuY29uc3QgVE9QX0NBTUVSQV9ESVNUID0gNTA7XG5jb25zdCBDQVJfU0laRV9YID0gMTA7XG5jb25zdCBDQVJfU0laRV9ZID0gMTA7XG5jb25zdCBDQVJfU0laRV9aID0gMTA7XG5jb25zdCBNSU5JQ0FNX0ZBQ1RPUiA9IDEuNTtcbmNvbnN0IEJPWF9TSVpFID0gMTA7XG5jb25zdCBDSEVDS19TSVpFID0gMTAwO1xuIiwiLyoqXG4gKiBQaHlzaWNzIFwiZW5naW5lXCIgZm9yIHRoZSBnYW1lLlxuICogTm90UGh5c2lqcyBmb3IgTm90TWFyaW9LYXJ0LlxuICovXG5jb25zdCBQaHlzaWNzID0gKGZ1bmN0aW9uKCkge1xuXG4gICAgY29uc3QgZyA9IC0xO1xuICAgIGxldCBoZWxsID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgLVRPUF9DQU1FUkFfRElTVCwgMCk7XG4gICAgbGV0IG9uZURpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDEsIDApO1xuICAgIGxldCByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7XG5cbiAgICBmdW5jdGlvbiBncmF2aXR5KG9iamVjdCwgZmxvb3IpIHtcbiAgICAgICAgLy8gVXBkYXRlIHJheWNhc3RlciB3aXRoIGFuIG9yaWdpbiBiZWxvdyB0aGUgb2JqZWN0LlxuICAgICAgICBoZWxsLnggPSBvYmplY3QucG9zaXRpb24ueDtcbiAgICAgICAgaGVsbC56ID0gb2JqZWN0LnBvc2l0aW9uLno7XG4gICAgICAgIHJheWNhc3Rlci5zZXQoaGVsbCwgb25lRGlyZWN0aW9uKTtcblxuICAgICAgICAvLyBUcnkgdG8gaW50ZXJzZWN0IHdpdGggZmxvb3IuXG4gICAgICAgIGxldCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdChmbG9vciwgdHJ1ZSk7XG4gICAgICAgIGlmICghaW50ZXJzZWN0cy5sZW5ndGggfHwgb2JqZWN0LnBvc2l0aW9uLnkgPCAwKSB7XG4gICAgICAgICAgICBvYmplY3QucG9zaXRpb24ueSArPSBnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGV0ZWN0Q29sbGlzaW9uKGNhciwgb2JqZWN0cykge1xuICAgICAgICBsZXQgY2FyQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KGNhcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGNhckJveC5pbnRlcnNlY3RzQm94KG9iamVjdHNbaV0uYm91bmRpbmdCb3gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrUG9pbnRzKGNhciwgb2JqZWN0cykge1xuICAgICAgICBsZXQgY2FyQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KGNhcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGNhckJveC5pbnRlcnNlY3RzQm94KG9iamVjdHNbaV0uYm91bmRpbmdCb3gpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdyYXZpdHk6IGdyYXZpdHksXG4gICAgICAgIGRldGVjdENvbGxpc2lvbjogZGV0ZWN0Q29sbGlzaW9uLFxuICAgICAgICBjaGVja1BvaW50czogY2hlY2tQb2ludHNcbiAgICB9O1xufSkoKTtcbiIsIi8qKlxuICogQm94ZXMgcmVwcmVzZW50aW5nIG9ic3RhY2xlcy5cbiAqL1xuY29uc3QgQ2hlY2twb2ludCA9IChmdW5jdGlvbih4LCB5LCB6KSB7XG4gICAgbGV0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCBDSEVDS19TSVpFLCBCT1hfU0laRSwgQ0hFQ0tfU0laRSApO1xuICAgIGxldCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCgge2NvbG9yOiAweGZmZmZmZiwgd2lyZWZyYW1lOnRydWV9ICk7XG4gICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi54ID0geDtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IHk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnogPSB6O1xuICAgIHRoaXMuYm91bmRpbmdCb3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QodGhpcy5tZXNoKTtcbn0pO1xuIiwiLyoqXG4gKiBCb3hlcyByZXByZXNlbnRpbmcgb2JzdGFjbGVzLlxuICovXG5jb25zdCBCb3ggPSAoZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIGxldCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggQk9YX1NJWkUsIEJPWF9TSVpFLCBCT1hfU0laRSApO1xuICAgIGxldCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCgge2NvbG9yOiAweGFhODg0NH0gKTtcbiAgICB0aGlzLm1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnggPSB4O1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi55ID0geTtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueiA9IHo7XG4gICAgdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBUSFJFRS5Cb3gzKCkuc2V0RnJvbU9iamVjdCh0aGlzLm1lc2gpO1xufSk7XG4iLCIvKipcbiAqIEV2ZXJ5dGhpbmcgYWJvdXQgdGhlIFBsYXllciBvYmplY3QsIGl0cyBjYW1lcmEsIHRoZSBtb3ZlbWVudHMgLi4uXG4gKi9cblxuY29uc3QgUGxheWVyID0gKGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHBvdkNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcbiAgICAgICAgNzUsXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXG4gICAgICAgIDAuMSxcbiAgICAgICAgMTAwMFxuICAgICk7XG5cbiAgICBjb25zdCB0cmFja2luZ0NhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcbiAgICAgICAgNzUsXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXG4gICAgICAgIDAuMSxcbiAgICAgICAgMTAwMFxuICAgICk7XG5cbiAgICBsZXQgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgIGxldCBnZXRDYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRDYW1lcmE7XG4gICAgfTtcblxuICAgIGNvbnN0IHBsYXllck9iamVjdCA9IG1ha2VQbGF5ZXJPYmplY3QoKTtcbiAgICB2YXIgcGxheWVySWQgPSBudWxsO1xuXG4gICAgY29uc3QgY29udHJvbHMgPSB7XG4gICAgICAgIG1vdmVtZW50OiB7XG4gICAgICAgICAgICBhcnJvd3M6IHtcbiAgICAgICAgICAgICAgICB1cDogMzgsXG4gICAgICAgICAgICAgICAgZG93bjogNDAsXG4gICAgICAgICAgICAgICAgbGVmdDogMzcsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDM5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd2FzZDoge1xuICAgICAgICAgICAgICAgIHVwOiA4NyxcbiAgICAgICAgICAgICAgICBkb3duOiA4MyxcbiAgICAgICAgICAgICAgICBsZWZ0OiA2NSxcbiAgICAgICAgICAgICAgICByaWdodDogNjhcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3dpdGNoQ2FtZXJhOiA2NyxcbiAgICAgICAgcmVzZXQ6IDhcbiAgICB9O1xuXG4gICAgbGV0IGVuYWJsZWRDb250cm9scyA9IGNvbnRyb2xzLm1vdmVtZW50LmFycm93cztcblxuICAgIGxldCBzcGVlZCA9IDA7XG4gICAgbGV0IG1heFNwZWVkID0gNTtcbiAgICBjb25zdCBhY2NlbGVyYXRpb24gPSAwLjA1O1xuICAgIGNvbnN0IHJvdGF0aW9uU3BlZWQgPSAwLjA1O1xuXG4gICAgY29uc3Qga2V5Q29kZU1hcCA9IHt9O1xuXG4gICAgZnVuY3Rpb24gb25LZXlNb3ZlKGUpIHtcbiAgICAgICAgZSA9IGUgfHwgZXZlbnQ7IC8vIEZvciBJRS5cbiAgICAgICAga2V5Q29kZU1hcFtlLndoaWNoXSA9IGUudHlwZSA9PT0gJ2tleWRvd24nO1xuICAgIH1cblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleU1vdmUsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIG9uS2V5TW92ZSwgZmFsc2UpO1xuXG4gICAgZnVuY3Rpb24gZG9Nb3ZlbWVudExvb3AoKSB7XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy51cF0pIHtcbiAgICAgICAgICAgIGlmIChzcGVlZCA8IG1heFNwZWVkKSB7XG4gICAgICAgICAgICAgICAgc3BlZWQgKz0gYWNjZWxlcmF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5sZWZ0XSkge1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0ZVkocm90YXRpb25TcGVlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLnJpZ2h0XSkge1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0ZVkoLXJvdGF0aW9uU3BlZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5kb3duXSkge1xuICAgICAgICAgICAgaWYgKHNwZWVkID4gMCkge1xuICAgICAgICAgICAgICAgIHNwZWVkIC09IGFjY2VsZXJhdGlvbjtcbiAgICAgICAgICAgICAgICBzcGVlZCA9IE1hdGgubWF4KDAsIHNwZWVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWihzcGVlZCk7XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnN3aXRjaENhbWVyYV0pIHtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FtZXJhID09PSBwb3ZDYW1lcmEpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2FtZXJhID0gdHJhY2tpbmdDYW1lcmE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSBwb3ZDYW1lcmE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBrZXlDb2RlTWFwW2NvbnRyb2xzLnN3aXRjaENhbWVyYV0gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5yZXNldF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGlvbi54ID0gMDtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLngsIDApO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnkgPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueSwgMCk7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueiA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi56LCAwKTtcbiAgICAgICAgICAgIHNwZWVkID0gMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyYXNoKCkge1xuICAgICAgICAvLyBhY2NlbGVyYXRpb24gPSAwO1xuICAgICAgICBzcGVlZCA9IDA7XG4gICAgICAgIC8vIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy51cF0pIHtcbiAgICAgICAgLy8gICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKC1zcGVlZCk7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWihzcGVlZCk7XG4gICAgICAgIC8vIH1cblxuICAgICAgICAvLyBmb3IgKHZhciBpID0gZ3JvdXBCbG9ja3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgLy8gbGV0IHBvcyA9IGdyb3VwQmxvY2tzW2ldLnBvc2l0aW9uO1xuICAgICAgICAvLyAgICAgbGV0IHBvID0gcGxheWVyT2JqZWN0LmNoaWxkcmVuWzJdLmNoaWxkcmVuWzBdXG4gICAgICAgIC8vIGZvciAodmFyIHZlcnRleEluZGV4ID0gMDsgdmVydGV4SW5kZXggPCBwby5nZW9tZXRyeS52ZXJ0aWNlcy5sZW5ndGg7IHZlcnRleEluZGV4KyspXG4gICAgICAgIC8vIHtcbiAgICAgICAgLy8gICAgIHZhciBsb2NhbFZlcnRleCA9IHBvLmdlb21ldHJ5LnZlcnRpY2VzW3ZlcnRleEluZGV4XS5jbG9uZSgpO1xuICAgICAgICAvLyAgICAgdmFyIGdsb2JhbFZlcnRleCA9IGxvY2FsVmVydGV4LmFwcGx5TWF0cml4cGxheWVyT2JqZWN0Lm1hdHJpeC5tdWx0aXBseVZlY3RvcjMoKTtcbiAgICAgICAgLy8gICAgIHZhciBkaXJlY3Rpb25WZWN0b3IgPSBnbG9iYWxWZXJ0ZXguc3ViU2VsZiggcG8ucG9zaXRpb24gKTtcblxuICAgICAgICAvLyAgICAgdmFyIHJheSA9IG5ldyBUSFJFRS5SYXkoIHBvLnBvc2l0aW9uLCBkaXJlY3Rpb25WZWN0b3IuY2xvbmUoKS5ub3JtYWxpemUoKSApO1xuICAgICAgICAvLyAgICAgdmFyIGNvbGxpc2lvblJlc3VsdHMgPSByYXkuaW50ZXJzZWN0T2JqZWN0cyggZ3JvdXBCbG9ja3MgKTtcbiAgICAgICAgLy8gICAgIGlmICggY29sbGlzaW9uUmVzdWx0cy5sZW5ndGggPiAwICYmIGNvbGxpc2lvblJlc3VsdHNbMF0uZGlzdGFuY2UgPCBkaXJlY3Rpb25WZWN0b3IubGVuZ3RoKCkgKVxuICAgICAgICAvLyAgICAge1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdwZXJkaXN0cmUnKVxuICAgICAgICAvLyAgICAgICAgIC8vIGEgY29sbGlzaW9uIG9jY3VycmVkLi4uIGRvIHNvbWV0aGluZy4uLlxuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyB9XG4gICAgICAgIC8vIGlmKChwbGF5ZXJPYmplY3QucG9zaXRpb24ueCs1IDwgcG9zLnggJiYgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnorNSA8IHBvcy56KXx8IChwbGF5ZXJPYmplY3QucG9zaXRpb24ueC01ID4gcG9zLnggJiYgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnorNSA+IHBvcy56KSlcbiAgICAgICAgLy8gY29uc29sZS5sb2coZ3JvdXBCbG9ja3NbaV0pXG4gICAgICAgIC8vIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWtlUGxheWVyT2JqZWN0KCkge1xuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuT2JqZWN0TG9hZGVyKCk7XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IGxvYWRlci5wYXJzZShwbGF5ZXJDYXIpO1xuXG4gICAgICAgIHBvdkNhbWVyYS5wb3NpdGlvbi55ID0gb2JqZWN0LnNjYWxlLnkgKiAyO1xuICAgICAgICBwb3ZDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogNDtcbiAgICAgICAgLy8gdHJhY2tpbmdDYW1lcmEucm90YXRlWCgwICogTWF0aC5QSSAvIDE4MCk7XG4gICAgICAgIHBvdkNhbWVyYS5yb3RhdGVZKDE4MCAqIE1hdGguUEkgLyAxODApO1xuXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnkgPSBvYmplY3Quc2NhbGUueSAqIDEwO1xuICAgICAgICB0cmFja2luZ0NhbWVyYS5wb3NpdGlvbi56ID0gb2JqZWN0LnNjYWxlLnogKiAtMjA7XG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xuICAgICAgICB0cmFja2luZ0NhbWVyYS5yb3RhdGVZKDE4MCAqIE1hdGguUEkgLyAxODApO1xuXG4gICAgICAgIG9iamVjdC5hZGQocG92Q2FtZXJhKTtcbiAgICAgICAgb2JqZWN0LmFkZCh0cmFja2luZ0NhbWVyYSk7XG5cbiAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBkb01vdmVtZW50TG9vcDogZG9Nb3ZlbWVudExvb3AsXG4gICAgICAgIHBsYXllck9iamVjdDogcGxheWVyT2JqZWN0LFxuICAgICAgICBnZXRDYW1lcmE6IGdldENhbWVyYSxcbiAgICAgICAgcGxheWVySWQ6IHBsYXllcklkLFxuICAgICAgICBjcmFzaDogY3Jhc2hcbiAgICB9O1xufSkoKTtcbiIsIi8qKlxuICogTWFpbiBmaWxlIG9mIHRoZSBnYW1lLlxuICovXG5cbmNvbnN0IE5vdE1hcmlvS2FydCA9IChmdW5jdGlvbigpIHtcbiAgICBjb25zdCBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcbiAgICBjb25zdCBtaW5pTWFwUmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgIGNvbnN0IG1pbmlNYXBDYW1lcmEgPSBuZXcgVEhSRUUuT3J0aG9ncmFwaGljQ2FtZXJhKFxuICAgICAgICAtV0lORE9XX1dJRFRIL01JTklDQU1fRkFDVE9SLFxuICAgICAgICBXSU5ET1dfV0lEVEgvTUlOSUNBTV9GQUNUT1IsXG4gICAgICAgIFdJTkRPV19IRUlHSFQvTUlOSUNBTV9GQUNUT1IsXG4gICAgICAgIC1XSU5ET1dfSEVJR0hUL01JTklDQU1fRkFDVE9SLFxuICAgICAgICBUT1BfQ0FNRVJBX0RJU1QgLSA1MCxcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUICsgNTBcbiAgICApO1xuICAgIHZhciBmbG9vcjtcbiAgICAvL0JveCBvYmplY3RzXG4gICAgdmFyIG9iamVjdHMgPSBbXTtcbiAgICB2YXIgY2hlY2twb2ludHMgPSBbXTtcbiAgICBjb25zdCBwbGF5ZXJzID0ge307XG4gICAgLy9Cb3ggcG9zaXRpb25zIGZvciBvdGhlciBwbGF5ZXJzXG4gICAgdmFyIGJveGVzID0gW107XG4gICAgdmFyIGxhcCA9IDA7XG4gICAgdmFyIGNoZWNrTGFwQ291bnQgPSAwO1xuICAgIHZhciBjdXJyZW50Q2hlY2twb2ludDtcbiAgICB2YXIgbGFzdENoZWNrcG9pbnQgPSAwO1xuICAgIHZhciBzb2NrZXQ7XG5cbiAgICBmdW5jdGlvbiBpbml0U29ja2V0RXZlbnQoKSB7XG4gICAgICAgIHNvY2tldCA9IGlvKHsgdHJhbnNwb3J0czogWyd3ZWJzb2NrZXQnXSwgdXBncmFkZTogZmFsc2UgfSk7XG5cbiAgICAgICAgLy8gVE9ETzogc2hvdyBtb2RhbCB3aXRoIG5hbWUgZm9ybSwgdGhlbiBlbWl0IG5hbWVcblxuICAgICAgICBzb2NrZXQub24oJ2FsbC1wbGF5ZXJzJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1thbGwtcGxheWVyc10nLCBkYXRhKTtcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gcGxheWVyLnJvdGF0aW9uO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhciA9IG1ha2VDYXJPYmplY3QoKTtcbiAgICAgICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3MsXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiByb3QsXG4gICAgICAgICAgICAgICAgICAgIGNhcjogY2FyXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBjYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xuICAgICAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGNhcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgICAgICAgaWYoZGF0YS5sZW5ndGggPT0gMCl7XG4gICAgICAgICAgICAgICAgYWRkQm94ZXMoKTtcbiAgICAgICAgICAgICAgICBzb2NrZXQuZW1pdCgnc2VuZC1ib3hlcycsYm94ZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3BsYXllci1qb2luZWQnLCBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKGBwbGF5ZXIgJHtwbGF5ZXIuaWR9IGhhcyBqb2luZWQuYCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3BsYXllci1qb2luZWRdJywgcGxheWVyKTtcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IG1ha2VDYXJPYmplY3QoKTtcbiAgICAgICAgICAgIHBsYXllcnNbcGxheWVyLmlkXSA9IHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zLFxuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiByb3QsXG4gICAgICAgICAgICAgICAgY2FyOiBjYXJcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xuICAgICAgICAgICAgY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgICAgIHNjZW5lLmFkZChjYXIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3JlY2VpdmUtYm94ZXMnLCBmdW5jdGlvbihib3hzKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnW3BsYXllci1sZWZ0XScsIHBsYXllcklkKTtcbiAgICAgICAgICAgIGJveGVzID0gYm94cztcbiAgICAgICAgICAgIGFkZEJveGVzUG9zaXRpb24oKTtcbiAgICAgICAgICAgIC8vIGNvbnN0IGNhciA9IHBsYXllcnNbcGxheWVySWRdLi8vY2FyO1xuICAgICAgICAgICAgLy8gc2NlbmUucmVtb3ZlKGNhcik7XG4gICAgICAgICAgICAvLyBkZWxldGUgcGxheWVyc1twbGF5ZXJJZF07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWxhcCcsIGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItbGVmdCcsIGZ1bmN0aW9uKHBsYXllcklkKSB7XG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IoYFBsYXllciAke3BsYXllcklkfSBoYXMgbGVmdC5gKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbcGxheWVyLWxlZnRdJywgcGxheWVySWQpO1xuICAgICAgICAgICAgY29uc3QgY2FyID0gcGxheWVyc1twbGF5ZXJJZF0uY2FyO1xuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGNhcik7XG4gICAgICAgICAgICBkZWxldGUgcGxheWVyc1twbGF5ZXJJZF07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigndXBkYXRlLXBsYXllcicsIGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1t1cGRhdGUtcGxheWVyXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBpZCA9IHBsYXllci5pZDtcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcbiAgICAgICAgICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydC1jb3VudGRvd24nLCBmdW5jdGlvbihzZWNvbmRzKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhgJHtzZWNvbmRzfSBzZWNvbmRzIGJlZm9yZSB0aGUgcmFjZSBzdGFydHMuYCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0YXJ0LWNvdW50ZG93bl0nLCBzZWNvbmRzKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgXCJ4IHNlY29uZHMgYmVmb3JlIHN0YXJ0XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1RoZSByYWNlIGhhcyBzdGFydGVkLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydF0nKTtcbiAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB0aGUgZ2FtZSBoYXMgc3RhcnRlZFxuICAgICAgICAgICAgLy8gVE9ETzogZGlzYWJsZSBtb3ZpbmcgaWYgbm90IHN0YXJ0ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIGEgbmFtZSBmaXJzdCAoZG9uJ3QgaGlkZSBtb2RhbClcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIHRvIGJlIHJlYWR5XG4gICAgICAgICAgICAvLyBUT0RPOiAyKyBwbGF5ZXJzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignZmluaXNoZWQnLCBmdW5jdGlvbih0aW1lKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbygnWW91IGZpbmlzaGVkLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tmaW5pc2hlZF0nLCB0aW1lKTtcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgXCJ3YWl0aW5nIGZvciBvdGhlcnMsIHlvdXIgdGltZSBpcyB4XCJcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdzdG9wJywgZnVuY3Rpb24ocGxheWVycykge1xuICAgICAgICAgICAgdG9hc3Rlci5pbmZvKCdUaGUgcmFjZSBpcyBvdmVyLicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdG9wXScsIHN0b3ApO1xuICAgICAgICAgICAgLy8gVE9ETzogYWxsIHBsYXllcnMgYXJlIGZpbmlzaGVkLCBzaG93IHJhbmtpbmcgYW5kIHBsYXkgYWdhaW4gYnV0dG9uXG4gICAgICAgICAgICBwbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICAgICAgLy8gc29ydGVkIGJ5IHJhbmtpbmcgOi0pXG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBsYXllci5uYW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aW1lO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHAgPSBQbGF5ZXIucGxheWVyT2JqZWN0O1xuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3VwZGF0ZS1wbGF5ZXInLCB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgICAgICB5OiBwLnBvc2l0aW9uLnksXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucG9zaXRpb24uelxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgeDogcC5yb3RhdGlvbi5feCxcbiAgICAgICAgICAgICAgICAgICAgeTogcC5yb3RhdGlvbi5feSxcbiAgICAgICAgICAgICAgICAgICAgejogcC5yb3RhdGlvbi5felxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCAxMDAwIC8gMjUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VDYXJPYmplY3QoKSB7XG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnVpbGRGbG9vcigpIHtcbiAgICAgICAgbGV0IGN1cnZlID0gbmV3IFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDgwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgLTUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAtNTAwLCAwKVxuICAgICAgICBdKTtcbiAgICAgICAgY3VydmUuY2xvc2VkID0gdHJ1ZTtcblxuICAgICAgICBsZXQgZXh0cnVkZVNldHRpbmdzID0ge1xuICAgICAgICAgICAgc3RlcHM6IDEwMCxcbiAgICAgICAgICAgIGV4dHJ1ZGVQYXRoOiBjdXJ2ZVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFNoYXBlIHRoYXQgZ2V0cyBleHRydWRlZCB0aHJvdWdoIHRoZSBjdXJ2ZVxuICAgICAgICBsZXQgc2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoW1xuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMiAqIENBUl9TSVpFX1ksIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgNSAqIENBUl9TSVpFX1gpLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgLTUgKiBDQVJfU0laRV9YKVxuICAgICAgICBdKTtcblxuICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuRXh0cnVkZUdlb21ldHJ5KHNoYXBlLCBleHRydWRlU2V0dGluZ3MpO1xuXG4gICAgICAgIGxldCBtYXRlcmlhbHMgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1CRVJfQ09MT1JTOyBpKyspIHtcbiAgICAgICAgICAgIG1hdGVyaWFscy5wdXNoKFxuICAgICAgICAgICAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBST0FEX0NPTE9SU1tpXSxcbiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZSxcbiAgICAgICAgICAgICAgICAgICAgLy93aXJlZnJhbWU6IHRydWUgLy8gVGhpcyBtYWtlcyB0cmFjayBtb3JlIFRyb24tbGlrZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW9GYWNlc0xlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaiA9IGkgKiAyOyAvLyA8LS0gQWRkZWQgdGhpcyBiYWNrIHNvIHdlIGNhbiBkbyBldmVyeSBvdGhlciAnZmFjZSdcblxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbal0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7XG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2ogKyAxXS5tYXRlcmlhbEluZGV4ID1cbiAgICAgICAgICAgICAgICAoaSArIE1hdGguZmxvb3IoaSAvIFdPUkxEX1NJREVfU0laRSkpICUgTlVNQkVSX0NPTE9SUzsgLy8gT3RoZXIgaGFsZiBvZiB0aGUgc2FtZSBmYWNlXG4gICAgICAgIH1cblxuICAgICAgICBmbG9vciA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbHMpO1xuICAgICAgICBmbG9vci5yb3RhdGVYKC1NYXRoLlBJIC8gMik7XG4gICAgICAgIGZsb29yLnBvc2l0aW9uLnkgPSAwO1xuXG4gICAgICAgIHNjZW5lLmFkZChmbG9vcik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQ2hlY2twb2ludHMoKSB7XG4gICAgICAgIGxldCBjdXJ2ZVBvaW50cyA9IFtcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMzAwLCAwLCA1ODApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMjUwLCAwLCAtMjAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDIwMCwgMCwgLTg3MCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtNTAwKSxcbiAgICAgICAgXTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnZlUG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjdXJ2ZVBvaW50c1tpXSk7XG4gICAgICAgICAgICBsZXQgY2hlY2sgPSBuZXcgQ2hlY2twb2ludChjdXJ2ZVBvaW50c1tpXS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnZlUG9pbnRzW2ldLnopO1xuICAgICAgICAgICAgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTtcbiAgICAgICAgICAgIC8vIGlmIChpICE9IGN1cnZlUG9pbnRzLmxlbmd0aC0xKSB7XG4gICAgICAgICAgICAgICAgY2hlY2twb2ludHMucHVzaChjaGVjayk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGNoZWNrLm1lc2gpO1xuICAgICAgICAgICAgLy8gfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXMoKSB7XG4gICAgICAgIGxldCBtaW4gPSAtMjAwMDtcbiAgICAgICAgbGV0IG1heCA9ICAyMDAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoKG1heC1taW4pKzEpICsgbWluKSk7XG4gICAgICAgICAgICAvLyBBZGQgb25seSBpZiBpdCdzIG92ZXIgdGhlIGZsb29yLlxuICAgICAgICAgICAgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTtcbiAgICAgICAgICAgIFBoeXNpY3MuZ3Jhdml0eShib3gubWVzaCwgZmxvb3IpO1xuICAgICAgICAgICAgaWYgKGJveC5tZXNoLnBvc2l0aW9uLnkgPT0gQk9YX1NJWkUvMikge1xuICAgICAgICAgICAgICAgIG9iamVjdHMucHVzaChib3gpO1xuICAgICAgICAgICAgICAgIGJveGVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB4OiBib3gubWVzaC5wb3NpdGlvbi54LFxuICAgICAgICAgICAgICAgICAgICB6OiBib3gubWVzaC5wb3NpdGlvbi56XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGJveC5tZXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gYWRkQm94ZXNQb3NpdGlvbigpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib3hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJhbmRvbSBib3guXG4gICAgICAgICAgICBsZXQgYm94ID0gbmV3IEJveChib3hlc1tpXS54LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQk9YX1NJWkUvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveGVzW2ldLnopO1xuICAgICAgICAgICAgLy8gQWRkIG9ubHkgaWYgaXQncyBvdmVyIHRoZSBmbG9vci5cbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XG4gICAgICAgICAgICBQaHlzaWNzLmdyYXZpdHkoYm94Lm1lc2gsIGZsb29yKTtcbiAgICAgICAgICAgIGlmIChib3gubWVzaC5wb3NpdGlvbi55ID09IEJPWF9TSVpFLzIpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoYm94Lm1lc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hlY2tMYXAoKXtcbiAgICAgICAgaWYoY3VycmVudENoZWNrcG9pbnQgPT0gbGFzdENoZWNrcG9pbnQrMSl7XG4gICAgICAgICAgICBsYXN0Q2hlY2twb2ludCA9IGN1cnJlbnRDaGVja3BvaW50O1xuICAgICAgICB9XG4gICAgICAgIGlmKGN1cnJlbnRDaGVja3BvaW50ID09IDAgJiYgbGFzdENoZWNrcG9pbnQgPT0gNCl7XG4gICAgICAgICAgICBsYXN0Q2hlY2twb2ludCA9IGN1cnJlbnRDaGVja3BvaW50O1xuICAgICAgICAgICAgbGFwID0gbGFwICsgMTtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdwbGF5ZXItbGFwJyxsYXApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEgsIFdJTkRPV19IRUlHSFQpO1xuICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgcmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIHJlbmRlcmVyLmF1dG9DbGVhciA9IGZhbHNlO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICc1JSc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSAnNzAlJztcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJzInO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ3doaXRlIHNvbGlkJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnkgPSBUT1BfQ0FNRVJBX0RJU1Q7XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucm90YXRpb24ueCA9IC05MCAqIE1hdGguUEkgLyAxODA7XG5cbiAgICAgICAgYnVpbGRGbG9vcigpO1xuICAgICAgICAvLyBhZGRCb3hlcygpO1xuICAgICAgICBhZGRDaGVja3BvaW50cygpO1xuXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcbiAgICAgICAgaW5pdFNvY2tldEV2ZW50KCk7XG4gICAgICAgIGxvb3AoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb29wKCkge1xuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG5cbiAgICAgICAgcmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBQbGF5ZXIuZ2V0Q2FtZXJhKCkpO1xuXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5jbGVhcigpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRIIC8gNCwgV0lORE9XX0hFSUdIVCAvIDQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIucmVuZGVyKHNjZW5lLCBtaW5pTWFwQ2FtZXJhKTtcblxuICAgICAgICAvLyBmb3IgKGxldCBpZCBpbiBwbGF5ZXJzKSB7XG4gICAgICAgIC8vICAgICBjb25zdCBwID0gcGxheWVyc1tpZF07XG4gICAgICAgIC8vICAgICBjb25zdCBwb3MgPSBwLnBvc2l0aW9uO1xuICAgICAgICAvLyAgICAgY29uc3Qgcm90ID0gcC5yb3RhdGlvbjtcbiAgICAgICAgLy8gICAgIHAuY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgLy8gICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcbiAgICAgICAgLy8gfVxuXG4gICAgICAgIFBsYXllci5kb01vdmVtZW50TG9vcCgpO1xuICAgICAgICBpZiAoUGh5c2ljcy5kZXRlY3RDb2xsaXNpb24oUGxheWVyLnBsYXllck9iamVjdCwgb2JqZWN0cykpIHtcbiAgICAgICAgICAgIFBsYXllci5jcmFzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRDaGVja3BvaW50ID0gUGh5c2ljcy5jaGVja1BvaW50cyhQbGF5ZXIucGxheWVyT2JqZWN0LGNoZWNrcG9pbnRzKTtcbiAgICAgICAgaWYoY3VycmVudENoZWNrcG9pbnQgIT0gLTEpe1xuICAgICAgICAgICAgaWYoY2hlY2tMYXBDb3VudCAlIDEwID09IDApe1xuICAgICAgICAgICAgICAgIGNoZWNrTGFwKCk7XG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgY2hlY2tMYXBDb3VudCArPSAxO1xuICAgICAgICAgICAgY2hlY2tMYXBDb3VudCA9IGNoZWNrTGFwQ291bnQgJSAxMDtcbiAgICAgICAgfVxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnogPSBQbGF5ZXIucGxheWVyT2JqZWN0LnBvc2l0aW9uLno7XG5cbiAgICAgICAgUGh5c2ljcy5ncmF2aXR5KFBsYXllci5wbGF5ZXJPYmplY3QsIGZsb29yKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0pKCk7XG4iXX0=
