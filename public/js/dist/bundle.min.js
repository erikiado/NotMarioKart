"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,BOX_SIZE=10,NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,r=t();d[e.id]={position:o,rotation:n,car:r},r.position.set(o.x,o.y,o.z),r.rotation.set(n.x,n.y,n.z),i.add(r)})}),e.on("player-joined",function(e){toastr.success("player "+e.id+" has joined."),console.log("[player-joined]",e);var o=e.position,n=e.rotation,r=t();d[e.id]={position:o,rotation:n,car:r},r.position.set(o.x,o.y,o.z),r.rotation.set(n.x,n.y,n.z),i.add(r)}),e.on("player-left",function(e){toastr.error("Player "+e+" has left."),console.log("[player-left]",e);var t=d[e].car;i.remove(t),delete d[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,r=d[t];r.car.position.set(o.x,o.y,o.z),r.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){toastr.info(e+" seconds before the race starts."),console.log("[start-countdown]",e)}),e.on("start",function(){toastr.info("The race has started."),console.log("[start]")}),e.on("finished",function(e){toastr.info("You finished."),console.log("[finished]",e)}),e.on("stop",function(e){toaster.info("The race is over."),console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var t=Player.playerObject;e.emit("update-player",{position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:t.rotation._x,y:t.rotation._y,z:t.rotation._z}})},12.5)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),r=[],s=0;s<NUMBER_COLORS;s++)r.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[s],side:THREE.DoubleSide}));for(var l=n.faces.length/2,c=0;c<l;c++){var E=2*c;n.faces[E].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[E+1].materialIndex=(c+Math.floor(c/WORLD_SIDE_SIZE))%NUMBER_COLORS}(a=new THREE.Mesh(n,r)).rotateX(-Math.PI/2),a.position.y=0,i.add(a)}function n(){for(var e=0;e<1e3;e++){var t=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));i.updateMatrixWorld(),Physics.gravity(t.mesh,a),t.mesh.position.y==BOX_SIZE/2&&(E.push(t),i.add(t.mesh))}}function r(){requestAnimationFrame(r),s.clear(),s.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),s.render(i,Player.getCamera()),l.clear(),l.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),l.render(i,c),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,E)&&Player.crash(),c.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,a)}var a,i=new THREE.Scene,s=new THREE.WebGLRenderer,l=new THREE.WebGLRenderer,c=new THREE.OrthographicCamera(-WINDOW_WIDTH,WINDOW_WIDTH,WINDOW_HEIGHT,-WINDOW_HEIGHT,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),E=[],d={};return{init:function(){s.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),s.setPixelRatio(window.devicePixelRatio),s.domElement.style.position="fixed",document.body.appendChild(s.domElement),s.autoClear=!1,l.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),l.setPixelRatio(window.devicePixelRatio),l.domElement.style.position="fixed",l.domElement.style.top="5%",l.domElement.style.left="70%",l.domElement.style.zIndex="2",l.domElement.style.outline="white solid",document.body.appendChild(l.domElement),l.autoClear=!1,c.position.y=TOP_CAMERA_DIST,c.rotation.x=-90*Math.PI/180,o(),n(),i.add(Player.playerObject),e(),r()}}}(),Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,r=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return t.position.y=2*e.scale.y,t.position.z=4*e.scale.z,t.rotateY(180*Math.PI/180),o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),a={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},i=a.movement.arrows,s=0,l=5,c=.05,E=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[i.up]&&s<l&&(s+=c),d[i.left]&&r.rotateY(E),d[i.right]&&r.rotateY(-E),d[i.down]&&s>0&&(s-=c,s=Math.max(0,s)),r.translateZ(s),d[a.switchCamera]&&(n=n===t?o:t,d[a.switchCamera]=!1),d[a.reset]&&(r.rotation.x=0,r.position.set(0,r.position.x,0),r.rotation.y=0,r.position.set(0,r.position.y,0),r.rotation.z=0,r.position.set(0,r.position.z,0))},playerObject:r,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIk5vdE1hcmlvS2FydC5qcyIsIlBsYXllci5qcyJdLCJuYW1lcyI6WyJXT1JMRF9TSURFX1NJWkUiLCJXSU5ET1dfSEVJR0hUIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJXSU5ET1dfV0lEVEgiLCJpbm5lcldpZHRoIiwiUk9BRF9DT0xPUlMiLCJOVU1CRVJfQ09MT1JTIiwibGVuZ3RoIiwiV09STERfSEVJR0hUIiwiV09STERfV0lEVEgiLCJUT1BfQ0FNRVJBX0RJU1QiLCJDQVJfU0laRV9YIiwiQ0FSX1NJWkVfWSIsIkNBUl9TSVpFX1oiLCJCT1hfU0laRSIsIk5vdE1hcmlvS2FydCIsImluaXRTb2NrZXRFdmVudCIsInNvY2tldCIsImlvIiwidHJhbnNwb3J0cyIsInVwZ3JhZGUiLCJvbiIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsInBsYXllciIsInBvcyIsInBvc2l0aW9uIiwicm90Iiwicm90YXRpb24iLCJjYXIiLCJtYWtlQ2FyT2JqZWN0IiwicGxheWVycyIsImlkIiwic2V0IiwieCIsInkiLCJ6Iiwic2NlbmUiLCJhZGQiLCJ0b2FzdHIiLCJzdWNjZXNzIiwicGxheWVySWQiLCJlcnJvciIsInJlbW92ZSIsInAiLCJzZWNvbmRzIiwiaW5mbyIsInRpbWUiLCJ0b2FzdGVyIiwic3RvcCIsIm5hbWUiLCJzZXRJbnRlcnZhbCIsIlBsYXllciIsInBsYXllck9iamVjdCIsImVtaXQiLCJfeCIsIl95IiwiX3oiLCJUSFJFRSIsIk9iamVjdExvYWRlciIsInBhcnNlIiwicGxheWVyQ2FyIiwiYnVpbGRGbG9vciIsImN1cnZlIiwiQ2F0bXVsbFJvbUN1cnZlMyIsIlZlY3RvcjMiLCJjbG9zZWQiLCJleHRydWRlU2V0dGluZ3MiLCJzdGVwcyIsImV4dHJ1ZGVQYXRoIiwic2hhcGUiLCJTaGFwZSIsIlZlY3RvcjIiLCJnZW9tZXRyeSIsIkV4dHJ1ZGVHZW9tZXRyeSIsIm1hdGVyaWFscyIsImkiLCJwdXNoIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsInNpZGUiLCJEb3VibGVTaWRlIiwiZ2VvRmFjZXNMZW5ndGgiLCJmYWNlcyIsImoiLCJtYXRlcmlhbEluZGV4IiwiTWF0aCIsImZsb29yIiwiTWVzaCIsInJvdGF0ZVgiLCJQSSIsImFkZEJveGVzIiwiYm94IiwiQm94IiwicmFuZG9tIiwidXBkYXRlTWF0cml4V29ybGQiLCJQaHlzaWNzIiwiZ3Jhdml0eSIsIm1lc2giLCJvYmplY3RzIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsImdldENhbWVyYSIsIm1pbmlNYXBSZW5kZXJlciIsIm1pbmlNYXBDYW1lcmEiLCJkb01vdmVtZW50TG9vcCIsImRldGVjdENvbGxpc2lvbiIsImNyYXNoIiwiU2NlbmUiLCJXZWJHTFJlbmRlcmVyIiwiT3J0aG9ncmFwaGljQ2FtZXJhIiwiaW5pdCIsInNldFNpemUiLCJzZXRQaXhlbFJhdGlvIiwiZGV2aWNlUGl4ZWxSYXRpbyIsImRvbUVsZW1lbnQiLCJzdHlsZSIsImRvY3VtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwibGVmdCIsInpJbmRleCIsIm91dGxpbmUiLCJvbktleU1vdmUiLCJlIiwiZXZlbnQiLCJrZXlDb2RlTWFwIiwid2hpY2giLCJ0eXBlIiwicG92Q2FtZXJhIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJ0cmFja2luZ0NhbWVyYSIsImN1cnJlbnRDYW1lcmEiLCJvYmplY3QiLCJzY2FsZSIsInJvdGF0ZVkiLCJtYWtlUGxheWVyT2JqZWN0IiwiY29udHJvbHMiLCJtb3ZlbWVudCIsImFycm93cyIsInVwIiwiZG93biIsInJpZ2h0Iiwid2FzZCIsInN3aXRjaENhbWVyYSIsInJlc2V0IiwiZW5hYmxlZENvbnRyb2xzIiwic3BlZWQiLCJtYXhTcGVlZCIsImFjY2VsZXJhdGlvbiIsInJvdGF0aW9uU3BlZWQiLCJhZGRFdmVudExpc3Rl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Q1JELEdBQVNFLEdBR2J2QixFQUFXb0IsRUFBZ0IxQixPQUMzQnpFLEVBQWF3RixRQUFRZSxHQUVyQnhCLEVBQVdvQixFQUFnQkosUUFDM0IvRixFQUFhd0YsU0FBU2UsR0FFdEJ4QixFQUFXb0IsRUFBZ0JMLE9BQ3ZCTSxFQUFRLElBQ1JBLEdBQVNFLEVBQ1RGLEVBQVFuRSxLQUFLd0UsSUFBSSxFQUFHTCxJQUc1QnBHLEVBQWEwRyxXQUFXTixHQUNwQnJCLEVBQVdXLEVBQVNPLGdCQUVoQlosRUFEQUEsSUFBa0JILEVBQ0ZFLEVBRUFGLEVBRXBCSCxFQUFXVyxFQUFTTyxlQUFnQixHQUVwQ2xCLEVBQVdXLEVBQVNRLFNBQ3BCbEcsRUFBYXpCLFNBQVNNLEVBQUksRUFDMUJtQixFQUFhM0IsU0FBU08sSUFBSSxFQUFHb0IsRUFBYTNCLFNBQVNRLEVBQUcsR0FDdERtQixFQUFhekIsU0FBU08sRUFBSSxFQUMxQmtCLEVBQWEzQixTQUFTTyxJQUFJLEVBQUdvQixFQUFhM0IsU0FBU1MsRUFBRyxHQUN0RGtCLEVBQWF6QixTQUFTUSxFQUFJLEVBQzFCaUIsRUFBYTNCLFNBQVNPLElBQUksRUFBR29CLEVBQWEzQixTQUFTVSxFQUFHLEtBeUQxRGlCLGFBQWNBLEVBQ2RxRCxVQXRJWSxXQUNaLE9BQU9nQyxHQXNJUGpHLFNBbElXLEtBbUlYc0UsTUF4REosV0FFSTBDLEVBQVEsSUFsR0EiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cclxuICovXHJcblxyXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xyXG5jb25zdCBXSU5ET1dfSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5jb25zdCBXSU5ET1dfV0lEVEggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuY29uc3QgUk9BRF9DT0xPUlMgPSBbXHJcbiAgICAweGZmMDAwMCxcclxuICAgIDB4ZmY4ODAwLFxyXG4gICAgMHhmZmZmMDAsXHJcbiAgICAweDAwZmYwMCxcclxuICAgIDB4MDBmZmZmLFxyXG4gICAgMHgwMDAwZmYsXHJcbiAgICAweGZmMDBmZlxyXG5dO1xyXG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xyXG5jb25zdCBXT1JMRF9IRUlHSFQgPSAxMDAwO1xyXG5jb25zdCBXT1JMRF9XSURUSCA9IDEwMDtcclxuY29uc3QgVE9QX0NBTUVSQV9ESVNUID0gNTA7XHJcbmNvbnN0IENBUl9TSVpFX1ggPSAxMDtcclxuY29uc3QgQ0FSX1NJWkVfWSA9IDEwO1xyXG5jb25zdCBDQVJfU0laRV9aID0gMTA7XHJcbmNvbnN0IEJPWF9TSVpFID0gMTA7XHJcbiIsIi8qKlxyXG4gKiBNYWluIGZpbGUgb2YgdGhlIGdhbWUuXHJcbiAqL1xyXG5cclxuY29uc3QgTm90TWFyaW9LYXJ0ID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcclxuICAgIGNvbnN0IG1pbmlNYXBSZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICBjb25zdCBtaW5pTWFwQ2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYShcclxuICAgICAgICAtV0lORE9XX1dJRFRILFxyXG4gICAgICAgIFdJTkRPV19XSURUSCxcclxuICAgICAgICBXSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIC1XSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCAtIDUwLFxyXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCArIDUwXHJcbiAgICApO1xyXG4gICAgdmFyIGZsb29yO1xyXG4gICAgdmFyIG9iamVjdHMgPSBbXTtcclxuXHJcbiAgICBjb25zdCBwbGF5ZXJzID0ge307XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdFNvY2tldEV2ZW50KCkge1xyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpbyh7IHRyYW5zcG9ydHM6IFsnd2Vic29ja2V0J10sIHVwZ3JhZGU6IGZhbHNlIH0pO1xyXG5cclxuICAgICAgICAvLyBUT0RPOiBzaG93IG1vZGFsIHdpdGggbmFtZSBmb3JtLCB0aGVuIGVtaXQgbmFtZVxyXG5cclxuICAgICAgICBzb2NrZXQub24oJ2FsbC1wbGF5ZXJzJywgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW2FsbC1wbGF5ZXJzXScsIGRhdGEpO1xyXG4gICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcclxuICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxyXG4gICAgICAgICAgICAgICAgICAgIGNhcjogY2FyXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcclxuICAgICAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XHJcbiAgICAgICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWpvaW5lZCcsIGZ1bmN0aW9uKHBsYXllcikge1xyXG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhgcGxheWVyICR7cGxheWVyLmlkfSBoYXMgam9pbmVkLmApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3BsYXllci1qb2luZWRdJywgcGxheWVyKTtcclxuICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XHJcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IG1ha2VDYXJPYmplY3QoKTtcclxuICAgICAgICAgICAgcGxheWVyc1twbGF5ZXIuaWRdID0ge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcclxuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiByb3QsXHJcbiAgICAgICAgICAgICAgICBjYXI6IGNhclxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICBjYXIucm90YXRpb24uc2V0KHJvdC54LCByb3QueSwgcm90LnopO1xyXG4gICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItbGVmdCcsIGZ1bmN0aW9uKHBsYXllcklkKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihgUGxheWVyICR7cGxheWVySWR9IGhhcyBsZWZ0LmApO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3BsYXllci1sZWZ0XScsIHBsYXllcklkKTtcclxuICAgICAgICAgICAgY29uc3QgY2FyID0gcGxheWVyc1twbGF5ZXJJZF0uY2FyO1xyXG4gICAgICAgICAgICBzY2VuZS5yZW1vdmUoY2FyKTtcclxuICAgICAgICAgICAgZGVsZXRlIHBsYXllcnNbcGxheWVySWRdO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3VwZGF0ZS1wbGF5ZXInLCBmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1t1cGRhdGUtcGxheWVyXScsIHBsYXllcik7XHJcbiAgICAgICAgICAgIGNvbnN0IGlkID0gcGxheWVyLmlkO1xyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcclxuICAgICAgICAgICAgY29uc3QgcCA9IHBsYXllcnNbaWRdO1xyXG4gICAgICAgICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XHJcbiAgICAgICAgICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydC1jb3VudGRvd24nLCBmdW5jdGlvbihzZWNvbmRzKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKGAke3NlY29uZHN9IHNlY29uZHMgYmVmb3JlIHRoZSByYWNlIHN0YXJ0cy5gKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydC1jb3VudGRvd25dJywgc2Vjb25kcyk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IHNob3cgXCJ4IHNlY29uZHMgYmVmb3JlIHN0YXJ0XCJcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB0b2FzdHIuaW5mbygnVGhlIHJhY2UgaGFzIHN0YXJ0ZWQuJyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RhcnRdJyk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB0aGUgZ2FtZSBoYXMgc3RhcnRlZFxyXG4gICAgICAgICAgICAvLyBUT0RPOiBkaXNhYmxlIG1vdmluZyBpZiBub3Qgc3RhcnRlZFxyXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyBhIG5hbWUgZmlyc3QgKGRvbid0IGhpZGUgbW9kYWwpXHJcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIHRvIGJlIHJlYWR5XHJcbiAgICAgICAgICAgIC8vIFRPRE86IDIrIHBsYXllcnNcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdmaW5pc2hlZCcsIGZ1bmN0aW9uKHRpbWUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1lvdSBmaW5pc2hlZC4nKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tmaW5pc2hlZF0nLCB0aW1lKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogc2hvdyBtb2RhbCBcIndhaXRpbmcgZm9yIG90aGVycywgeW91ciB0aW1lIGlzIHhcIlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3N0b3AnLCBmdW5jdGlvbihwbGF5ZXJzKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ZXIuaW5mbygnVGhlIHJhY2UgaXMgb3Zlci4nKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdG9wXScsIHN0b3ApO1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBhbGwgcGxheWVycyBhcmUgZmluaXNoZWQsIHNob3cgcmFua2luZyBhbmQgcGxheSBhZ2FpbiBidXR0b25cclxuICAgICAgICAgICAgcGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uKHBsYXllcikge1xyXG4gICAgICAgICAgICAgICAgLy8gc29ydGVkIGJ5IHJhbmtpbmcgOi0pXHJcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gcGxheWVyLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gdGltZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgY29uc3QgcCA9IFBsYXllci5wbGF5ZXJPYmplY3Q7XHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCd1cGRhdGUtcGxheWVyJywge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBwLnBvc2l0aW9uLngsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogcC5wb3NpdGlvbi55LFxyXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucG9zaXRpb24uelxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogcC5yb3RhdGlvbi5feCxcclxuICAgICAgICAgICAgICAgICAgICB5OiBwLnJvdGF0aW9uLl95LFxyXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucm90YXRpb24uX3pcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgMTAwMCAvIDgwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtYWtlQ2FyT2JqZWN0KCkge1xyXG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcclxuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcclxuICAgICAgICByZXR1cm4gb2JqZWN0O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGJ1aWxkRmxvb3IoKSB7XHJcbiAgICAgICAgbGV0IGN1cnZlID0gbmV3IFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMoW1xyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgNTAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgNTAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTIwMCwgODAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoNjAwLCA4MDAsIDApLFxyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg2MDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgNTAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMzAwLCAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoODAwLCAtNTAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgLTUwMCwgMClcclxuICAgICAgICBdKTtcclxuICAgICAgICBjdXJ2ZS5jbG9zZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICBsZXQgZXh0cnVkZVNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICBzdGVwczogMTAwLFxyXG4gICAgICAgICAgICBleHRydWRlUGF0aDogY3VydmVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTaGFwZSB0aGF0IGdldHMgZXh0cnVkZWQgdGhyb3VnaCB0aGUgY3VydmVcclxuICAgICAgICBsZXQgc2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoW1xyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigyICogQ0FSX1NJWkVfWSwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIDUgKiBDQVJfU0laRV9YKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMCwgLTUgKiBDQVJfU0laRV9YKVxyXG4gICAgICAgIF0pO1xyXG5cclxuICAgICAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuRXh0cnVkZUdlb21ldHJ5KHNoYXBlLCBleHRydWRlU2V0dGluZ3MpO1xyXG5cclxuICAgICAgICBsZXQgbWF0ZXJpYWxzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1CRVJfQ09MT1JTOyBpKyspIHtcclxuICAgICAgICAgICAgbWF0ZXJpYWxzLnB1c2goXHJcbiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBST0FEX0NPTE9SU1tpXSxcclxuICAgICAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vd2lyZWZyYW1lOiB0cnVlIC8vIFRoaXMgbWFrZXMgdHJhY2sgbW9yZSBUcm9uLWxpa2VcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdlb0ZhY2VzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXHJcblxyXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqXS5tYXRlcmlhbEluZGV4ID1cclxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xyXG5cclxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbaiArIDFdLm1hdGVyaWFsSW5kZXggPVxyXG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmxvb3IgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWxzKTtcclxuICAgICAgICBmbG9vci5yb3RhdGVYKC1NYXRoLlBJIC8gMik7XHJcbiAgICAgICAgZmxvb3IucG9zaXRpb24ueSA9IDA7XHJcblxyXG4gICAgICAgIHNjZW5lLmFkZChmbG9vcik7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkQm94ZXMoKSB7XHJcbiAgICAgICAgbGV0IG1pbiA9IC0yMDAwO1xyXG4gICAgICAgIGxldCBtYXggPSAgMjAwMDtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgcmFuZG9tIGJveC5cclxuICAgICAgICAgICAgbGV0IGJveCA9IG5ldyBCb3goTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKChtYXgtbWluKSsxKSArIG1pbiksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgobWF4LW1pbikrMSkgKyBtaW4pKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFkZCBvbmx5IGlmIGl0J3Mgb3ZlciB0aGUgZmxvb3IuXHJcbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XHJcbiAgICAgICAgICAgIFBoeXNpY3MuZ3Jhdml0eShib3gubWVzaCwgZmxvb3IpO1xyXG4gICAgICAgICAgICBpZiAoYm94Lm1lc2gucG9zaXRpb24ueSA9PSBCT1hfU0laRS8yKSB7XHJcbiAgICAgICAgICAgICAgICBvYmplY3RzLnB1c2goYm94KTtcclxuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChib3gubWVzaCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgICByZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XHJcbiAgICAgICAgcmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTtcclxuICAgICAgICByZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFNpemUoV0lORE9XX1dJRFRIIC8gNCwgV0lORE9XX0hFSUdIVCAvIDQpO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUudG9wID0gJzUlJztcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzcwJSc7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUuekluZGV4ID0gJzInO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLm91dGxpbmUgPSAnd2hpdGUgc29saWQnO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQpO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi55ID0gVE9QX0NBTUVSQV9ESVNUO1xyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucm90YXRpb24ueCA9IC05MCAqIE1hdGguUEkgLyAxODA7XHJcblxyXG4gICAgICAgIGJ1aWxkRmxvb3IoKTtcclxuICAgICAgICBhZGRCb3hlcygpO1xyXG5cclxuICAgICAgICBzY2VuZS5hZGQoUGxheWVyLnBsYXllck9iamVjdCk7XHJcbiAgICAgICAgaW5pdFNvY2tldEV2ZW50KCk7XHJcbiAgICAgICAgbG9vcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGxvb3AoKSB7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xyXG5cclxuICAgICAgICByZW5kZXJlci5jbGVhcigpO1xyXG4gICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XHJcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBQbGF5ZXIuZ2V0Q2FtZXJhKCkpO1xyXG5cclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuY2xlYXIoKTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRIIC8gNCwgV0lORE9XX0hFSUdIVCAvIDQpO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5yZW5kZXIoc2NlbmUsIG1pbmlNYXBDYW1lcmEpO1xyXG5cclxuICAgICAgICAvLyBmb3IgKGxldCBpZCBpbiBwbGF5ZXJzKSB7XHJcbiAgICAgICAgLy8gICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcclxuICAgICAgICAvLyAgICAgY29uc3QgcG9zID0gcC5wb3NpdGlvbjtcclxuICAgICAgICAvLyAgICAgY29uc3Qgcm90ID0gcC5yb3RhdGlvbjtcclxuICAgICAgICAvLyAgICAgcC5jYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgIC8vICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XHJcbiAgICAgICAgLy8gfVxyXG5cclxuICAgICAgICBQbGF5ZXIuZG9Nb3ZlbWVudExvb3AoKTtcclxuICAgICAgICBpZiAoUGh5c2ljcy5kZXRlY3RDb2xsaXNpb24oUGxheWVyLnBsYXllck9iamVjdCwgb2JqZWN0cykpIHtcclxuICAgICAgICAgICAgUGxheWVyLmNyYXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcclxuXHJcbiAgICAgICAgUGh5c2ljcy5ncmF2aXR5KFBsYXllci5wbGF5ZXJPYmplY3QsIGZsb29yKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXQ6IGluaXRcclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxyXG4gKi9cclxuXHJcbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IHBvdkNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcclxuICAgICAgICA3NSxcclxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIDAuMSxcclxuICAgICAgICAxMDAwXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHRyYWNraW5nQ2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxyXG4gICAgICAgIDc1LFxyXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXHJcbiAgICAgICAgMC4xLFxyXG4gICAgICAgIDEwMDBcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgIGxldCBnZXRDYW1lcmEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gY3VycmVudENhbWVyYTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcGxheWVyT2JqZWN0ID0gbWFrZVBsYXllck9iamVjdCgpO1xyXG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcclxuXHJcbiAgICBjb25zdCBjb250cm9scyA9IHtcclxuICAgICAgICBtb3ZlbWVudDoge1xyXG4gICAgICAgICAgICBhcnJvd3M6IHtcclxuICAgICAgICAgICAgICAgIHVwOiAzOCxcclxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogMzcsXHJcbiAgICAgICAgICAgICAgICByaWdodDogMzlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgd2FzZDoge1xyXG4gICAgICAgICAgICAgICAgdXA6IDg3LFxyXG4gICAgICAgICAgICAgICAgZG93bjogODMsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiA2NSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0OiA2OFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzd2l0Y2hDYW1lcmE6IDY3LFxyXG4gICAgICAgIHJlc2V0OiA4XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XHJcblxyXG4gICAgbGV0IHNwZWVkID0gMDtcclxuICAgIGxldCBtYXhTcGVlZCA9IDU7XHJcbiAgICBjb25zdCBhY2NlbGVyYXRpb24gPSAwLjA1O1xyXG4gICAgY29uc3Qgcm90YXRpb25TcGVlZCA9IDAuMDU7XHJcblxyXG4gICAgY29uc3Qga2V5Q29kZU1hcCA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XHJcbiAgICAgICAgZSA9IGUgfHwgZXZlbnQ7IC8vIEZvciBJRS5cclxuICAgICAgICBrZXlDb2RlTWFwW2Uud2hpY2hdID0gZS50eXBlID09PSAna2V5ZG93bic7XHJcbiAgICB9XHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5TW92ZSwgZmFsc2UpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBkb01vdmVtZW50TG9vcCgpIHtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA8IG1heFNwZWVkKSB7XHJcbiAgICAgICAgICAgICAgICBzcGVlZCArPSBhY2NlbGVyYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmxlZnRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMucmlnaHRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmRvd25dKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNwZWVkIC09IGFjY2VsZXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIHNwZWVkID0gTWF0aC5tYXgoMCwgc3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FtZXJhID09PSBwb3ZDYW1lcmEpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSBwb3ZDYW1lcmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnJlc2V0XSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueCA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLngsIDApO1xyXG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueSA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xyXG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueiA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnosIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjcmFzaCgpIHtcclxuICAgICAgICAvLyBhY2NlbGVyYXRpb24gPSAwO1xyXG4gICAgICAgIHNwZWVkID0gMDtcclxuICAgICAgICAvLyBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XHJcbiAgICAgICAgLy8gICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKC1zcGVlZCk7XHJcbiAgICAgICAgLy8gfSBlbHNlIHtcclxuICAgICAgICAvLyAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xyXG4gICAgICAgIC8vIH1cclxuXHJcbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgLy8gbGV0IHBvcyA9IGdyb3VwQmxvY2tzW2ldLnBvc2l0aW9uO1xyXG4gICAgICAgIC8vICAgICBsZXQgcG8gPSBwbGF5ZXJPYmplY3QuY2hpbGRyZW5bMl0uY2hpbGRyZW5bMF1cclxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxyXG4gICAgICAgIC8vIHtcclxuICAgICAgICAvLyAgICAgdmFyIGxvY2FsVmVydGV4ID0gcG8uZ2VvbWV0cnkudmVydGljZXNbdmVydGV4SW5kZXhdLmNsb25lKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBkaXJlY3Rpb25WZWN0b3IgPSBnbG9iYWxWZXJ0ZXguc3ViU2VsZiggcG8ucG9zaXRpb24gKTtcclxuXHJcbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcclxuICAgICAgICAvLyAgICAgdmFyIGNvbGxpc2lvblJlc3VsdHMgPSByYXkuaW50ZXJzZWN0T2JqZWN0cyggZ3JvdXBCbG9ja3MgKTtcclxuICAgICAgICAvLyAgICAgaWYgKCBjb2xsaXNpb25SZXN1bHRzLmxlbmd0aCA+IDAgJiYgY29sbGlzaW9uUmVzdWx0c1swXS5kaXN0YW5jZSA8IGRpcmVjdGlvblZlY3Rvci5sZW5ndGgoKSApXHJcbiAgICAgICAgLy8gICAgIHtcclxuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdwZXJkaXN0cmUnKVxyXG4gICAgICAgIC8vICAgICAgICAgLy8gYSBjb2xsaXNpb24gb2NjdXJyZWQuLi4gZG8gc29tZXRoaW5nLi4uXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gaWYoKHBsYXllck9iamVjdC5wb3NpdGlvbi54KzUgPCBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1IDwgcG9zLnopfHwgKHBsYXllck9iamVjdC5wb3NpdGlvbi54LTUgPiBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1ID4gcG9zLnopKVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtYWtlUGxheWVyT2JqZWN0KCkge1xyXG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcclxuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcclxuXHJcbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnkgPSBvYmplY3Quc2NhbGUueSAqIDI7XHJcbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIDQ7XHJcbiAgICAgICAgLy8gdHJhY2tpbmdDYW1lcmEucm90YXRlWCgwICogTWF0aC5QSSAvIDE4MCk7XHJcbiAgICAgICAgcG92Q2FtZXJhLnJvdGF0ZVkoMTgwICogTWF0aC5QSSAvIDE4MCk7XHJcblxyXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnkgPSBvYmplY3Quc2NhbGUueSAqIDEwO1xyXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIC0yMDtcclxuICAgICAgICAvLyB0cmFja2luZ0NhbWVyYS5yb3RhdGVYKDAgKiBNYXRoLlBJIC8gMTgwKTtcclxuICAgICAgICB0cmFja2luZ0NhbWVyYS5yb3RhdGVZKDE4MCAqIE1hdGguUEkgLyAxODApO1xyXG5cclxuICAgICAgICBvYmplY3QuYWRkKHBvdkNhbWVyYSk7XHJcbiAgICAgICAgb2JqZWN0LmFkZCh0cmFja2luZ0NhbWVyYSk7XHJcblxyXG4gICAgICAgIHJldHVybiBvYmplY3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBkb01vdmVtZW50TG9vcDogZG9Nb3ZlbWVudExvb3AsXHJcbiAgICAgICAgcGxheWVyT2JqZWN0OiBwbGF5ZXJPYmplY3QsXHJcbiAgICAgICAgZ2V0Q2FtZXJhOiBnZXRDYW1lcmEsXHJcbiAgICAgICAgcGxheWVySWQ6IHBsYXllcklkLFxyXG4gICAgICAgIGNyYXNoOiBjcmFzaFxyXG4gICAgfTtcclxufSkoKTtcclxuIl19
