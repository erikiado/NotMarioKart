"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,NotMarioKart=function(){function e(){var e=io({transports:["websocket"],upgrade:!1});e.on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,a=t();s[e.id]={position:o,rotation:n,car:a},a.position.set(o.x,o.y,o.z),a.rotation.set(n.x,n.y,n.z),r.add(a)})}),e.on("player-joined",function(e){console.log("[player-joined]",e);var o=e.position,n=e.rotation,a=t();s[e.id]={position:o,rotation:n,car:a},a.position.set(o.x,o.y,o.z),a.rotation.set(n.x,n.y,n.z),r.add(a)}),e.on("player-left",function(e){console.log("[player-left]",e);var t=s[e].car;r.remove(t),delete s[e]}),e.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,r=s[t];r.car.position.set(o.x,o.y,o.z),r.car.rotation.set(n.x,n.y,n.z)}),e.on("start-countdown",function(e){console.log("[start-countdown]",e)}),e.on("start",function(){console.log("[start]")}),e.on("finished",function(e){console.log("[finished]",e)}),e.on("stop",function(e){console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var t=Player.playerObject;e.emit("update-player",{position:{x:t.position.x,y:t.position.y,z:t.position.z},rotation:{x:t.rotation._x,y:t.rotation._y,z:t.rotation._z}})},1e3/24)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),a=[],i=0;i<NUMBER_COLORS;i++)a.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[i],side:THREE.DoubleSide}));for(var E=n.faces.length/2,s=0;s<E;s++){var l=2*s;n.faces[l].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[l+1].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS}var c=new THREE.Mesh(n,a);c.rotateX(-Math.PI/2),c.position.y=0,r.add(c)}function n(){requestAnimationFrame(n),a.clear(),a.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),a.render(r,Player.getCamera()),i.clear(),i.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),i.render(r,E),Player.doMovementLoop(),E.position.z=Player.playerObject.position.z}var r=new THREE.Scene,a=new THREE.WebGLRenderer,i=new THREE.WebGLRenderer,E=new THREE.OrthographicCamera(-WINDOW_WIDTH,WINDOW_WIDTH,WINDOW_HEIGHT,-WINDOW_HEIGHT,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),s={};return{init:function(){a.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),a.setPixelRatio(window.devicePixelRatio),a.domElement.style.position="fixed",document.body.appendChild(a.domElement),a.autoClear=!1,i.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),i.setPixelRatio(window.devicePixelRatio),i.domElement.style.position="fixed",i.domElement.style.top="5%",i.domElement.style.left="70%",i.domElement.style.zIndex="2",i.domElement.style.outline="white solid",document.body.appendChild(i.domElement),i.autoClear=!1,E.position.y=TOP_CAMERA_DIST,E.rotation.x=-90*Math.PI/180,o(),r.add(Player.playerObject),e(),n()}}}(),Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,r=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),a={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},i=a.movement.arrows,E=0,s=5,l=.05,c=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[i.up]&&E<s&&(E+=l),d[i.left]&&r.rotateY(c),d[i.right]&&r.rotateY(-c),d[i.down]&&E>0&&(E-=l,E=Math.max(0,E)),r.translateZ(E),d[a.switchCamera]&&(n=n===t?o:t,d[a.switchCamera]=!1),d[a.reset]&&(r.rotation.y=0,r.position.set(0,r.position.y,0))},playerObject:r,getCamera:function(){return n},playerId:null}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIk5vdE1hcmlvS2FydC5qcyIsIlBsYXllci5qcyJdLCJuYW1lcyI6WyJXT1JMRF9TSURFX1NJWkUiLCJXSU5ET1dfSEVJR0hUIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJXSU5ET1dfV0lEVEgiLCJpbm5lcldpZHRoIiwiUk9BRF9DT0xPUlMiLCJOVU1CRVJfQ09MT1JTIiwibGVuZ3RoIiwiV09STERfSEVJR0hUIiwiV09STERfV0lEVEgiLCJUT1BfQ0FNRVJBX0RJU1QiLCJDQVJfU0laRV9YIiwiQ0FSX1NJWkVfWSIsIkNBUl9TSVpFX1oiLCJOb3RNYXJpb0thcnQiLCJpbml0U29ja2V0RXZlbnQiLCJzb2NrZXQiLCJpbyIsInRyYW5zcG9ydHMiLCJ1cGdyYWRlIiwib24iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImZvckVhY2giLCJwbGF5ZXIiLCJwb3MiLCJwb3NpdGlvbiIsInJvdCIsInJvdGF0aW9uIiwiY2FyIiwibWFrZUNhck9iamVjdCIsInBsYXllcnMiLCJpZCIsInNldCIsIngiLCJ5IiwieiIsInNjZW5lIiwiYWRkIiwicGxheWVySWQiLCJyZW1vdmUiLCJwIiwic2Vjb25kcyIsInRpbWUiLCJzdG9wIiwibmFtZSIsInNldEludGVydmFsIiwiUGxheWVyIiwicGxheWVyT2JqZWN0IiwiZW1pdCIsIl94IiwiX3kiLCJfeiIsIlRIUkVFIiwiT2JqZWN0TG9hZGVyIiwicGFyc2UiLCJwbGF5ZXJDYXIiLCJidWlsZEZsb29yIiwiY3VydmUiLCJDYXRtdWxsUm9tQ3VydmUzIiwiVmVjdG9yMyIsImNsb3NlZCIsImV4dHJ1ZGVTZXR0aW5ncyIsInN0ZXBzIiwiZXh0cnVkZVBhdGgiLCJzaGFwZSIsIlNoYXBlIiwiVmVjdG9yMiIsImdlb21ldHJ5IiwiRXh0cnVkZUdlb21ldHJ5IiwibWF0ZXJpYWxzIiwiaSIsInB1c2giLCJNZXNoQmFzaWNNYXRlcmlhbCIsImNvbG9yIiwic2lkZSIsIkRvdWJsZVNpZGUiLCJnZW9GYWNlc0xlbmd0aCIsImZhY2VzIiwiaiIsIm1hdGVyaWFsSW5kZXgiLCJNYXRoIiwiZmxvb3IiLCJNZXNoIiwicm90YXRlWCIsIlBJIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsImdldENhbWVyYSIsIm1pbmlNYXBSZW5kZXJlciIsIm1pbmlNYXBDYW1lcmEiLCJkb01vdmVtZW50TG9vcCIsIlNjZW5lIiwiV2ViR0xSZW5kZXJlciIsIk9ydGhvZ3JhcGhpY0NhbWVyYSIsImluaXQiLCJzZXRTaXplIiwic2V0UGl4ZWxSYXRpbyIsImRldmljZVBpeGVsUmF0aW8iLCJkb21FbGVtZW50Iiwic3R5bGUiLCJkb2N1bWVudCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImF1dG9DbGVhciIsInRvcCIsImxlZnQiLCJ6SW5kZXgiLCJvdXRsaW5lIiwib25LZXlNb3ZlIiwiZSIsImV2ZW50Iiwia2V5Q29kZU1hcCIsIndoaWNoIiwidHlwZSIsInBvdkNhbWVyYSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwidHJhY2tpbmdDYW1lcmEiLCJjdXJyZW50Q2FtZXJhIiwib2JqZWN0Iiwic2NhbGUiLCJyb3RhdGVZIiwibWFrZVBsYXllck9iamVjdCIsImNvbnRyb2xzIiwibW92ZW1lbnQiLCJhcnJvd3MiLCJ1cCIsImRvd24iLCJyaWdodCIsIndhc2QiLCJzd2l0Y2hDYW1lcmEiLCJyZXNldCIsImVuYWJsZWRDb250cm9scyIsInNwZWVkIiwibWF4U3BlZWQiLCJhY2NlbGVyYXRpb24iLCJyb3RhdGlvblNwZWVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm1heCIsInRyYW5zbGF0ZVoiXSwibWFwcGluZ3MiOiJhQUlBLElBQU1BLGdCQUFrQixFQUNsQkMsY0FBZ0JDLE9BQU9DLFlBQ3ZCQyxhQUFlRixPQUFPRyxXQUN0QkMsYUFDRixTQUNBLFNBQ0EsU0FDQSxNQUNBLE1BQ0EsSUFDQSxVQUVFQyxjQUFnQkQsWUFBWUUsT0FDNUJDLGFBQWUsSUFD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V0FDUXFCLEVBQVdvQixFQUFnQk4sS0FDdkJPLEVBQVFDLElBQ1JELEdBQVNFLEdBR2J2QixFQUFXb0IsRUFBZ0IxQixPQUMzQjlELEVBQWE2RSxRQUFRZSxHQUVyQnhCLEVBQVdvQixFQUFnQkosUUFDM0JwRixFQUFhNkUsU0FBU2UsR0FFdEJ4QixFQUFXb0IsRUFBZ0JMLE9BQ3ZCTSxFQUFRLElBQ1JBLEdBQVNFLEVBQ1RGLEVBQVF4RCxLQUFLNkQsSUFBSSxFQUFHTCxJQUc1QnpGLEVBQWErRixXQUFXTixHQUNwQnJCLEVBQVdXLEVBQVNPLGdCQUVoQlosRUFEQUEsSUFBa0JILEVBQ0ZFLEVBRUFGLEVBRXBCSCxFQUFXVyxFQUFTTyxlQUFnQixHQUVwQ2xCLEVBQVdXLEVBQVNRLFNBQ3BCdkYsRUFBYXBCLFNBQVNPLEVBQUksRUFDMUJhLEVBQWF0QixTQUFTTyxJQUFJLEVBQUdlLEVBQWF0QixTQUFTUyxFQUFHLEtBMEMxRGEsYUFBY0EsRUFDZDRDLFVBbkhZLFdBQ1osT0FBTzhCLEdBbUhQbkYsU0EvR1csTUFyQkgiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cclxuICovXHJcblxyXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xyXG5jb25zdCBXSU5ET1dfSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5jb25zdCBXSU5ET1dfV0lEVEggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuY29uc3QgUk9BRF9DT0xPUlMgPSBbXHJcbiAgICAweGZmMDAwMCxcclxuICAgIDB4ZmY4ODAwLFxyXG4gICAgMHhmZmZmMDAsXHJcbiAgICAweDAwZmYwMCxcclxuICAgIDB4MDBmZmZmLFxyXG4gICAgMHgwMDAwZmYsXHJcbiAgICAweGZmMDBmZlxyXG5dO1xyXG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xyXG5jb25zdCBXT1JMRF9IRUlHSFQgPSAxMDAwO1xyXG5jb25zdCBXT1JMRF9XSURUSCA9IDEwMDtcclxuY29uc3QgVE9QX0NBTUVSQV9ESVNUID0gNTA7XHJcbmNvbnN0IENBUl9TSVpFX1ggPSAxMDtcclxuY29uc3QgQ0FSX1NJWkVfWSA9IDEwO1xyXG5jb25zdCBDQVJfU0laRV9aID0gMTA7XHJcbiIsIi8qKlxyXG4gKiBNYWluIGZpbGUgb2YgdGhlIGdhbWUuXHJcbiAqL1xyXG5cclxuY29uc3QgTm90TWFyaW9LYXJ0ID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcclxuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcclxuICAgIGNvbnN0IG1pbmlNYXBSZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICBjb25zdCBtaW5pTWFwQ2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYShcclxuICAgICAgICAtV0lORE9XX1dJRFRILFxyXG4gICAgICAgIFdJTkRPV19XSURUSCxcclxuICAgICAgICBXSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIC1XSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCAtIDUwLFxyXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCArIDUwXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHBsYXllcnMgPSB7fTtcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0U29ja2V0RXZlbnQoKSB7XHJcbiAgICAgICAgdmFyIHNvY2tldCA9IGlvKHsgdHJhbnNwb3J0czogWyd3ZWJzb2NrZXQnXSwgdXBncmFkZTogZmFsc2UgfSk7XHJcblxyXG4gICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgd2l0aCBuYW1lIGZvcm0sIHRoZW4gZW1pdCBuYW1lXHJcblxyXG4gICAgICAgIHNvY2tldC5vbignYWxsLXBsYXllcnMnLCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWxsLXBsYXllcnNdJywgZGF0YSk7XHJcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBsYXllci5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNhciA9IG1ha2VDYXJPYmplY3QoKTtcclxuICAgICAgICAgICAgICAgIHBsYXllcnNbcGxheWVyLmlkXSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiByb3QsXHJcbiAgICAgICAgICAgICAgICAgICAgY2FyOiBjYXJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBjYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICAgICAgY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcclxuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChjYXIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItam9pbmVkJywgZnVuY3Rpb24ocGxheWVyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbcGxheWVyLWpvaW5lZF0nLCBwbGF5ZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcclxuICAgICAgICAgICAgY29uc3QgY2FyID0gbWFrZUNhck9iamVjdCgpO1xyXG4gICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zLFxyXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHJvdCxcclxuICAgICAgICAgICAgICAgIGNhcjogY2FyXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XHJcbiAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XHJcbiAgICAgICAgICAgIHNjZW5lLmFkZChjYXIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3BsYXllci1sZWZ0JywgZnVuY3Rpb24ocGxheWVySWQpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItbGVmdF0nLCBwbGF5ZXJJZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IHBsYXllcnNbcGxheWVySWRdLmNhcjtcclxuICAgICAgICAgICAgc2NlbmUucmVtb3ZlKGNhcik7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBwbGF5ZXJzW3BsYXllcklkXTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCd1cGRhdGUtcGxheWVyJywgZnVuY3Rpb24ocGxheWVyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbdXBkYXRlLXBsYXllcl0nLCBwbGF5ZXIpO1xyXG4gICAgICAgICAgICBjb25zdCBpZCA9IHBsYXllci5pZDtcclxuICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBwbGF5ZXJzW2lkXTtcclxuICAgICAgICAgICAgcC5jYXIucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopO1xyXG4gICAgICAgICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQtY291bnRkb3duJywgZnVuY3Rpb24oc2Vjb25kcykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3N0YXJ0LWNvdW50ZG93bl0nLCBzZWNvbmRzKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogc2hvdyBcInggc2Vjb25kcyBiZWZvcmUgc3RhcnRcIlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3N0YXJ0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RhcnRdJyk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IG5vdGlmeSB0aGUgZ2FtZSBoYXMgc3RhcnRlZFxyXG4gICAgICAgICAgICAvLyBUT0RPOiBkaXNhYmxlIG1vdmluZyBpZiBub3Qgc3RhcnRlZFxyXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyBhIG5hbWUgZmlyc3QgKGRvbid0IGhpZGUgbW9kYWwpXHJcbiAgICAgICAgICAgIC8vIFRPRE86IGV2ZXJ5b25lIG5lZWRzIHRvIGJlIHJlYWR5XHJcbiAgICAgICAgICAgIC8vIFRPRE86IDIrIHBsYXllcnNcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgc29ja2V0Lm9uKCdmaW5pc2hlZCcsIGZ1bmN0aW9uKHRpbWUpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tmaW5pc2hlZF0nLCB0aW1lKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogc2hvdyBtb2RhbCBcIndhaXRpbmcgZm9yIG90aGVycywgeW91ciB0aW1lIGlzIHhcIlxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBzb2NrZXQub24oJ3N0b3AnLCBmdW5jdGlvbihwbGF5ZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RvcF0nLCBzdG9wKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogYWxsIHBsYXllcnMgYXJlIGZpbmlzaGVkLCBzaG93IHJhbmtpbmcgYW5kIHBsYXkgYWdhaW4gYnV0dG9uXHJcbiAgICAgICAgICAgIHBsYXllcnMuZm9yRWFjaChmdW5jdGlvbihwbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNvcnRlZCBieSByYW5raW5nIDotKVxyXG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHBsYXllci5uYW1lO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IHRpbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHAgPSBQbGF5ZXIucGxheWVyT2JqZWN0O1xyXG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgndXBkYXRlLXBsYXllcicsIHtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgeDogcC5wb3NpdGlvbi54LFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IHAucG9zaXRpb24ueSxcclxuICAgICAgICAgICAgICAgICAgICB6OiBwLnBvc2l0aW9uLnpcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICByb3RhdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHg6IHAucm90YXRpb24uX3gsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogcC5yb3RhdGlvbi5feSxcclxuICAgICAgICAgICAgICAgICAgICB6OiBwLnJvdGF0aW9uLl96XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIDEwMDAgLyAyNCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbWFrZUNhck9iamVjdCgpIHtcclxuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuT2JqZWN0TG9hZGVyKCk7XHJcbiAgICAgICAgY29uc3Qgb2JqZWN0ID0gbG9hZGVyLnBhcnNlKHBsYXllckNhcik7XHJcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBidWlsZEZsb29yKCkge1xyXG4gICAgICAgIGxldCBjdXJ2ZSA9IG5ldyBUSFJFRS5DYXRtdWxsUm9tQ3VydmUzKFtcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDgwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDYwMCwgODAwLCAwKSxcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoNjAwLCA1MDAsIDApLFxyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygzMDAsIDUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgLTUwMCwgMCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIC01MDAsIDApXHJcbiAgICAgICAgXSk7XHJcbiAgICAgICAgY3VydmUuY2xvc2VkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgbGV0IGV4dHJ1ZGVTZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgc3RlcHM6IDEwMCxcclxuICAgICAgICAgICAgZXh0cnVkZVBhdGg6IGN1cnZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gU2hhcGUgdGhhdCBnZXRzIGV4dHJ1ZGVkIHRocm91Z2ggdGhlIGN1cnZlXHJcbiAgICAgICAgbGV0IHNoYXBlID0gbmV3IFRIUkVFLlNoYXBlKFtcclxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoMiAqIENBUl9TSVpFX1ksIDApLFxyXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMigwLCA1ICogQ0FSX1NJWkVfWCksXHJcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIC01ICogQ0FSX1NJWkVfWClcclxuICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkV4dHJ1ZGVHZW9tZXRyeShzaGFwZSwgZXh0cnVkZVNldHRpbmdzKTtcclxuXHJcbiAgICAgICAgbGV0IG1hdGVyaWFscyA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNQkVSX0NPTE9SUzsgaSsrKSB7XHJcbiAgICAgICAgICAgIG1hdGVyaWFscy5wdXNoKFxyXG4gICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogUk9BRF9DT0xPUlNbaV0sXHJcbiAgICAgICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vd2lyZWZyYW1lOiB0cnVlIC8vIFRoaXMgbWFrZXMgdHJhY2sgbW9yZSBUcm9uLWxpa2VcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdlb0ZhY2VzTGVuZ3RoID0gZ2VvbWV0cnkuZmFjZXMubGVuZ3RoIC8gMjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdlb0ZhY2VzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXHJcblxyXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqXS5tYXRlcmlhbEluZGV4ID1cclxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xyXG5cclxuICAgICAgICAgICAgZ2VvbWV0cnkuZmFjZXNbaiArIDFdLm1hdGVyaWFsSW5kZXggPVxyXG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGZsb29yID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFscyk7XHJcbiAgICAgICAgZmxvb3Iucm90YXRlWCgtTWF0aC5QSSAvIDIpO1xyXG4gICAgICAgIGZsb29yLnBvc2l0aW9uLnkgPSAwO1xyXG5cclxuICAgICAgICBzY2VuZS5hZGQoZmxvb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEgsIFdJTkRPV19IRUlHSFQpO1xyXG4gICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xyXG4gICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XHJcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICc1JSc7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUubGVmdCA9ICc3MCUnO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnpJbmRleCA9ICcyJztcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ3doaXRlIHNvbGlkJztcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50KTtcclxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueSA9IFRPUF9DQU1FUkFfRElTVDtcclxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnJvdGF0aW9uLnggPSAtOTAgKiBNYXRoLlBJIC8gMTgwO1xyXG5cclxuICAgICAgICBidWlsZEZsb29yKCk7XHJcblxyXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcclxuICAgICAgICBpbml0U29ja2V0RXZlbnQoKTtcclxuICAgICAgICBsb29wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbG9vcCgpIHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XHJcblxyXG4gICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XHJcbiAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoMCwgMCwgV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcclxuICAgICAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIFBsYXllci5nZXRDYW1lcmEoKSk7XHJcblxyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5jbGVhcigpO1xyXG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRWaWV3cG9ydCgwLCAwLCBXSU5ET1dfV0lEVEggLyA0LCBXSU5ET1dfSEVJR0hUIC8gNCk7XHJcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnJlbmRlcihzY2VuZSwgbWluaU1hcENhbWVyYSk7XHJcblxyXG4gICAgICAgIC8vIGZvciAobGV0IGlkIGluIHBsYXllcnMpIHtcclxuICAgICAgICAvLyAgICAgY29uc3QgcCA9IHBsYXllcnNbaWRdO1xyXG4gICAgICAgIC8vICAgICBjb25zdCBwb3MgPSBwLnBvc2l0aW9uO1xyXG4gICAgICAgIC8vICAgICBjb25zdCByb3QgPSBwLnJvdGF0aW9uO1xyXG4gICAgICAgIC8vICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XHJcbiAgICAgICAgLy8gICAgIHAuY2FyLnJvdGF0aW9uLnNldChyb3QueCwgcm90LnksIHJvdC56KTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIFBsYXllci5kb01vdmVtZW50TG9vcCgpO1xyXG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGluaXQ6IGluaXRcclxuICAgIH07XHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxyXG4gKi9cclxuXHJcbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IHBvdkNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcclxuICAgICAgICA3NSxcclxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxyXG4gICAgICAgIDAuMSxcclxuICAgICAgICAxMDAwXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHRyYWNraW5nQ2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxyXG4gICAgICAgIDc1LFxyXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXHJcbiAgICAgICAgMC4xLFxyXG4gICAgICAgIDEwMDBcclxuICAgICk7XHJcblxyXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgIGxldCBnZXRDYW1lcmEgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gY3VycmVudENhbWVyYTtcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcGxheWVyT2JqZWN0ID0gbWFrZVBsYXllck9iamVjdCgpO1xyXG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcclxuXHJcbiAgICBjb25zdCBjb250cm9scyA9IHtcclxuICAgICAgICBtb3ZlbWVudDoge1xyXG4gICAgICAgICAgICBhcnJvd3M6IHtcclxuICAgICAgICAgICAgICAgIHVwOiAzOCxcclxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogMzcsXHJcbiAgICAgICAgICAgICAgICByaWdodDogMzlcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgd2FzZDoge1xyXG4gICAgICAgICAgICAgICAgdXA6IDg3LFxyXG4gICAgICAgICAgICAgICAgZG93bjogODMsXHJcbiAgICAgICAgICAgICAgICBsZWZ0OiA2NSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0OiA2OFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzd2l0Y2hDYW1lcmE6IDY3LFxyXG4gICAgICAgIHJlc2V0OiA4XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XHJcblxyXG4gICAgbGV0IHNwZWVkID0gMDtcclxuICAgIGxldCBtYXhTcGVlZCA9IDU7XHJcbiAgICBjb25zdCBhY2NlbGVyYXRpb24gPSAwLjA1O1xyXG4gICAgY29uc3Qgcm90YXRpb25TcGVlZCA9IDAuMDU7XHJcblxyXG4gICAgY29uc3Qga2V5Q29kZU1hcCA9IHt9O1xyXG5cclxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XHJcbiAgICAgICAgZSA9IGUgfHwgZXZlbnQ7IC8vIEZvciBJRS5cclxuICAgICAgICBrZXlDb2RlTWFwW2Uud2hpY2hdID0gZS50eXBlID09PSAna2V5ZG93bic7XHJcbiAgICB9XHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5TW92ZSwgZmFsc2UpO1xyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBkb01vdmVtZW50TG9vcCgpIHtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA8IG1heFNwZWVkKSB7XHJcbiAgICAgICAgICAgICAgICBzcGVlZCArPSBhY2NlbGVyYXRpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmxlZnRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMucmlnaHRdKSB7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmRvd25dKSB7XHJcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHNwZWVkIC09IGFjY2VsZXJhdGlvbjtcclxuICAgICAgICAgICAgICAgIHNwZWVkID0gTWF0aC5tYXgoMCwgc3BlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcclxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2FtZXJhID09PSBwb3ZDYW1lcmEpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSBwb3ZDYW1lcmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnJlc2V0XSkge1xyXG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueSA9IDA7XHJcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgLy8gbGV0IHBvcyA9IGdyb3VwQmxvY2tzW2ldLnBvc2l0aW9uO1xyXG4gICAgICAgIC8vICAgICBsZXQgcG8gPSBwbGF5ZXJPYmplY3QuY2hpbGRyZW5bMl0uY2hpbGRyZW5bMF1cclxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxyXG4gICAgICAgIC8vIHtcclxuICAgICAgICAvLyAgICAgdmFyIGxvY2FsVmVydGV4ID0gcG8uZ2VvbWV0cnkudmVydGljZXNbdmVydGV4SW5kZXhdLmNsb25lKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XHJcbiAgICAgICAgLy8gICAgIHZhciBkaXJlY3Rpb25WZWN0b3IgPSBnbG9iYWxWZXJ0ZXguc3ViU2VsZiggcG8ucG9zaXRpb24gKTtcclxuXHJcbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcclxuICAgICAgICAvLyAgICAgdmFyIGNvbGxpc2lvblJlc3VsdHMgPSByYXkuaW50ZXJzZWN0T2JqZWN0cyggZ3JvdXBCbG9ja3MgKTtcclxuICAgICAgICAvLyAgICAgaWYgKCBjb2xsaXNpb25SZXN1bHRzLmxlbmd0aCA+IDAgJiYgY29sbGlzaW9uUmVzdWx0c1swXS5kaXN0YW5jZSA8IGRpcmVjdGlvblZlY3Rvci5sZW5ndGgoKSApXHJcbiAgICAgICAgLy8gICAgIHtcclxuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKCdwZXJkaXN0cmUnKVxyXG4gICAgICAgIC8vICAgICAgICAgLy8gYSBjb2xsaXNpb24gb2NjdXJyZWQuLi4gZG8gc29tZXRoaW5nLi4uXHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgLy8gaWYoKHBsYXllck9iamVjdC5wb3NpdGlvbi54KzUgPCBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1IDwgcG9zLnopfHwgKHBsYXllck9iamVjdC5wb3NpdGlvbi54LTUgPiBwb3MueCAmJiBwbGF5ZXJPYmplY3QucG9zaXRpb24ueis1ID4gcG9zLnopKVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxyXG4gICAgICAgIC8vIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtYWtlUGxheWVyT2JqZWN0KCkge1xyXG4gICAgICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5PYmplY3RMb2FkZXIoKTtcclxuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcclxuXHJcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMTA7XHJcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogLTIwO1xyXG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xyXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVkoMTgwICogTWF0aC5QSSAvIDE4MCk7XHJcblxyXG4gICAgICAgIG9iamVjdC5hZGQocG92Q2FtZXJhKTtcclxuICAgICAgICBvYmplY3QuYWRkKHRyYWNraW5nQ2FtZXJhKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG9iamVjdDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRvTW92ZW1lbnRMb29wOiBkb01vdmVtZW50TG9vcCxcclxuICAgICAgICBwbGF5ZXJPYmplY3Q6IHBsYXllck9iamVjdCxcclxuICAgICAgICBnZXRDYW1lcmE6IGdldENhbWVyYSxcclxuICAgICAgICBwbGF5ZXJJZDogcGxheWVySWRcclxuICAgIH07XHJcbn0pKCk7XHJcbiJdfQ==
