"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=50,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,MINICAM_FACTOR=1.5,BOX_SIZE=10,CHECK_SIZE=100,Physics=function(){var e=-1,t=new THREE.Vector3(0,-TOP_CAMERA_DIST,0),o=new THREE.Vector3(0,1,0),n=new THREE.Raycaster;return{gravity:function(i,r){t.x=i.position.x,t.z=i.position.z,n.set(t,o),(!n.intersectObject(r,!0).length||i.position.y<0)&&(i.position.y+=e)},detectCollision:function(e,t){for(var o=(new THREE.Box3).setFromObject(e),n=0;n<t.length;n++)if(o.intersectsBox(t[n].boundingBox))return!0;return!1},checkPoints:function(e,t){for(var o=(new THREE.Box3).setFromObject(e),n=0;n<t.length;n++)if(o.intersectsBox(t[n].boundingBox))return n;return-1}}}(),Checkpoint=function(e,t,o){var n=new THREE.BoxGeometry(CHECK_SIZE,BOX_SIZE,CHECK_SIZE),i=new THREE.MeshBasicMaterial({color:16777215,wireframe:!0});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=o,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Box=function(e,t,o){var n=new THREE.BoxGeometry(BOX_SIZE,BOX_SIZE,BOX_SIZE),i=new THREE.MeshBasicMaterial({color:11176004});this.mesh=new THREE.Mesh(n,i),this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=o,this.boundingBox=(new THREE.Box3).setFromObject(this.mesh)},Player=function(){function e(e){e=e||event,d[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,i=function(){var e=(new THREE.ObjectLoader).parse(playerCar);return t.position.y=2*e.scale.y,t.position.z=4*e.scale.z,t.rotateY(180*Math.PI/180),o.position.y=10*e.scale.y,o.position.z=-20*e.scale.z,o.rotateY(180*Math.PI/180),e.add(t),e.add(o),e}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},a=r.movement.arrows,s=0,E=5,c=.05,l=.05,d={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){d[a.up]&&s<E&&(s+=c),d[a.left]&&i.rotateY(l),d[a.right]&&i.rotateY(-l),d[a.down]&&s>0&&(s-=c,s=Math.max(0,s)),i.translateZ(s),d[r.switchCamera]&&(n=n===t?o:t,d[r.switchCamera]=!1),d[r.reset]&&(i.rotation.x=0,i.position.set(0,i.position.x,0),i.rotation.y=0,i.position.set(0,i.position.y,0),i.rotation.z=0,i.position.set(0,i.position.z,0),s=0)},playerObject:i,getCamera:function(){return n},playerId:null,crash:function(){s=0}}}(),NotMarioKart=function(){function e(){(l=io({transports:["websocket"],upgrade:!1})).on("all-players",function(e){console.log("[all-players]",e),e.forEach(function(e){var o=e.position,n=e.rotation,i=t();T[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),d.add(i)}),0==e.length&&(i(),l.emit("send-boxes",y))}),l.on("player-joined",function(e){toastr.success("player "+e.id+" has joined."),console.log("[player-joined]",e);var o=e.position,n=e.rotation,i=t();T[e.id]={position:o,rotation:n,car:i},i.position.set(o.x,o.y,o.z),i.rotation.set(n.x,n.y,n.z),d.add(i)}),l.on("receive-boxes",function(e){y=e,r()}),l.on("player-left",function(e){toastr.error("Player "+e+" has left."),console.log("[player-left]",e);var t=T[e].car;d.remove(t),delete T[e]}),l.on("update-player",function(e){console.log("[update-player]",e);var t=e.id,o=e.position,n=e.rotation,i=T[t];i.car.position.set(o.x,o.y,o.z),i.car.rotation.set(n.x,n.y,n.z)}),l.on("start-countdown",function(e){toastr.info(e+" seconds before the race starts."),console.log("[start-countdown]",e)}),l.on("start",function(){toastr.info("The race has started."),console.log("[start]")}),l.on("finished",function(e){toastr.info("You finished."),console.log("[finished]",e)}),l.on("stop",function(e){toaster.info("The race is over."),console.log("[stop]",stop),e.forEach(function(e){e.name})}),window.setInterval(function(){var e=Player.playerObject;l.emit("update-player",{position:{x:e.position.x,y:e.position.y,z:e.position.z},rotation:{x:e.rotation._x,y:e.rotation._y,z:e.rotation._z}})},40)}function t(){return(new THREE.ObjectLoader).parse(playerCar)}function o(){var e=new THREE.CatmullRomCurve3([new THREE.Vector3(0,0,0),new THREE.Vector3(0,500,0),new THREE.Vector3(-200,500,0),new THREE.Vector3(-200,800,0),new THREE.Vector3(600,800,0),new THREE.Vector3(600,500,0),new THREE.Vector3(300,500,0),new THREE.Vector3(300,0,0),new THREE.Vector3(800,0,0),new THREE.Vector3(800,-500,0),new THREE.Vector3(0,-500,0)]);e.closed=!0;for(var t={steps:100,extrudePath:e},o=new THREE.Shape([new THREE.Vector2(2*CAR_SIZE_Y,0),new THREE.Vector2(0,5*CAR_SIZE_X),new THREE.Vector2(0,-5*CAR_SIZE_X)]),n=new THREE.ExtrudeGeometry(o,t),i=[],r=0;r<NUMBER_COLORS;r++)i.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[r],side:THREE.DoubleSide}));for(var a=n.faces.length/2,s=0;s<a;s++){var c=2*s;n.faces[c].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS,n.faces[c+1].materialIndex=(s+Math.floor(s/WORLD_SIDE_SIZE))%NUMBER_COLORS}(E=new THREE.Mesh(n,i)).rotateX(-Math.PI/2),E.position.y=0,d.add(E)}function n(){for(var e=[new THREE.Vector3(0,0,0),new THREE.Vector3(300,0,580),new THREE.Vector3(250,0,-200),new THREE.Vector3(200,0,-870),new THREE.Vector3(0,0,-500)],t=0;t<e.length;t++){var o=new Checkpoint(e[t].x,BOX_SIZE/2,e[t].z);d.updateMatrixWorld(),u.push(o),d.add(o.mesh)}}function i(){for(var e=0;e<1e3;e++){var t=new Box(Math.floor(4001*Math.random()-2e3),BOX_SIZE/2,Math.floor(4001*Math.random()-2e3));d.updateMatrixWorld(),Physics.gravity(t.mesh,E),t.mesh.position.y==BOX_SIZE/2&&(I.push(t),y.push({x:t.mesh.position.x,z:t.mesh.position.z}),d.add(t.mesh))}}function r(){for(var e=0;e<y.length;e++){var t=new Box(y[e].x,BOX_SIZE/2,y[e].z);d.updateMatrixWorld(),Physics.gravity(t.mesh,E),t.mesh.position.y==BOX_SIZE/2&&(I.push(t),d.add(t.mesh))}}function a(){c==_+1&&(_=c),0==c&&4==_&&(_=c,H+=1,l.emit("player-lap",H))}function s(){requestAnimationFrame(s),p.clear(),p.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),p.render(d,Player.getCamera()),h.clear(),h.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),h.render(d,R),Player.doMovementLoop(),Physics.detectCollision(Player.playerObject,I)&&Player.crash(),-1!=(c=Physics.checkPoints(Player.playerObject,u))&&(w%10==0&&a(),w+=1,w%=10),R.position.z=Player.playerObject.position.z,Physics.gravity(Player.playerObject,E)}var E,c,l,d=new THREE.Scene,p=new THREE.WebGLRenderer,h=new THREE.WebGLRenderer,R=new THREE.OrthographicCamera(-WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_WIDTH/MINICAM_FACTOR,WINDOW_HEIGHT/MINICAM_FACTOR,-WINDOW_HEIGHT/MINICAM_FACTOR,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50),I=[],u=[],T={},y=[],H=0,w=0,_=0;return{init:function(){p.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),p.setPixelRatio(window.devicePixelRatio),p.domElement.style.position="fixed",document.body.appendChild(p.domElement),p.autoClear=!1,h.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),h.setPixelRatio(window.devicePixelRatio),h.domElement.style.position="fixed",h.domElement.style.top="5%",h.domElement.style.left="70%",h.domElement.style.zIndex="2",h.domElement.style.outline="white solid",document.body.appendChild(h.domElement),h.autoClear=!1,R.position.y=TOP_CAMERA_DIST,R.rotation.x=-90*Math.PI/180,o(),n(),d.add(Player.playerObject),e(),s()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBoeXNpY3MuanMiLCJDaGVja3BvaW50LmpzIiwiQm94LmpzIiwiUGxheWVyLmpzIiwiTm90TWFyaW9LYXJ0LmpzIl0sIm5hbWVzIjpbIldPUkxEX1NJREVfU0laRSIsIldJTkRPV19IRUlHSFQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsIldJTkRPV19XSURUSCIsImlubmVyV2lkdGgiLCJST0FEX0NPTE9SUyIsIk5VTUJFUl9DT0xPUlMiLCJsZW5ndGgiLCJXT1JMRF9IRUlHSFQiLCJXT1JMRF9XSURUSCIsIlRPUF9DQU1FUkFfRElTVCIsIkNBUl9TSVpFX1giLCJDQVJfU0laRV9ZIiwiQ0FSX1NJWkVfWiIsIk1JTklDQU1fRkFDVE9SIiwiQk9YX1NJWkUiLCJDSEVDS19TSVpFIiwiUGh5c2ljcyIsImciLCJoZWxsIiwiVEhSRUUiLCJWZWN0b3IzIiwib25lRGlyZWN0aW9uIiwicmF5Y2FzdGVyIiwiUmF5Y2FzdGVyIiwiZ3Jhdml0eSIsIm9iamVjdCIsImZsb29yIiwieCIsInBvc2l0aW9uIiwieiIsInNldCIsImludGVyc2VjdE9iamVjdCIsInkiLCJkZXRlY3RDb2xsaXNpb24iLCJjYXIiLCJvYmplY3RzIiwiY2FyQm94IiwiQm94MyIsInNldEZyb21PYmplY3QiLCJpIiwiaW50ZXJzZWN0c0JveCIsImJvdW5kaW5nQm94IiwiY2hlY2tQb2ludHMiLCJDaGVja3BvaW50IiwiZ2VvbWV0cnkiLCJCb3hHZW9tZXRyeSIsIm1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsIndpcmVmcmFtZSIsInRoaXMiLCJtZXNoIiwiTWVzaCIsIkJveCIsIlBsYXllciIsIm9uS2V5TW92ZSIsImUiLCJldmVudCIsImtleUNvZGVNYXAiLCJ3aGljaCIsInR5cGUiLCJwb3ZDYW1lcmEiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInRyYWNraW5nQ2FtZXJhIiwiY3VycmVudENhbWVyYSIsInBsYXllck9iamVjdCIsIk9iamVjdExvYWRlciIsInBhcnNlIiwicGxheWVyQ2FyIiwic2NhbGUiLCJyb3RhdGVZIiwiTWF0aCIsIlBJIiwiYWRkIiwibWFrZVBsYXllck9iamVjdCIsImNvbnRyb2xzIiwibW92ZW1lbnQiLCJhcnJvd3MiLCJ1cCIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJ3YXNkIiwic3dpdGNoQ2FtZXJhIiwicmVzZXQiLCJlbmFibGVkQ29udHJvbHMiLCJzcGVlZCIsIm1heFNwZWVkIiwiYWNjZWxlcmF0aW9uIiwicm90YXRpb25TcGVlZCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRvTW92ZW1lbnRMb29wIiwibWF4IiwidHJhbnNsYXRlWiIsInJvdGF0aW9uIiwiZ2V0Q2FtZXJhIiwicGxheWVySWQiLCJjcmFzaCIsIk5vdE1hcmlvS2FydCIsImluaXRTb2NrZXRFdmVudCIsInNvY2tldCIsImlvIiwidHJhbnNwb3J0cyIsInVwZ3JhZGUiLCJvbiIsImRhdGEiLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsInBsYXllciIsInBvcyIsInJvdCIsIm1ha2VDYXJPYmplY3QiLCJwbGF5ZXJzIiwiaWQiLCJzY2VuZSIsImFkZEJveGVzIiwiZW1pdCIsImJveGVzIiwidG9hc3RyIiwic3VjY2VzcyIsImJveHMiLCJhZGRCb3hlc1Bvc2l0aW9uIiwiZXJyb3IiLCJyZW1vdmUiLCJwIiwic2Vjb25kcyIsImluZm8iLCJ0aW1lIiwidG9hc3RlciIsInN0b3AiLCJuYW1lIiwic2V0SW50ZXJ2YWwiLCJfeCIsIl95IiwiX3oiLCJidWlsZEZsb29yIiwiY3VydmUiLCJDYXRtdWxsUm9tQ3VydmUzIiwiY2xvc2VkIiwiZXh0cnVkZVNldHRpbmdzIiwic3RlcHMiLCJleHRydWRlUGF0aCIsInNoYXBlIiwiU2hhcGUiLCJWZWN0b3IyIiwiRXh0cnVkZUdlb21ldHJ5IiwibWF0ZXJpYWxzIiwicHVzaCIsInNpZGUiLCJEb3VibGVTaWRlIiwiZ2VvRmFjZXNMZW5ndGgiLCJmYWNlcyIsImoiLCJtYXRlcmlhbEluZGV4Iiwicm90YXRlWCIsImFkZENoZWNrcG9pbnRzIiwiY3VydmVQb2ludHMiLCJjaGVjayIsInVwZGF0ZU1hdHJpeFdvcmxkIiwiY2hlY2twb2ludHMiLCJib3giLCJyYW5kb20iLCJjaGVja0xhcCIsImN1cnJlbnRDaGVja3BvaW50IiwibGFzdENoZWNrcG9pbnQiLCJsYXAiLCJsb29wIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVuZGVyZXIiLCJjbGVhciIsInNldFZpZXdwb3J0IiwicmVuZGVyIiwibWluaU1hcFJlbmRlcmVyIiwibWluaU1hcENhbWVyYSIsImNoZWNrTGFwQ291bnQiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwiekluZGV4Iiwib3V0bGluZSJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0EsTUFDQSxJQUNBLFVBRUVDLGNBQWdCRCxZQUFZRSxPQUM1QkMsYUFBZSxJQUNmQyxZQUFjLElBQ2RDLGdCQUFrQixHQUNsQkMsV0FBYSxHQUNiQyxXQUFhLEdBQ2JDLFdBQWEsR0FDYkMsZUFBaUIsSUFDakJDLFNBQVcsR0FDWEMsV0FBYSxJQ3JCYkMsUUFBVyxXQUViLElBQU1DLEdBQUssRUFDUEMsRUFBTyxJQUFJQyxNQUFNQyxRQUFRLEdBQUlYLGdCQUFpQixHQUM5Q1ksRUFBZSxJQUFJRixNQUFNQyxRQUFRLEVBQUcsRUFBRyxHQUN2Q0UsRUFBWSxJQUFJSCxNQUFNSSxVQW1DMUIsT0FDSUMsUUFsQ0osU0FBaUJDLEVBQVFDLEdBRXJCUixFQUFLUyxFQUFJRixFQUFPRyxTQUFTRCxFQUN6QlQsRUFBS1csRUFBSUos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M0NpRSxJQUVBb0IsSUFFQXpDLEVBQU0zQyxJQUFJbkIsT0FBT1csY0FDakJtQyxJQUNBb0UsTUFuVGMiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWxsIGNvbnN0YW50cywgYXZhaWxhYmxlIGluIGdsb2JhbCB3aW5kb3cuXG4gKi9cblxuY29uc3QgV09STERfU0lERV9TSVpFID0gNztcbmNvbnN0IFdJTkRPV19IRUlHSFQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5jb25zdCBXSU5ET1dfV0lEVEggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbmNvbnN0IFJPQURfQ09MT1JTID0gW1xuICAgIDB4ZmYwMDAwLFxuICAgIDB4ZmY4ODAwLFxuICAgIDB4ZmZmZjAwLFxuICAgIDB4MDBmZjAwLFxuICAgIDB4MDBmZmZmLFxuICAgIDB4MDAwMGZmLFxuICAgIDB4ZmYwMGZmXG5dO1xuY29uc3QgTlVNQkVSX0NPTE9SUyA9IFJPQURfQ09MT1JTLmxlbmd0aDtcbmNvbnN0IFdPUkxEX0hFSUdIVCA9IDEwMDA7XG5jb25zdCBXT1JMRF9XSURUSCA9IDEwMDtcbmNvbnN0IFRPUF9DQU1FUkFfRElTVCA9IDUwO1xuY29uc3QgQ0FSX1NJWkVfWCA9IDEwO1xuY29uc3QgQ0FSX1NJWkVfWSA9IDEwO1xuY29uc3QgQ0FSX1NJWkVfWiA9IDEwO1xuY29uc3QgTUlOSUNBTV9GQUNUT1IgPSAxLjU7XG5jb25zdCBCT1hfU0laRSA9IDEwO1xuY29uc3QgQ0hFQ0tfU0laRSA9IDEwMDtcbiIsIi8qKlxuICogUGh5c2ljcyBcImVuZ2luZVwiIGZvciB0aGUgZ2FtZS5cbiAqIE5vdFBoeXNpanMgZm9yIE5vdE1hcmlvS2FydC5cbiAqL1xuY29uc3QgUGh5c2ljcyA9IChmdW5jdGlvbigpIHtcblxuICAgIGNvbnN0IGcgPSAtMTtcbiAgICBsZXQgaGVsbCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIC1UT1BfQ0FNRVJBX0RJU1QsIDApO1xuICAgIGxldCBvbmVEaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAxLCAwKTtcbiAgICBsZXQgcmF5Y2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3RlcigpO1xuXG4gICAgZnVuY3Rpb24gZ3Jhdml0eShvYmplY3QsIGZsb29yKSB7XG4gICAgICAgIC8vIFVwZGF0ZSByYXljYXN0ZXIgd2l0aCBhbiBvcmlnaW4gYmVsb3cgdGhlIG9iamVjdC5cbiAgICAgICAgaGVsbC54ID0gb2JqZWN0LnBvc2l0aW9uLng7XG4gICAgICAgIGhlbGwueiA9IG9iamVjdC5wb3NpdGlvbi56O1xuICAgICAgICByYXljYXN0ZXIuc2V0KGhlbGwsIG9uZURpcmVjdGlvbik7XG5cbiAgICAgICAgLy8gVHJ5IHRvIGludGVyc2VjdCB3aXRoIGZsb29yLlxuICAgICAgICBsZXQgaW50ZXJzZWN0cyA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3QoZmxvb3IsIHRydWUpO1xuICAgICAgICBpZiAoIWludGVyc2VjdHMubGVuZ3RoIHx8IG9iamVjdC5wb3NpdGlvbi55IDwgMCkge1xuICAgICAgICAgICAgb2JqZWN0LnBvc2l0aW9uLnkgKz0gZztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRldGVjdENvbGxpc2lvbihjYXIsIG9iamVjdHMpIHtcbiAgICAgICAgbGV0IGNhckJveCA9IG5ldyBUSFJFRS5Cb3gzKCkuc2V0RnJvbU9iamVjdChjYXIpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iamVjdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjYXJCb3guaW50ZXJzZWN0c0JveChvYmplY3RzW2ldLmJvdW5kaW5nQm94KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja1BvaW50cyhjYXIsIG9iamVjdHMpIHtcbiAgICAgICAgbGV0IGNhckJveCA9IG5ldyBUSFJFRS5Cb3gzKCkuc2V0RnJvbU9iamVjdChjYXIpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iamVjdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjYXJCb3guaW50ZXJzZWN0c0JveChvYmplY3RzW2ldLmJvdW5kaW5nQm94KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBncmF2aXR5OiBncmF2aXR5LFxuICAgICAgICBkZXRlY3RDb2xsaXNpb246IGRldGVjdENvbGxpc2lvbixcbiAgICAgICAgY2hlY2tQb2ludHM6IGNoZWNrUG9pbnRzXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIEJveGVzIHJlcHJlc2VudGluZyBvYnN0YWNsZXMuXG4gKi9cbmNvbnN0IENoZWNrcG9pbnQgPSAoZnVuY3Rpb24oeCwgeSwgeikge1xuICAgIGxldCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggQ0hFQ0tfU0laRSwgQk9YX1NJWkUsIENIRUNLX1NJWkUgKTtcbiAgICBsZXQgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhmZmZmZmYsIHdpcmVmcmFtZTp0cnVlfSApO1xuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueCA9IHg7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnkgPSB5O1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi56ID0gejtcbiAgICB0aGlzLmJvdW5kaW5nQm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KHRoaXMubWVzaCk7XG59KTtcbiIsIi8qKlxuICogQm94ZXMgcmVwcmVzZW50aW5nIG9ic3RhY2xlcy5cbiAqL1xuY29uc3QgQm94ID0gKGZ1bmN0aW9uKHgsIHksIHopIHtcbiAgICBsZXQgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIEJPWF9TSVpFLCBCT1hfU0laRSwgQk9YX1NJWkUgKTtcbiAgICBsZXQgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhhYTg4NDR9ICk7XG4gICAgdGhpcy5tZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xuICAgIHRoaXMubWVzaC5wb3NpdGlvbi54ID0geDtcbiAgICB0aGlzLm1lc2gucG9zaXRpb24ueSA9IHk7XG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLnogPSB6O1xuICAgIHRoaXMuYm91bmRpbmdCb3ggPSBuZXcgVEhSRUUuQm94MygpLnNldEZyb21PYmplY3QodGhpcy5tZXNoKTtcbn0pO1xuIiwiLyoqXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxuICovXG5cbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbigpIHtcbiAgICBjb25zdCBwb3ZDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgY29uc3QgdHJhY2tpbmdDYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoXG4gICAgICAgIDc1LFxuICAgICAgICBXSU5ET1dfV0lEVEggLyBXSU5ET1dfSEVJR0hULFxuICAgICAgICAwLjEsXG4gICAgICAgIDEwMDBcbiAgICApO1xuXG4gICAgbGV0IGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcbiAgICBsZXQgZ2V0Q2FtZXJhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50Q2FtZXJhO1xuICAgIH07XG5cbiAgICBjb25zdCBwbGF5ZXJPYmplY3QgPSBtYWtlUGxheWVyT2JqZWN0KCk7XG4gICAgdmFyIHBsYXllcklkID0gbnVsbDtcblxuICAgIGNvbnN0IGNvbnRyb2xzID0ge1xuICAgICAgICBtb3ZlbWVudDoge1xuICAgICAgICAgICAgYXJyb3dzOiB7XG4gICAgICAgICAgICAgICAgdXA6IDM4LFxuICAgICAgICAgICAgICAgIGRvd246IDQwLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDM3LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiAzOVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHdhc2Q6IHtcbiAgICAgICAgICAgICAgICB1cDogODcsXG4gICAgICAgICAgICAgICAgZG93bjogODMsXG4gICAgICAgICAgICAgICAgbGVmdDogNjUsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDY4XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHN3aXRjaENhbWVyYTogNjcsXG4gICAgICAgIHJlc2V0OiA4XG4gICAgfTtcblxuICAgIGxldCBlbmFibGVkQ29udHJvbHMgPSBjb250cm9scy5tb3ZlbWVudC5hcnJvd3M7XG5cbiAgICBsZXQgc3BlZWQgPSAwO1xuICAgIGxldCBtYXhTcGVlZCA9IDU7XG4gICAgY29uc3QgYWNjZWxlcmF0aW9uID0gMC4wNTtcbiAgICBjb25zdCByb3RhdGlvblNwZWVkID0gMC4wNTtcblxuICAgIGNvbnN0IGtleUNvZGVNYXAgPSB7fTtcblxuICAgIGZ1bmN0aW9uIG9uS2V5TW92ZShlKSB7XG4gICAgICAgIGUgPSBlIHx8IGV2ZW50OyAvLyBGb3IgSUUuXG4gICAgICAgIGtleUNvZGVNYXBbZS53aGljaF0gPSBlLnR5cGUgPT09ICdrZXlkb3duJztcbiAgICB9XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlNb3ZlLCBmYWxzZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBvbktleU1vdmUsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGRvTW92ZW1lbnRMb29wKCkge1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgICAgICBpZiAoc3BlZWQgPCBtYXhTcGVlZCkge1xuICAgICAgICAgICAgICAgIHNwZWVkICs9IGFjY2VsZXJhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMubGVmdF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5yaWdodF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMuZG93bl0pIHtcbiAgICAgICAgICAgIGlmIChzcGVlZCA+IDApIHtcbiAgICAgICAgICAgICAgICBzcGVlZCAtPSBhY2NlbGVyYXRpb247XG4gICAgICAgICAgICAgICAgc3BlZWQgPSBNYXRoLm1heCgwLCBzcGVlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudENhbWVyYSA9PT0gcG92Q2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2FtZXJhID0gcG92Q2FtZXJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMucmVzZXRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueCA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi54LCAwKTtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGlvbi55ID0gMDtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5wb3NpdGlvbi5zZXQoMCwgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnksIDApO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnogPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueiwgMCk7XG4gICAgICAgICAgICBzcGVlZCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmFzaCgpIHtcbiAgICAgICAgLy8gYWNjZWxlcmF0aW9uID0gMDtcbiAgICAgICAgc3BlZWQgPSAwO1xuICAgICAgICAvLyBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMudXBdKSB7XG4gICAgICAgIC8vICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWigtc3BlZWQpO1xuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooc3BlZWQpO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gZm9yICh2YXIgaSA9IGdyb3VwQmxvY2tzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIC8vIGxldCBwb3MgPSBncm91cEJsb2Nrc1tpXS5wb3NpdGlvbjtcbiAgICAgICAgLy8gICAgIGxldCBwbyA9IHBsYXllck9iamVjdC5jaGlsZHJlblsyXS5jaGlsZHJlblswXVxuICAgICAgICAvLyBmb3IgKHZhciB2ZXJ0ZXhJbmRleCA9IDA7IHZlcnRleEluZGV4IDwgcG8uZ2VvbWV0cnkudmVydGljZXMubGVuZ3RoOyB2ZXJ0ZXhJbmRleCsrKVxuICAgICAgICAvLyB7XG4gICAgICAgIC8vICAgICB2YXIgbG9jYWxWZXJ0ZXggPSBwby5nZW9tZXRyeS52ZXJ0aWNlc1t2ZXJ0ZXhJbmRleF0uY2xvbmUoKTtcbiAgICAgICAgLy8gICAgIHZhciBnbG9iYWxWZXJ0ZXggPSBsb2NhbFZlcnRleC5hcHBseU1hdHJpeHBsYXllck9iamVjdC5tYXRyaXgubXVsdGlwbHlWZWN0b3IzKCk7XG4gICAgICAgIC8vICAgICB2YXIgZGlyZWN0aW9uVmVjdG9yID0gZ2xvYmFsVmVydGV4LnN1YlNlbGYoIHBvLnBvc2l0aW9uICk7XG5cbiAgICAgICAgLy8gICAgIHZhciByYXkgPSBuZXcgVEhSRUUuUmF5KCBwby5wb3NpdGlvbiwgZGlyZWN0aW9uVmVjdG9yLmNsb25lKCkubm9ybWFsaXplKCkgKTtcbiAgICAgICAgLy8gICAgIHZhciBjb2xsaXNpb25SZXN1bHRzID0gcmF5LmludGVyc2VjdE9iamVjdHMoIGdyb3VwQmxvY2tzICk7XG4gICAgICAgIC8vICAgICBpZiAoIGNvbGxpc2lvblJlc3VsdHMubGVuZ3RoID4gMCAmJiBjb2xsaXNpb25SZXN1bHRzWzBdLmRpc3RhbmNlIDwgZGlyZWN0aW9uVmVjdG9yLmxlbmd0aCgpIClcbiAgICAgICAgLy8gICAgIHtcbiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZygncGVyZGlzdHJlJylcbiAgICAgICAgLy8gICAgICAgICAvLyBhIGNvbGxpc2lvbiBvY2N1cnJlZC4uLiBkbyBzb21ldGhpbmcuLi5cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfVxuICAgICAgICAvLyBpZigocGxheWVyT2JqZWN0LnBvc2l0aW9uLngrNSA8IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPCBwb3Mueil8fCAocGxheWVyT2JqZWN0LnBvc2l0aW9uLngtNSA+IHBvcy54ICYmIHBsYXllck9iamVjdC5wb3NpdGlvbi56KzUgPiBwb3MueikpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGdyb3VwQmxvY2tzW2ldKVxuICAgICAgICAvLyB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZVBsYXllck9iamVjdCgpIHtcbiAgICAgICAgY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLk9iamVjdExvYWRlcigpO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBsb2FkZXIucGFyc2UocGxheWVyQ2FyKTtcblxuICAgICAgICBwb3ZDYW1lcmEucG9zaXRpb24ueSA9IG9iamVjdC5zY2FsZS55ICogMjtcbiAgICAgICAgcG92Q2FtZXJhLnBvc2l0aW9uLnogPSBvYmplY3Quc2NhbGUueiAqIDQ7XG4gICAgICAgIC8vIHRyYWNraW5nQ2FtZXJhLnJvdGF0ZVgoMCAqIE1hdGguUEkgLyAxODApO1xuICAgICAgICBwb3ZDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICB0cmFja2luZ0NhbWVyYS5wb3NpdGlvbi55ID0gb2JqZWN0LnNjYWxlLnkgKiAxMDtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueiA9IG9iamVjdC5zY2FsZS56ICogLTIwO1xuICAgICAgICAvLyB0cmFja2luZ0NhbWVyYS5yb3RhdGVYKDAgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucm90YXRlWSgxODAgKiBNYXRoLlBJIC8gMTgwKTtcblxuICAgICAgICBvYmplY3QuYWRkKHBvdkNhbWVyYSk7XG4gICAgICAgIG9iamVjdC5hZGQodHJhY2tpbmdDYW1lcmEpO1xuXG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9Nb3ZlbWVudExvb3A6IGRvTW92ZW1lbnRMb29wLFxuICAgICAgICBwbGF5ZXJPYmplY3Q6IHBsYXllck9iamVjdCxcbiAgICAgICAgZ2V0Q2FtZXJhOiBnZXRDYW1lcmEsXG4gICAgICAgIHBsYXllcklkOiBwbGF5ZXJJZCxcbiAgICAgICAgY3Jhc2g6IGNyYXNoXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIE1haW4gZmlsZSBvZiB0aGUgZ2FtZS5cbiAqL1xuXG5jb25zdCBOb3RNYXJpb0thcnQgPSAoZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcbiAgICBjb25zdCByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XG4gICAgY29uc3QgbWluaU1hcFJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcbiAgICBjb25zdCBtaW5pTWFwQ2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYShcbiAgICAgICAgLVdJTkRPV19XSURUSC9NSU5JQ0FNX0ZBQ1RPUixcbiAgICAgICAgV0lORE9XX1dJRFRIL01JTklDQU1fRkFDVE9SLFxuICAgICAgICBXSU5ET1dfSEVJR0hUL01JTklDQU1fRkFDVE9SLFxuICAgICAgICAtV0lORE9XX0hFSUdIVC9NSU5JQ0FNX0ZBQ1RPUixcbiAgICAgICAgVE9QX0NBTUVSQV9ESVNUIC0gNTAsXG4gICAgICAgIFRPUF9DQU1FUkFfRElTVCArIDUwXG4gICAgKTtcbiAgICB2YXIgZmxvb3I7XG4gICAgLy9Cb3ggb2JqZWN0c1xuICAgIHZhciBvYmplY3RzID0gW107XG4gICAgdmFyIGNoZWNrcG9pbnRzID0gW107XG4gICAgY29uc3QgcGxheWVycyA9IHt9O1xuICAgIC8vQm94IHBvc2l0aW9ucyBmb3Igb3RoZXIgcGxheWVyc1xuICAgIHZhciBib3hlcyA9IFtdO1xuICAgIHZhciBsYXAgPSAwO1xuICAgIHZhciBjaGVja0xhcENvdW50ID0gMDtcbiAgICB2YXIgY3VycmVudENoZWNrcG9pbnQ7XG4gICAgdmFyIGxhc3RDaGVja3BvaW50ID0gMDtcbiAgICB2YXIgc29ja2V0O1xuXG4gICAgZnVuY3Rpb24gaW5pdFNvY2tldEV2ZW50KCkge1xuICAgICAgICBzb2NrZXQgPSBpbyh7IHRyYW5zcG9ydHM6IFsnd2Vic29ja2V0J10sIHVwZ3JhZGU6IGZhbHNlIH0pO1xuXG4gICAgICAgIC8vIFRPRE86IHNob3cgbW9kYWwgd2l0aCBuYW1lIGZvcm0sIHRoZW4gZW1pdCBuYW1lXG5cbiAgICAgICAgc29ja2V0Lm9uKCdhbGwtcGxheWVycycsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbYWxsLXBsYXllcnNdJywgZGF0YSk7XG4gICAgICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IHBsYXllci5yb3RhdGlvbjtcbiAgICAgICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XG4gICAgICAgICAgICAgICAgcGxheWVyc1twbGF5ZXIuaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zLFxuICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxuICAgICAgICAgICAgICAgICAgICBjYXI6IGNhclxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgICAgICBjYXIucm90YXRpb24uc2V0KHJvdC54LCByb3QueSwgcm90LnopO1xuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChjYXIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIGlmKGRhdGEubGVuZ3RoID09IDApe1xuICAgICAgICAgICAgICAgIGFkZEJveGVzKCk7XG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ3NlbmQtYm94ZXMnLGJveGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdwbGF5ZXItam9pbmVkJywgZnVuY3Rpb24ocGxheWVyKSB7XG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhgcGxheWVyICR7cGxheWVyLmlkfSBoYXMgam9pbmVkLmApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1twbGF5ZXItam9pbmVkXScsIHBsYXllcik7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICBjb25zdCBjYXIgPSBtYWtlQ2FyT2JqZWN0KCk7XG4gICAgICAgICAgICBwbGF5ZXJzW3BsYXllci5pZF0gPSB7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcbiAgICAgICAgICAgICAgICByb3RhdGlvbjogcm90LFxuICAgICAgICAgICAgICAgIGNhcjogY2FyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY2FyLnBvc2l0aW9uLnNldChwb3MueCwgcG9zLnksIHBvcy56KTtcbiAgICAgICAgICAgIGNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgICAgICBzY2VuZS5hZGQoY2FyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc29ja2V0Lm9uKCdyZWNlaXZlLWJveGVzJywgZnVuY3Rpb24oYm94cykge1xuICAgICAgICAgICAgYm94ZXMgPSBib3hzO1xuICAgICAgICAgICAgYWRkQm94ZXNQb3NpdGlvbigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzb2NrZXQub24oJ3BsYXllci1sYXAnLCBmdW5jdGlvbigpe1xuXG4gICAgICAgIC8vIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbigncGxheWVyLWxlZnQnLCBmdW5jdGlvbihwbGF5ZXJJZCkge1xuICAgICAgICAgICAgdG9hc3RyLmVycm9yKGBQbGF5ZXIgJHtwbGF5ZXJJZH0gaGFzIGxlZnQuYCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnW3BsYXllci1sZWZ0XScsIHBsYXllcklkKTtcbiAgICAgICAgICAgIGNvbnN0IGNhciA9IHBsYXllcnNbcGxheWVySWRdLmNhcjtcbiAgICAgICAgICAgIHNjZW5lLnJlbW92ZShjYXIpO1xuICAgICAgICAgICAgZGVsZXRlIHBsYXllcnNbcGxheWVySWRdO1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ3VwZGF0ZS1wbGF5ZXInLCBmdW5jdGlvbihwbGF5ZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbdXBkYXRlLXBsYXllcl0nLCBwbGF5ZXIpO1xuICAgICAgICAgICAgY29uc3QgaWQgPSBwbGF5ZXIuaWQ7XG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwbGF5ZXIucG9zaXRpb247XG4gICAgICAgICAgICBjb25zdCByb3QgPSBwbGF5ZXIucm90YXRpb247XG4gICAgICAgICAgICBjb25zdCBwID0gcGxheWVyc1tpZF07XG4gICAgICAgICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQtY291bnRkb3duJywgZnVuY3Rpb24oc2Vjb25kcykge1xuICAgICAgICAgICAgdG9hc3RyLmluZm8oYCR7c2Vjb25kc30gc2Vjb25kcyBiZWZvcmUgdGhlIHJhY2Ugc3RhcnRzLmApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1tzdGFydC1jb3VudGRvd25dJywgc2Vjb25kcyk7XG4gICAgICAgICAgICAvLyBUT0RPOiBzaG93IFwieCBzZWNvbmRzIGJlZm9yZSBzdGFydFwiXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKCdUaGUgcmFjZSBoYXMgc3RhcnRlZC4nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RhcnRdJyk7XG4gICAgICAgICAgICAvLyBUT0RPOiBub3RpZnkgdGhlIGdhbWUgaGFzIHN0YXJ0ZWRcbiAgICAgICAgICAgIC8vIFRPRE86IGRpc2FibGUgbW92aW5nIGlmIG5vdCBzdGFydGVkXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyBhIG5hbWUgZmlyc3QgKGRvbid0IGhpZGUgbW9kYWwpXG4gICAgICAgICAgICAvLyBUT0RPOiBldmVyeW9uZSBuZWVkcyB0byBiZSByZWFkeVxuICAgICAgICAgICAgLy8gVE9ETzogMisgcGxheWVyc1xuICAgICAgICB9KTtcblxuICAgICAgICBzb2NrZXQub24oJ2ZpbmlzaGVkJywgZnVuY3Rpb24odGltZSkge1xuICAgICAgICAgICAgdG9hc3RyLmluZm8oJ1lvdSBmaW5pc2hlZC4nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbZmluaXNoZWRdJywgdGltZSk7XG4gICAgICAgICAgICAvLyBUT0RPOiBzaG93IG1vZGFsIFwid2FpdGluZyBmb3Igb3RoZXJzLCB5b3VyIHRpbWUgaXMgeFwiXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNvY2tldC5vbignc3RvcCcsIGZ1bmN0aW9uKHBsYXllcnMpIHtcbiAgICAgICAgICAgIHRvYXN0ZXIuaW5mbygnVGhlIHJhY2UgaXMgb3Zlci4nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbc3RvcF0nLCBzdG9wKTtcbiAgICAgICAgICAgIC8vIFRPRE86IGFsbCBwbGF5ZXJzIGFyZSBmaW5pc2hlZCwgc2hvdyByYW5raW5nIGFuZCBwbGF5IGFnYWluIGJ1dHRvblxuICAgICAgICAgICAgcGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uKHBsYXllcikge1xuICAgICAgICAgICAgICAgIC8vIHNvcnRlZCBieSByYW5raW5nIDotKVxuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwbGF5ZXIubmFtZTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gdGltZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zdCBwID0gUGxheWVyLnBsYXllck9iamVjdDtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCd1cGRhdGUtcGxheWVyJywge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHAucG9zaXRpb24ueCxcbiAgICAgICAgICAgICAgICAgICAgeTogcC5wb3NpdGlvbi55LFxuICAgICAgICAgICAgICAgICAgICB6OiBwLnBvc2l0aW9uLnpcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHAucm90YXRpb24uX3gsXG4gICAgICAgICAgICAgICAgICAgIHk6IHAucm90YXRpb24uX3ksXG4gICAgICAgICAgICAgICAgICAgIHo6IHAucm90YXRpb24uX3pcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTAwMCAvIDI1KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWtlQ2FyT2JqZWN0KCkge1xuICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuT2JqZWN0TG9hZGVyKCk7XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IGxvYWRlci5wYXJzZShwbGF5ZXJDYXIpO1xuICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkRmxvb3IoKSB7XG4gICAgICAgIGxldCBjdXJ2ZSA9IG5ldyBUSFJFRS5DYXRtdWxsUm9tQ3VydmUzKFtcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgNTAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0yMDAsIDUwMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygtMjAwLCA4MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoNjAwLCA4MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoNjAwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMzAwLCA1MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMzAwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDgwMCwgMCwgMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyg4MDAsIC01MDAsIDApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgLTUwMCwgMClcbiAgICAgICAgXSk7XG4gICAgICAgIGN1cnZlLmNsb3NlZCA9IHRydWU7XG5cbiAgICAgICAgbGV0IGV4dHJ1ZGVTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHN0ZXBzOiAxMDAsXG4gICAgICAgICAgICBleHRydWRlUGF0aDogY3VydmVcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBTaGFwZSB0aGF0IGdldHMgZXh0cnVkZWQgdGhyb3VnaCB0aGUgY3VydmVcbiAgICAgICAgbGV0IHNoYXBlID0gbmV3IFRIUkVFLlNoYXBlKFtcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDIgKiBDQVJfU0laRV9ZLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIDUgKiBDQVJfU0laRV9YKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKDAsIC01ICogQ0FSX1NJWkVfWClcbiAgICAgICAgXSk7XG5cbiAgICAgICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkV4dHJ1ZGVHZW9tZXRyeShzaGFwZSwgZXh0cnVkZVNldHRpbmdzKTtcblxuICAgICAgICBsZXQgbWF0ZXJpYWxzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNQkVSX0NPTE9SUzsgaSsrKSB7XG4gICAgICAgICAgICBtYXRlcmlhbHMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogUk9BRF9DT0xPUlNbaV0sXG4gICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUsXG4gICAgICAgICAgICAgICAgICAgIC8vd2lyZWZyYW1lOiB0cnVlIC8vIFRoaXMgbWFrZXMgdHJhY2sgbW9yZSBUcm9uLWxpa2VcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBnZW9GYWNlc0xlbmd0aCA9IGdlb21ldHJ5LmZhY2VzLmxlbmd0aCAvIDI7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2VvRmFjZXNMZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2pdLm1hdGVyaWFsSW5kZXggPVxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xuXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqICsgMV0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxuICAgICAgICB9XG5cbiAgICAgICAgZmxvb3IgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWxzKTtcbiAgICAgICAgZmxvb3Iucm90YXRlWCgtTWF0aC5QSSAvIDIpO1xuICAgICAgICBmbG9vci5wb3NpdGlvbi55ID0gMDtcblxuICAgICAgICBzY2VuZS5hZGQoZmxvb3IpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZENoZWNrcG9pbnRzKCkge1xuICAgICAgICBsZXQgY3VydmVQb2ludHMgPSBbXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDMwMCwgMCwgNTgwKSxcbiAgICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDI1MCwgMCwgLTIwMCksXG4gICAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMygyMDAsIDAsIC04NzApLFxuICAgICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgLTUwMCksXG4gICAgICAgIF07XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJ2ZVBvaW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coY3VydmVQb2ludHNbaV0pO1xuICAgICAgICAgICAgbGV0IGNoZWNrID0gbmV3IENoZWNrcG9pbnQoY3VydmVQb2ludHNbaV0ueCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJ2ZVBvaW50c1tpXS56KTtcbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XG4gICAgICAgICAgICAvLyBpZiAoaSAhPSBjdXJ2ZVBvaW50cy5sZW5ndGgtMSkge1xuICAgICAgICAgICAgICAgIGNoZWNrcG9pbnRzLnB1c2goY2hlY2spO1xuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChjaGVjay5tZXNoKTtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZEJveGVzKCkge1xuICAgICAgICBsZXQgbWluID0gLTIwMDA7XG4gICAgICAgIGxldCBtYXggPSAgMjAwMDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSByYW5kb20gYm94LlxuICAgICAgICAgICAgbGV0IGJveCA9IG5ldyBCb3goTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKChtYXgtbWluKSsxKSArIG1pbiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCT1hfU0laRS8yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKChtYXgtbWluKSsxKSArIG1pbikpO1xuICAgICAgICAgICAgLy8gQWRkIG9ubHkgaWYgaXQncyBvdmVyIHRoZSBmbG9vci5cbiAgICAgICAgICAgIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7XG4gICAgICAgICAgICBQaHlzaWNzLmdyYXZpdHkoYm94Lm1lc2gsIGZsb29yKTtcbiAgICAgICAgICAgIGlmIChib3gubWVzaC5wb3NpdGlvbi55ID09IEJPWF9TSVpFLzIpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RzLnB1c2goYm94KTtcbiAgICAgICAgICAgICAgICBib3hlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgeDogYm94Lm1lc2gucG9zaXRpb24ueCxcbiAgICAgICAgICAgICAgICAgICAgejogYm94Lm1lc2gucG9zaXRpb24uelxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNjZW5lLmFkZChib3gubWVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGFkZEJveGVzUG9zaXRpb24oKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm94ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSByYW5kb20gYm94LlxuICAgICAgICAgICAgbGV0IGJveCA9IG5ldyBCb3goYm94ZXNbaV0ueCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJPWF9TSVpFLzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3hlc1tpXS56KTtcbiAgICAgICAgICAgIC8vIEFkZCBvbmx5IGlmIGl0J3Mgb3ZlciB0aGUgZmxvb3IuXG4gICAgICAgICAgICBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpO1xuICAgICAgICAgICAgUGh5c2ljcy5ncmF2aXR5KGJveC5tZXNoLCBmbG9vcik7XG4gICAgICAgICAgICBpZiAoYm94Lm1lc2gucG9zaXRpb24ueSA9PSBCT1hfU0laRS8yKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0cy5wdXNoKGJveCk7XG4gICAgICAgICAgICAgICAgc2NlbmUuYWRkKGJveC5tZXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrTGFwKCl7XG4gICAgICAgIGlmKGN1cnJlbnRDaGVja3BvaW50ID09IGxhc3RDaGVja3BvaW50KzEpe1xuICAgICAgICAgICAgbGFzdENoZWNrcG9pbnQgPSBjdXJyZW50Q2hlY2twb2ludDtcbiAgICAgICAgfVxuICAgICAgICBpZihjdXJyZW50Q2hlY2twb2ludCA9PSAwICYmIGxhc3RDaGVja3BvaW50ID09IDQpe1xuICAgICAgICAgICAgbGFzdENoZWNrcG9pbnQgPSBjdXJyZW50Q2hlY2twb2ludDtcbiAgICAgICAgICAgIGxhcCA9IGxhcCArIDE7XG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgncGxheWVyLWxhcCcsbGFwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIHJlbmRlcmVyLnNldFNpemUoV0lORE9XX1dJRFRILCBXSU5ET1dfSEVJR0hUKTtcbiAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICByZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuc2V0U2l6ZShXSU5ET1dfV0lEVEggLyA0LCBXSU5ET1dfSEVJR0hUIC8gNCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS50b3AgPSAnNSUnO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzcwJSc7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnpJbmRleCA9ICcyJztcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUub3V0bGluZSA9ICd3aGl0ZSBzb2xpZCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XG5cbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi55ID0gVE9QX0NBTUVSQV9ESVNUO1xuICAgICAgICBtaW5pTWFwQ2FtZXJhLnJvdGF0aW9uLnggPSAtOTAgKiBNYXRoLlBJIC8gMTgwO1xuXG4gICAgICAgIGJ1aWxkRmxvb3IoKTtcbiAgICAgICAgLy8gYWRkQm94ZXMoKTtcbiAgICAgICAgYWRkQ2hlY2twb2ludHMoKTtcblxuICAgICAgICBzY2VuZS5hZGQoUGxheWVyLnBsYXllck9iamVjdCk7XG4gICAgICAgIGluaXRTb2NrZXRFdmVudCgpO1xuICAgICAgICBsb29wKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9vcCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xuXG4gICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgUGxheWVyLmdldENhbWVyYSgpKTtcblxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCAvIDQsIFdJTkRPV19IRUlHSFQgLyA0KTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnJlbmRlcihzY2VuZSwgbWluaU1hcENhbWVyYSk7XG5cbiAgICAgICAgLy8gZm9yIChsZXQgaWQgaW4gcGxheWVycykge1xuICAgICAgICAvLyAgICAgY29uc3QgcCA9IHBsYXllcnNbaWRdO1xuICAgICAgICAvLyAgICAgY29uc3QgcG9zID0gcC5wb3NpdGlvbjtcbiAgICAgICAgLy8gICAgIGNvbnN0IHJvdCA9IHAucm90YXRpb247XG4gICAgICAgIC8vICAgICBwLmNhci5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3Mueik7XG4gICAgICAgIC8vICAgICBwLmNhci5yb3RhdGlvbi5zZXQocm90LngsIHJvdC55LCByb3Queik7XG4gICAgICAgIC8vIH1cblxuICAgICAgICBQbGF5ZXIuZG9Nb3ZlbWVudExvb3AoKTtcbiAgICAgICAgaWYgKFBoeXNpY3MuZGV0ZWN0Q29sbGlzaW9uKFBsYXllci5wbGF5ZXJPYmplY3QsIG9iamVjdHMpKSB7XG4gICAgICAgICAgICBQbGF5ZXIuY3Jhc2goKTtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50Q2hlY2twb2ludCA9IFBoeXNpY3MuY2hlY2tQb2ludHMoUGxheWVyLnBsYXllck9iamVjdCxjaGVja3BvaW50cyk7XG4gICAgICAgIGlmKGN1cnJlbnRDaGVja3BvaW50ICE9IC0xKXtcbiAgICAgICAgICAgIGlmKGNoZWNrTGFwQ291bnQgJSAxMCA9PSAwKXtcbiAgICAgICAgICAgICAgICBjaGVja0xhcCgpO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIGNoZWNrTGFwQ291bnQgKz0gMTtcbiAgICAgICAgICAgIGNoZWNrTGFwQ291bnQgPSBjaGVja0xhcENvdW50ICUgMTA7XG4gICAgICAgIH1cbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi56ID0gUGxheWVyLnBsYXllck9iamVjdC5wb3NpdGlvbi56O1xuXG4gICAgICAgIFBoeXNpY3MuZ3Jhdml0eShQbGF5ZXIucGxheWVyT2JqZWN0LCBmbG9vcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5pdDogaW5pdFxuICAgIH07XG59KSgpO1xuIl19
