"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,TOP_CAMERA_DIST=500,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,Player=function(){function e(e){e=e||event,_[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),o=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),n=o,a=function(){var e=(new THREE.TextureLoader).load("/assets/object-textures/player.jpg"),n=new THREE.BoxGeometry(CAR_SIZE_X,CAR_SIZE_Y,CAR_SIZE_Z),a=new THREE.MeshBasicMaterial({map:e}),r=new THREE.Mesh(n,a);return r.position.y=n.parameters.height/2,o.position.y=CAR_SIZE_Y,o.position.z=4*CAR_SIZE_Z,r.add(t),r.add(o),r}(),r={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},i=r.movement.arrows,E=.5,I=.03,_={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){_[i.up]&&a.translateZ(-E),_[i.left]&&a.rotateY(I),_[i.right]&&a.rotateY(-I),_[i.down]&&a.translateZ(E),_[r.switchCamera]&&(n=n===t?o:t,_[r.switchCamera]=!1),_[r.reset]&&(a.rotation.y=0,a.position.set(0,a.position.y,0))},playerObject:a,getCamera:function(){return n}}}(),NotMarioKart=function(){function e(){for(var e=new THREE.PlaneGeometry(WORLD_WIDTH,WORLD_HEIGHT,WORLD_SIDE_SIZE,1),t=[],n=0;n<NUMBER_COLORS;n++)t.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[n],side:THREE.DoubleSide}));for(var a=e.faces.length/2,r=0;r<a;r++){var i=2*r;e.faces[i].materialIndex=(r+Math.floor(r/WORLD_SIDE_SIZE))%NUMBER_COLORS,e.faces[i+1].materialIndex=(r+Math.floor(r/WORLD_SIDE_SIZE))%NUMBER_COLORS}var E=new THREE.Mesh(e,t);E.rotateX(-Math.PI/2),E.position.y=0,o.add(E)}function t(){requestAnimationFrame(t),n.clear(),n.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),n.render(o,Player.getCamera()),a.clear(),a.setViewport(0,0,WINDOW_WIDTH/4,WINDOW_HEIGHT/4),a.render(o,r),Player.doMovementLoop(),r.position.z=Player.playerObject.position.z}var o=new THREE.Scene,n=new THREE.WebGLRenderer,a=new THREE.WebGLRenderer,r=new THREE.OrthographicCamera(-WORLD_HEIGHT/2,WORLD_HEIGHT/2,WORLD_HEIGHT/2,-WORLD_HEIGHT/2,TOP_CAMERA_DIST-50,TOP_CAMERA_DIST+50);return{init:function(){n.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),n.setPixelRatio(window.devicePixelRatio),n.domElement.style.position="fixed",document.body.appendChild(n.domElement),n.autoClear=!1,a.setSize(WINDOW_WIDTH/4,WINDOW_HEIGHT/4),a.setPixelRatio(window.devicePixelRatio),a.domElement.style.position="fixed",a.domElement.style.top="5%",a.domElement.style.left="70%",a.domElement.style.zIndex="2",a.domElement.style.outline="white solid",document.body.appendChild(a.domElement),a.autoClear=!1,r.position.y=TOP_CAMERA_DIST,r.rotation.x=-90*Math.PI/180,e(),o.add(Player.playerObject),t()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBsYXllci5qcyIsIk5vdE1hcmlvS2FydC5qcyJdLCJuYW1lcyI6WyJXT1JMRF9TSURFX1NJWkUiLCJXSU5ET1dfSEVJR0hUIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJXSU5ET1dfV0lEVEgiLCJpbm5lcldpZHRoIiwiUk9BRF9DT0xPUlMiLCJOVU1CRVJfQ09MT1JTIiwibGVuZ3RoIiwiV09STERfSEVJR0hUIiwiV09STERfV0lEVEgiLCJUT1BfQ0FNRVJBX0RJU1QiLCJDQVJfU0laRV9YIiwiQ0FSX1NJWkVfWSIsIkNBUl9TSVpFX1oiLCJQbGF5ZXIiLCJvbktleU1vdmUiLCJlIiwiZXZlbnQiLCJrZXlDb2RlTWFwIiwid2hpY2giLCJ0eXBlIiwicG92Q2FtZXJhIiwiVEhSRUUiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInRyYWNraW5nQ2FtZXJhIiwiY3VycmVudENhbWVyYSIsInBsYXllck9iamVjdCIsInRleHR1cmUiLCJUZXh0dXJlTG9hZGVyIiwibG9hZCIsImdlb21ldHJ5IiwiQm94R2VvbWV0cnkiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwib2JqZWN0IiwiTWVzaCIsInBvc2l0aW9uIiwieSIsInBhcmFtZXRlcnMiLCJoZWlnaHQiLCJ6IiwiYWRkIiwibWFrZVBsYXllck9iamVjdCIsImNvbnRyb2xzIiwibW92ZW1lbnQiLCJhcnJvd3MiLCJ1cCIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJ3YXNkIiwic3dpdGNoQ2FtZXJhIiwicmVzZXQiLCJlbmFibGVkQ29udHJvbHMiLCJzcGVlZCIsInJvdGF0aW9uU3BlZWQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkb01vdmVtZW50TG9vcCIsInRyYW5zbGF0ZVoiLCJyb3RhdGVZIiwicm90YXRpb24iLCJzZXQiLCJnZXRDYW1lcmEiLCJOb3RNYXJpb0thcnQiLCJidWlsZEZsb29yIiwiUGxhbmVHZW9tZXRyeSIsIm1hdGVyaWFscyIsImkiLCJwdXNoIiwiY29sb3IiLCJzaWRlIiwiRG91YmxlU2lkZSIsImdlb0ZhY2VzTGVuZ3RoIiwiZmFjZXMiLCJqIiwibWF0ZXJpYWxJbmRleCIsIk1hdGgiLCJmbG9vciIsInJvdGF0ZVgiLCJQSSIsInNjZW5lIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsIm1pbmlNYXBSZW5kZXJlciIsIm1pbmlNYXBDYW1lcmEiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwidG9wIiwiekluZGV4Iiwib3V0bGluZSIsIngiXSwibWFwcGluZ3MiOiJhQUlBLElBQU1BLGdCQUFrQixFQUNsQkMsY0FBZ0JDLE9BQU9DLFlBQ3ZCQyxhQUFlRixPQUFPRyxXQUN0QkMsYUFDRixTQUNBLFNBQ0EsU0FDQSxNQUNBLE1BQ0EsSUFDQSxVQUVFQyxjQUFnQkQsWUFBWUUsT0FDNUJDLGFBQWUsSUFDZkMsWUFBYyxJQUNkQyxnQkFBa0IsSUFDbEJDLFdBQWEsR0FDYkMsV0FBYSxHQUNiQyxXQUFhLEdDbEJiQyxPQUFVLFdBaURaLFNBQVNDLEVBQVVDLEdBQ2ZBLEVBQUlBLEdBQUtDLE1BQ1RDLEVBQVdGLEVBQUVHLE9BQW9CLFlBQVhILEVBQUVJLEtBbEQ1QixJQUFNQyxFQUFZLElBQUlDLE1BQU1DLGtCQUN4QixHQUNBcEIsYUFBZUgsY0FDZixHQUNBLEtBR0V3QixFQUFpQixJQUFJRixNQUFNQyxrQkFDN0IsR0FDQXBCLGFBQWVILGNBQ2YsR0FDQSxLQUdBeUIsRUFBZ0JELEVBS2RFLEVBZ0VOLFdBQ0ksSUFBTUMsR0FBVSxJQUFJTCxNQUFNTSxlQUFnQkMsS0FBSyxzQ0FDekNDLEVBQVcsSUFBSVIsTUFBTVMs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LGNBQ3JCSCxFQUFrQixJQUFJbkUsTUFBTXNFLGNBQzVCRixFQUFnQixJQUFJcEUsTUFBTXVFLG9CQUFvQnJGLGFBQWEsRUFDYkEsYUFBYSxFQUNiQSxhQUFhLEdBQ2JBLGFBQWEsRUFDYkUsZ0JBQWdCLEdBQ2hCQSxnQkFBZ0IsSUE4RXBFLE9BQ0lvRixLQTNDSixXQUNJVCxFQUFTVSxRQUFRNUYsYUFBY0gsZUFDL0JxRixFQUFTVyxjQUFjL0YsT0FBT2dHLGtCQUM5QlosRUFBU2EsV0FBV0MsTUFBTTlELFNBQVcsUUFDckNvQixTQUFTMkMsS0FBS0MsWUFBWWhCLEVBQVNhLFlBQ25DYixFQUFTaUIsV0FBWSxFQUVyQmIsRUFBZ0JNLFFBQVE1RixhQUFhLEVBQUdILGNBQWMsR0FDdER5RixFQUFnQk8sY0FBYy9GLE9BQU9nRyxrQkFDckNSLEVBQWdCUyxXQUFXQyxNQUFNOUQsU0FBVyxRQUM1Q29ELEVBQWdCUyxXQUFXQyxNQUFNSSxJQUFNLEtBQ3ZDZCxFQUFnQlMsV0FBV0MsTUFBTWxELEtBQU8sTUFDeEN3QyxFQUFnQlMsV0FBV0MsTUFBTUssT0FBUyxJQUMxQ2YsRUFBZ0JTLFdBQVdDLE1BQU1NLFFBQVUsY0FDM0NoRCxTQUFTMkMsS0FBS0MsWUFBWVosRUFBZ0JTLFlBQzFDVCxFQUFnQmEsV0FBWSxFQUU1QlosRUFBY3JELFNBQVNDLEVBQUk1QixnQkFDM0JnRixFQUFjNUIsU0FBUzRDLEdBQUssR0FBSzVCLEtBQUtHLEdBQUssSUFFM0NmLElBRUFnQixFQUFNeEMsSUFBSTVCLE9BQU9ZLGNBRWpCeUQsTUFyRWMiLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWxsIGNvbnN0YW50cywgYXZhaWxhYmxlIGluIGdsb2JhbCB3aW5kb3cuXG4gKi9cblxuY29uc3QgV09STERfU0lERV9TSVpFID0gNztcbmNvbnN0IFdJTkRPV19IRUlHSFQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5jb25zdCBXSU5ET1dfV0lEVEggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbmNvbnN0IFJPQURfQ09MT1JTID0gW1xuICAgIDB4ZmYwMDAwLFxuICAgIDB4ZmY4ODAwLFxuICAgIDB4ZmZmZjAwLFxuICAgIDB4MDBmZjAwLFxuICAgIDB4MDBmZmZmLFxuICAgIDB4MDAwMGZmLFxuICAgIDB4ZmYwMGZmXG5dO1xuY29uc3QgTlVNQkVSX0NPTE9SUyA9IFJPQURfQ09MT1JTLmxlbmd0aDtcbmNvbnN0IFdPUkxEX0hFSUdIVCA9IDEwMDA7XG5jb25zdCBXT1JMRF9XSURUSCA9IDEwMDtcbmNvbnN0IFRPUF9DQU1FUkFfRElTVCA9IDUwMDtcbmNvbnN0IENBUl9TSVpFX1ggPSAxMDtcbmNvbnN0IENBUl9TSVpFX1kgPSAxMDtcbmNvbnN0IENBUl9TSVpFX1ogPSAxMDtcbiIsIi8qKlxuICogRXZlcnl0aGluZyBhYm91dCB0aGUgUGxheWVyIG9iamVjdCwgaXRzIGNhbWVyYSwgdGhlIG1vdmVtZW50cyAuLi5cbiAqL1xuXG5jb25zdCBQbGF5ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHBvdkNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcbiAgICAgICAgNzUsXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXG4gICAgICAgIDAuMSxcbiAgICAgICAgMTAwMFxuICAgICk7XG5cbiAgICBjb25zdCB0cmFja2luZ0NhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShcbiAgICAgICAgNzUsXG4gICAgICAgIFdJTkRPV19XSURUSCAvIFdJTkRPV19IRUlHSFQsXG4gICAgICAgIDAuMSxcbiAgICAgICAgMTAwMFxuICAgICk7XG5cbiAgICBsZXQgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgIGxldCBnZXRDYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRDYW1lcmE7XG4gICAgfVxuXG4gICAgY29uc3QgcGxheWVyT2JqZWN0ID0gbWFrZVBsYXllck9iamVjdCgpO1xuXG4gICAgY29uc3QgY29udHJvbHMgPSB7XG4gICAgICAgIG1vdmVtZW50OiB7XG4gICAgICAgICAgICAvLyBUT0RPOiB0aGVzZSBzaG91bGQgYmUgaW4gYSBzZXR0aW5ncyBtZW51IG9uY2Ugd2UgaGF2ZSBvbmUuXG4gICAgICAgICAgICBhcnJvd3M6IHtcbiAgICAgICAgICAgICAgICB1cDogMzgsXG4gICAgICAgICAgICAgICAgZG93bjogNDAsXG4gICAgICAgICAgICAgICAgbGVmdDogMzcsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDM5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd2FzZDoge1xuICAgICAgICAgICAgICAgIHVwOiA4NyxcbiAgICAgICAgICAgICAgICBkb3duOiA4MyxcbiAgICAgICAgICAgICAgICBsZWZ0OiA2NSxcbiAgICAgICAgICAgICAgICByaWdodDogNjhcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3dpdGNoQ2FtZXJhOiA2NyxcbiAgICAgICAgcmVzZXQ6IDhcbiAgICB9O1xuXG4gICAgbGV0IGVuYWJsZWRDb250cm9scyA9IGNvbnRyb2xzLm1vdmVtZW50LmFycm93cztcblxuICAgIGNvbnN0IHNwZWVkID0gMC41O1xuICAgIGNvbnN0IHJvdGF0aW9uU3BlZWQgPSAwLjAzO1xuXG4gICAgY29uc3Qga2V5Q29kZU1hcCA9IHt9O1xuXG4gICAgZnVuY3Rpb24gb25LZXlNb3ZlKGUpIHtcbiAgICAgICAgZSA9IGUgfHwgZXZlbnQ7IC8vIEZvciBJRS5cbiAgICAgICAga2V5Q29kZU1hcFtlLndoaWNoXSA9IGUudHlwZSA9PT0gJ2tleWRvd24nO1xuICAgIH1cblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleU1vdmUsIGZhbHNlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIG9uS2V5TW92ZSwgZmFsc2UpO1xuXG4gICAgZnVuY3Rpb24gZG9Nb3ZlbWVudExvb3AoKSB7XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy51cF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKC1zcGVlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmxlZnRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRlWShyb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMucmlnaHRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRlWSgtcm90YXRpb25TcGVlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLmRvd25dKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QudHJhbnNsYXRlWihzcGVlZCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMuc3dpdGNoQ2FtZXJhXSkge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRDYW1lcmEgPT09IHBvdkNhbWVyYSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1lcmEgPSB0cmFja2luZ0NhbWVyYTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHBvdkNhbWVyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGtleUNvZGVNYXBbY29udHJvbHMuc3dpdGNoQ2FtZXJhXSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2NvbnRyb2xzLnJlc2V0XSkge1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnJvdGF0aW9uLnkgPSAwO1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnBvc2l0aW9uLnNldCgwLCBwbGF5ZXJPYmplY3QucG9zaXRpb24ueSwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWtlUGxheWVyT2JqZWN0KCkge1xuICAgICAgICBjb25zdCB0ZXh0dXJlID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKS5sb2FkKCcvYXNzZXRzL29iamVjdC10ZXh0dXJlcy9wbGF5ZXIuanBnJyk7XG4gICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KFxuICAgICAgICAgICAgQ0FSX1NJWkVfWCxcbiAgICAgICAgICAgIENBUl9TSVpFX1ksXG4gICAgICAgICAgICBDQVJfU0laRV9aXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHsgbWFwOiB0ZXh0dXJlIH0pO1xuICAgICAgICBjb25zdCBvYmplY3QgPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpO1xuXG4gICAgICAgIG9iamVjdC5wb3NpdGlvbi55ID0gZ2VvbWV0cnkucGFyYW1ldGVycy5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnkgPSBDQVJfU0laRV9ZO1xuICAgICAgICB0cmFja2luZ0NhbWVyYS5wb3NpdGlvbi56ID0gQ0FSX1NJWkVfWio0O1xuXG4gICAgICAgIG9iamVjdC5hZGQocG92Q2FtZXJhKTtcbiAgICAgICAgb2JqZWN0LmFkZCh0cmFja2luZ0NhbWVyYSk7XG5cbiAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBkb01vdmVtZW50TG9vcDogZG9Nb3ZlbWVudExvb3AsXG4gICAgICAgIHBsYXllck9iamVjdDogcGxheWVyT2JqZWN0LFxuICAgICAgICBnZXRDYW1lcmE6IGdldENhbWVyYVxuICAgIH07XG59KSgpO1xuIiwiLyoqXG4gKiBNYWluIGZpbGUgb2YgdGhlIGdhbWUuXG4gKi9cblxuY29uc3QgTm90TWFyaW9LYXJ0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoKTtcbiAgICBjb25zdCBtaW5pTWFwUmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgIGNvbnN0IG1pbmlNYXBDYW1lcmEgPSBuZXcgVEhSRUUuT3J0aG9ncmFwaGljQ2FtZXJhKC1XT1JMRF9IRUlHSFQvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV09STERfSEVJR0hULzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdPUkxEX0hFSUdIVC8yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1XT1JMRF9IRUlHSFQvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVE9QX0NBTUVSQV9ESVNULTUwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUT1BfQ0FNRVJBX0RJU1QrNTApO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRGbG9vcigpIHtcbiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeShcbiAgICAgICAgICAgIFdPUkxEX1dJRFRILFxuICAgICAgICAgICAgV09STERfSEVJR0hULFxuICAgICAgICAgICAgV09STERfU0lERV9TSVpFLFxuICAgICAgICAgICAgMVxuICAgICAgICApO1xuICAgICAgICBsZXQgbWF0ZXJpYWxzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNQkVSX0NPTE9SUzsgaSsrKSB7XG4gICAgICAgICAgICBtYXRlcmlhbHMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogUk9BRF9DT0xPUlNbaV0sXG4gICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBnZW9GYWNlc0xlbmd0aCA9IGdlb21ldHJ5LmZhY2VzLmxlbmd0aCAvIDI7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2VvRmFjZXNMZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2pdLm1hdGVyaWFsSW5kZXggPVxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xuXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqICsgMV0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGZsb29yID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFscyk7XG4gICAgICAgIGZsb29yLnJvdGF0ZVgoLU1hdGguUEkgLyAyKTtcbiAgICAgICAgZmxvb3IucG9zaXRpb24ueSA9IDA7XG5cbiAgICAgICAgc2NlbmUuYWRkKGZsb29yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICByZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICByZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XG5cbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFNpemUoV0lORE9XX1dJRFRILzQsIFdJTkRPV19IRUlHSFQvNCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS50b3AgPSBcIjUlXCI7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLmxlZnQgPSBcIjcwJVwiO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudC5zdHlsZS56SW5kZXggPSBcIjJcIjtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLmRvbUVsZW1lbnQuc3R5bGUub3V0bGluZSA9IFwid2hpdGUgc29saWRcIjtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtaW5pTWFwUmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgICAgIG1pbmlNYXBSZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcblxuICAgICAgICBtaW5pTWFwQ2FtZXJhLnBvc2l0aW9uLnkgPSBUT1BfQ0FNRVJBX0RJU1Q7XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucm90YXRpb24ueCA9IC05MCAqIE1hdGguUEkgLyAxODA7XG5cbiAgICAgICAgYnVpbGRGbG9vcigpO1xuXG4gICAgICAgIHNjZW5lLmFkZChQbGF5ZXIucGxheWVyT2JqZWN0KTtcblxuICAgICAgICBsb29wKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9vcCgpIHtcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGxvb3ApO1xuXG4gICAgICAgIHJlbmRlcmVyLmNsZWFyKCk7XG4gICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgUGxheWVyLmdldENhbWVyYSgpKTtcblxuICAgICAgICBtaW5pTWFwUmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgbWluaU1hcFJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSC80LCBXSU5ET1dfSEVJR0hULzQpO1xuICAgICAgICBtaW5pTWFwUmVuZGVyZXIucmVuZGVyKHNjZW5lLCBtaW5pTWFwQ2FtZXJhKTtcblxuICAgICAgICBQbGF5ZXIuZG9Nb3ZlbWVudExvb3AoKTtcbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi56ID0gUGxheWVyLnBsYXllck9iamVjdC5wb3NpdGlvbi56O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9O1xufSkoKTtcbiJdfQ==
