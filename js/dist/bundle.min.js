"use strict";var WORLD_SIDE_SIZE=7,WINDOW_HEIGHT=window.innerHeight,WINDOW_WIDTH=window.innerWidth,ROAD_COLORS=[16711680,16746496,16776960,65280,65535,255,16711935],NUMBER_COLORS=ROAD_COLORS.length,WORLD_HEIGHT=1e3,WORLD_WIDTH=100,CAR_SIZE_X=10,CAR_SIZE_Y=10,CAR_SIZE_Z=10,Player=function(){function e(e){e=e||event,R[e.which]="keydown"===e.type}var t=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),r=new THREE.PerspectiveCamera(75,WINDOW_WIDTH/WINDOW_HEIGHT,.1,1e3),a=r,n=function(){var e=(new THREE.TextureLoader).load("/assets/object-textures/player.jpg"),a=new THREE.BoxGeometry(CAR_SIZE_X,CAR_SIZE_Y,CAR_SIZE_Z),n=new THREE.MeshBasicMaterial({map:e}),o=new THREE.Mesh(a,n);return o.position.y=a.parameters.height/2,r.position.y=CAR_SIZE_Y,r.position.z=4*CAR_SIZE_Z,o.add(t),o.add(r),o}(),o={movement:{arrows:{up:38,down:40,left:37,right:39},wasd:{up:87,down:83,left:65,right:68}},switchCamera:67,reset:8},i=o.movement.arrows,E=.5,I=.03,R={};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),{doMovementLoop:function(){R[i.up]&&n.translateZ(-E),R[i.left]&&n.rotateY(I),R[i.right]&&n.rotateY(-I),R[i.down]&&n.translateZ(E),R[o.switchCamera]&&(a=a===t?r:t,R[o.switchCamera]=!1),R[o.reset]&&(n.rotation.y=0,n.position.set(0,n.position.y,0))},playerObject:n,getCamera:function(){return a}}}(),NotMarioKart=function(){function e(){for(var e=new THREE.PlaneGeometry(WORLD_WIDTH,WORLD_HEIGHT,WORLD_SIDE_SIZE,1),t=[],a=0;a<NUMBER_COLORS;a++)t.push(new THREE.MeshBasicMaterial({color:ROAD_COLORS[a],side:THREE.DoubleSide}));for(var n=e.faces.length/2,o=0;o<n;o++){var i=2*o;e.faces[i].materialIndex=(o+Math.floor(o/WORLD_SIDE_SIZE))%NUMBER_COLORS,e.faces[i+1].materialIndex=(o+Math.floor(o/WORLD_SIDE_SIZE))%NUMBER_COLORS}var E=new THREE.Mesh(e,t);E.rotateX(-Math.PI/2),E.position.y=0,r.add(E)}function t(){requestAnimationFrame(t),a.clear(),a.setViewport(0,0,WINDOW_WIDTH,WINDOW_HEIGHT),a.render(r,Player.getCamera()),a.setViewport(WINDOW_WIDTH-200,50,150,150),n.position.z=Player.playerObject.position.z,a.render(r,n),Player.doMovementLoop()}var r=new THREE.Scene,a=new THREE.WebGLRenderer,n=new THREE.OrthographicCamera(-WORLD_HEIGHT/2,WORLD_HEIGHT/2,WORLD_HEIGHT/2,-WORLD_HEIGHT/2,400,550);return{init:function(){a.setSize(WINDOW_WIDTH,WINDOW_HEIGHT),a.setPixelRatio(window.devicePixelRatio),a.domElement.style.position="relative",document.body.appendChild(a.domElement),a.autoClear=!1,n.position.y=500,n.rotation.x=-90*Math.PI/180,e(),r.add(Player.playerObject),t()}}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnN0YW50cy5qcyIsIlBsYXllci5qcyIsIk5vdE1hcmlvS2FydC5qcyJdLCJuYW1lcyI6WyJXT1JMRF9TSURFX1NJWkUiLCJXSU5ET1dfSEVJR0hUIiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJXSU5ET1dfV0lEVEgiLCJpbm5lcldpZHRoIiwiUk9BRF9DT0xPUlMiLCJOVU1CRVJfQ09MT1JTIiwibGVuZ3RoIiwiV09STERfSEVJR0hUIiwiV09STERfV0lEVEgiLCJDQVJfU0laRV9YIiwiQ0FSX1NJWkVfWSIsIkNBUl9TSVpFX1oiLCJQbGF5ZXIiLCJvbktleU1vdmUiLCJlIiwiZXZlbnQiLCJrZXlDb2RlTWFwIiwid2hpY2giLCJ0eXBlIiwicG92Q2FtZXJhIiwiVEhSRUUiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInRyYWNraW5nQ2FtZXJhIiwiY3VycmVudENhbWVyYSIsInBsYXllck9iamVjdCIsInRleHR1cmUiLCJUZXh0dXJlTG9hZGVyIiwibG9hZCIsImdlb21ldHJ5IiwiQm94R2VvbWV0cnkiLCJtYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwibWFwIiwib2JqZWN0IiwiTWVzaCIsInBvc2l0aW9uIiwieSIsInBhcmFtZXRlcnMiLCJoZWlnaHQiLCJ6IiwiYWRkIiwibWFrZVBsYXllck9iamVjdCIsImNvbnRyb2xzIiwibW92ZW1lbnQiLCJhcnJvd3MiLCJ1cCIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJ3YXNkIiwic3dpdGNoQ2FtZXJhIiwicmVzZXQiLCJlbmFibGVkQ29udHJvbHMiLCJzcGVlZCIsInJvdGF0aW9uU3BlZWQiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkb01vdmVtZW50TG9vcCIsInRyYW5zbGF0ZVoiLCJyb3RhdGVZIiwicm90YXRpb24iLCJzZXQiLCJnZXRDYW1lcmEiLCJOb3RNYXJpb0thcnQiLCJidWlsZEZsb29yIiwiUGxhbmVHZW9tZXRyeSIsIm1hdGVyaWFscyIsImkiLCJwdXNoIiwiY29sb3IiLCJzaWRlIiwiRG91YmxlU2lkZSIsImdlb0ZhY2VzTGVuZ3RoIiwiZmFjZXMiLCJqIiwibWF0ZXJpYWxJbmRleCIsIk1hdGgiLCJmbG9vciIsInJvdGF0ZVgiLCJQSSIsInNjZW5lIiwibG9vcCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInJlbmRlcmVyIiwiY2xlYXIiLCJzZXRWaWV3cG9ydCIsInJlbmRlciIsIm1pbmlNYXBDYW1lcmEiLCJTY2VuZSIsIldlYkdMUmVuZGVyZXIiLCJPcnRob2dyYXBoaWNDYW1lcmEiLCJpbml0Iiwic2V0U2l6ZSIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9tRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwiYXV0b0NsZWFyIiwieCJdLCJtYXBwaW5ncyI6ImFBSUEsSUFBTUEsZ0JBQWtCLEVBQ2xCQyxjQUFnQkMsT0FBT0MsWUFDdkJDLGFBQWVGLE9BQU9HLFdBQ3RCQyxhQUNGLFNBQ0EsU0FDQSxTQUNBLE1BQ0EsTUFDQSxJQUNBLFVBRUVDLGNBQWdCRCxZQUFZRSxPQUM1QkMsYUFBZSxJQUNmQyxZQUFjLElBQ2RDLFdBQWEsR0FDYkMsV0FBYSxHQUNiQyxXQUFhLEdDakJiQyxPQUFVLFdBaURaLFNBQVNDLEVBQVVDLEdBQ2ZBLEVBQUlBLEdBQUtDLE1BQ1RDLEVBQVdGLEVBQUVHLE9BQW9CLFlBQVhILEVBQUVJLEtBbEQ1QixJQUFNQyxFQUFZLElBQUlDLE1BQU1DLGtCQUN4QixHQUNBbkIsYUFBZUgsY0FDZixHQUNBLEtBR0V1QixFQUFpQixJQUFJRixNQUFNQyxrQkFDN0IsR0FDQW5CLGFBQWVILGNBQ2YsR0FDQSxLQUdBd0IsRUFBZ0JELEVBS2RFLEVBZ0VOLFdBQ0ksSUFBTUMsR0FBVSxJQUFJTCxNQUFNTSxlQUFnQkMsS0FBSyxzQ0FDekNDLEVBQVcsSUFBSVIsTUFBTVMsWUFDdkJwQixXQUNBQyxXQUNBQyxZQUVFbUIsRUFBVyxJQUFJVixNQUFNVyxtQkFBb0JDLElBQUtQLElBQzlDUSxFQUFTLElBQUli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RixLQWpDSixXQUNJUixFQUFTUyxRQUFRMUYsYUFBY0gsZUFDL0JvRixFQUFTVSxjQUFjN0YsT0FBTzhGLGtCQUM5QlgsRUFBU1ksV0FBV0MsTUFBTTdELFNBQVcsV0FDckNvQixTQUFTMEMsS0FBS0MsWUFBWWYsRUFBU1ksWUFDbkNaLEVBQVNnQixXQUFZLEVBRXJCWixFQUFjcEQsU0FBU0MsRUFBSSxJQUMzQm1ELEVBQWMzQixTQUFTd0MsR0FBSyxHQUFLeEIsS0FBS0csR0FBSyxJQUUzQ2YsSUFFQWdCLEVBQU14QyxJQUFJNUIsT0FBT1ksY0FFakJ5RCxNQXhEYyIsImZpbGUiOiJidW5kbGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBbGwgY29uc3RhbnRzLCBhdmFpbGFibGUgaW4gZ2xvYmFsIHdpbmRvdy5cbiAqL1xuXG5jb25zdCBXT1JMRF9TSURFX1NJWkUgPSA3O1xuY29uc3QgV0lORE9XX0hFSUdIVCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbmNvbnN0IFdJTkRPV19XSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuY29uc3QgUk9BRF9DT0xPUlMgPSBbXG4gICAgMHhmZjAwMDAsXG4gICAgMHhmZjg4MDAsXG4gICAgMHhmZmZmMDAsXG4gICAgMHgwMGZmMDAsXG4gICAgMHgwMGZmZmYsXG4gICAgMHgwMDAwZmYsXG4gICAgMHhmZjAwZmZcbl07XG5jb25zdCBOVU1CRVJfQ09MT1JTID0gUk9BRF9DT0xPUlMubGVuZ3RoO1xuY29uc3QgV09STERfSEVJR0hUID0gMTAwMDtcbmNvbnN0IFdPUkxEX1dJRFRIID0gMTAwO1xuY29uc3QgQ0FSX1NJWkVfWCA9IDEwO1xuY29uc3QgQ0FSX1NJWkVfWSA9IDEwO1xuY29uc3QgQ0FSX1NJWkVfWiA9IDEwO1xuIiwiLyoqXG4gKiBFdmVyeXRoaW5nIGFib3V0IHRoZSBQbGF5ZXIgb2JqZWN0LCBpdHMgY2FtZXJhLCB0aGUgbW92ZW1lbnRzIC4uLlxuICovXG5cbmNvbnN0IFBsYXllciA9IChmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgcG92Q2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgICA3NSxcbiAgICAgICAgV0lORE9XX1dJRFRIIC8gV0lORE9XX0hFSUdIVCxcbiAgICAgICAgMC4xLFxuICAgICAgICAxMDAwXG4gICAgKTtcblxuICAgIGNvbnN0IHRyYWNraW5nQ2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgICA3NSxcbiAgICAgICAgV0lORE9XX1dJRFRIIC8gV0lORE9XX0hFSUdIVCxcbiAgICAgICAgMC4xLFxuICAgICAgICAxMDAwXG4gICAgKTtcblxuICAgIGxldCBjdXJyZW50Q2FtZXJhID0gdHJhY2tpbmdDYW1lcmE7XG4gICAgbGV0IGdldENhbWVyYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gY3VycmVudENhbWVyYTtcbiAgICB9XG5cbiAgICBjb25zdCBwbGF5ZXJPYmplY3QgPSBtYWtlUGxheWVyT2JqZWN0KCk7XG5cbiAgICBjb25zdCBjb250cm9scyA9IHtcbiAgICAgICAgbW92ZW1lbnQ6IHtcbiAgICAgICAgICAgIC8vIFRPRE86IHRoZXNlIHNob3VsZCBiZSBpbiBhIHNldHRpbmdzIG1lbnUgb25jZSB3ZSBoYXZlIG9uZS5cbiAgICAgICAgICAgIGFycm93czoge1xuICAgICAgICAgICAgICAgIHVwOiAzOCxcbiAgICAgICAgICAgICAgICBkb3duOiA0MCxcbiAgICAgICAgICAgICAgICBsZWZ0OiAzNyxcbiAgICAgICAgICAgICAgICByaWdodDogMzlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXNkOiB7XG4gICAgICAgICAgICAgICAgdXA6IDg3LFxuICAgICAgICAgICAgICAgIGRvd246IDgzLFxuICAgICAgICAgICAgICAgIGxlZnQ6IDY1LFxuICAgICAgICAgICAgICAgIHJpZ2h0OiA2OFxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzd2l0Y2hDYW1lcmE6IDY3LFxuICAgICAgICByZXNldDogOFxuICAgIH07XG5cbiAgICBsZXQgZW5hYmxlZENvbnRyb2xzID0gY29udHJvbHMubW92ZW1lbnQuYXJyb3dzO1xuXG4gICAgY29uc3Qgc3BlZWQgPSAwLjU7XG4gICAgY29uc3Qgcm90YXRpb25TcGVlZCA9IDAuMDM7XG5cbiAgICBjb25zdCBrZXlDb2RlTWFwID0ge307XG5cbiAgICBmdW5jdGlvbiBvbktleU1vdmUoZSkge1xuICAgICAgICBlID0gZSB8fCBldmVudDsgLy8gRm9yIElFLlxuICAgICAgICBrZXlDb2RlTWFwW2Uud2hpY2hdID0gZS50eXBlID09PSAna2V5ZG93bic7XG4gICAgfVxuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5TW92ZSwgZmFsc2UpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgb25LZXlNb3ZlLCBmYWxzZSk7XG5cbiAgICBmdW5jdGlvbiBkb01vdmVtZW50TG9vcCgpIHtcbiAgICAgICAgaWYgKGtleUNvZGVNYXBbZW5hYmxlZENvbnRyb2xzLnVwXSkge1xuICAgICAgICAgICAgcGxheWVyT2JqZWN0LnRyYW5zbGF0ZVooLXNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMubGVmdF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKHJvdGF0aW9uU3BlZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXlDb2RlTWFwW2VuYWJsZWRDb250cm9scy5yaWdodF0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC5yb3RhdGVZKC1yb3RhdGlvblNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtlbmFibGVkQ29udHJvbHMuZG93bl0pIHtcbiAgICAgICAgICAgIHBsYXllck9iamVjdC50cmFuc2xhdGVaKHNwZWVkKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoa2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudENhbWVyYSA9PT0gcG92Q2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudENhbWVyYSA9IHRyYWNraW5nQ2FtZXJhO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2FtZXJhID0gcG92Q2FtZXJhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAga2V5Q29kZU1hcFtjb250cm9scy5zd2l0Y2hDYW1lcmFdID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleUNvZGVNYXBbY29udHJvbHMucmVzZXRdKSB7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3Qucm90YXRpb24ueSA9IDA7XG4gICAgICAgICAgICBwbGF5ZXJPYmplY3QucG9zaXRpb24uc2V0KDAsIHBsYXllck9iamVjdC5wb3NpdGlvbi55LCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VQbGF5ZXJPYmplY3QoKSB7XG4gICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy9hc3NldHMvb2JqZWN0LXRleHR1cmVzL3BsYXllci5qcGcnKTtcbiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoXG4gICAgICAgICAgICBDQVJfU0laRV9YLFxuICAgICAgICAgICAgQ0FSX1NJWkVfWSxcbiAgICAgICAgICAgIENBUl9TSVpFX1pcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoeyBtYXA6IHRleHR1cmUgfSk7XG4gICAgICAgIGNvbnN0IG9iamVjdCA9IG5ldyBUSFJFRS5NZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7XG5cbiAgICAgICAgb2JqZWN0LnBvc2l0aW9uLnkgPSBnZW9tZXRyeS5wYXJhbWV0ZXJzLmhlaWdodCAvIDI7XG5cbiAgICAgICAgdHJhY2tpbmdDYW1lcmEucG9zaXRpb24ueSA9IENBUl9TSVpFX1k7XG4gICAgICAgIHRyYWNraW5nQ2FtZXJhLnBvc2l0aW9uLnogPSBDQVJfU0laRV9aKjQ7XG5cbiAgICAgICAgb2JqZWN0LmFkZChwb3ZDYW1lcmEpO1xuICAgICAgICBvYmplY3QuYWRkKHRyYWNraW5nQ2FtZXJhKTtcblxuICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGRvTW92ZW1lbnRMb29wOiBkb01vdmVtZW50TG9vcCxcbiAgICAgICAgcGxheWVyT2JqZWN0OiBwbGF5ZXJPYmplY3QsXG4gICAgICAgIGdldENhbWVyYTogZ2V0Q2FtZXJhXG4gICAgfTtcbn0pKCk7XG4iLCIvKipcbiAqIE1haW4gZmlsZSBvZiB0aGUgZ2FtZS5cbiAqL1xuXG5jb25zdCBOb3RNYXJpb0thcnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgY29uc3QgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgIGNvbnN0IG1pbmlNYXBDYW1lcmEgPSBuZXcgVEhSRUUuT3J0aG9ncmFwaGljQ2FtZXJhKC1XT1JMRF9IRUlHSFQvMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV09STERfSEVJR0hULzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdPUkxEX0hFSUdIVC8yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1XT1JMRF9IRUlHSFQvMiwgNDAwLCA1NTApO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRGbG9vcigpIHtcbiAgICAgICAgY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuUGxhbmVHZW9tZXRyeShcbiAgICAgICAgICAgIFdPUkxEX1dJRFRILFxuICAgICAgICAgICAgV09STERfSEVJR0hULFxuICAgICAgICAgICAgV09STERfU0lERV9TSVpFLFxuICAgICAgICAgICAgMVxuICAgICAgICApO1xuICAgICAgICBsZXQgbWF0ZXJpYWxzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTlVNQkVSX0NPTE9SUzsgaSsrKSB7XG4gICAgICAgICAgICBtYXRlcmlhbHMucHVzaChcbiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgICAgICBjb2xvcjogUk9BRF9DT0xPUlNbaV0sXG4gICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBnZW9GYWNlc0xlbmd0aCA9IGdlb21ldHJ5LmZhY2VzLmxlbmd0aCAvIDI7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2VvRmFjZXNMZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IGogPSBpICogMjsgLy8gPC0tIEFkZGVkIHRoaXMgYmFjayBzbyB3ZSBjYW4gZG8gZXZlcnkgb3RoZXIgJ2ZhY2UnXG5cbiAgICAgICAgICAgIGdlb21ldHJ5LmZhY2VzW2pdLm1hdGVyaWFsSW5kZXggPVxuICAgICAgICAgICAgICAgIChpICsgTWF0aC5mbG9vcihpIC8gV09STERfU0lERV9TSVpFKSkgJSBOVU1CRVJfQ09MT1JTO1xuXG4gICAgICAgICAgICBnZW9tZXRyeS5mYWNlc1tqICsgMV0ubWF0ZXJpYWxJbmRleCA9XG4gICAgICAgICAgICAgICAgKGkgKyBNYXRoLmZsb29yKGkgLyBXT1JMRF9TSURFX1NJWkUpKSAlIE5VTUJFUl9DT0xPUlM7IC8vIE90aGVyIGhhbGYgb2YgdGhlIHNhbWUgZmFjZVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGZsb29yID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFscyk7XG4gICAgICAgIGZsb29yLnJvdGF0ZVgoLU1hdGguUEkgLyAyKTtcbiAgICAgICAgZmxvb3IucG9zaXRpb24ueSA9IDA7XG5cbiAgICAgICAgc2NlbmUuYWRkKGZsb29yKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICByZW5kZXJlci5zZXRTaXplKFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICByZW5kZXJlci5kb21FbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAgICAgcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7XG5cbiAgICAgICAgbWluaU1hcENhbWVyYS5wb3NpdGlvbi55ID0gNTAwO1xuICAgICAgICBtaW5pTWFwQ2FtZXJhLnJvdGF0aW9uLnggPSAtOTAgKiBNYXRoLlBJIC8gMTgwO1xuXG4gICAgICAgIGJ1aWxkRmxvb3IoKTtcblxuICAgICAgICBzY2VuZS5hZGQoUGxheWVyLnBsYXllck9iamVjdCk7XG5cbiAgICAgICAgbG9vcCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvb3AoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcblxuICAgICAgICByZW5kZXJlci5jbGVhcigpO1xuXG4gICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KDAsIDAsIFdJTkRPV19XSURUSCwgV0lORE9XX0hFSUdIVCk7XG4gICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgUGxheWVyLmdldENhbWVyYSgpKTtcblxuICAgICAgICByZW5kZXJlci5zZXRWaWV3cG9ydChXSU5ET1dfV0lEVEggLSAyMDAsIDUwLCAxNTAsIDE1MCk7XG4gICAgICAgIG1pbmlNYXBDYW1lcmEucG9zaXRpb24ueiA9IFBsYXllci5wbGF5ZXJPYmplY3QucG9zaXRpb24uejtcbiAgICAgICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBtaW5pTWFwQ2FtZXJhKTtcblxuICAgICAgICBQbGF5ZXIuZG9Nb3ZlbWVudExvb3AoKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0pKCk7XG4iXX0=
